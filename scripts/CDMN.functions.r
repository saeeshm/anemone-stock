################################################################################
#                              FISHERY SCIENCE                                 #
#                           Catch Dynamic Models                               #
#                    Author : Ruben H. Roa-Ureta, Ph.D.                        #
#                          ruben.roa.ureta@mail.com                            #
################################################################################
#
#2018-05-11 Change formula for AIC, because when extracting the loglik object from optimx report the extracted quantity is
#           the minimized negative loglik instead of the maximized positive loglik, thus the - sign in the AIC formula has
#           changed to a + sign
#
#WDir <- "D:/Ruben/Workplace/Rpack/CatDyn/pkg/CatDyn111"
#setwd(WDir)
#
# Contents
# 0    - STARTUP                                                              62
# I    - S3 CLASSES AND METHODS                                               78
# II   - DATA                                                                 87
#    A - EXAMPLE DATA                                                         91
#    B - DATA OBJECTS OF CLASS CatDynData                                     99
#    C - DATA PLOT                                                           485
# III  - MODEL TYPE FUNCTIONS                                                796
#    A - One Fleet                                                           798
#        i) Resident stock                                                   800
#        ii) Transit stcok                                                  3297
#    B - Two Fleets                                                         7652
#        1) Resident stock                                                  7654
# IV   - LIKELIHOOD AND PREDICTION                                         13181
#    A - DISPERION PARAMETER NEGBIN
#    B - LIKELIHOOD MODELS                                                 12335
#    C - PREDICTIONS                                                       13181
# V    - MODEL EXPLORATORY WRAPPER                                         13536
# VI   - PREDICTIONS DIAGNOSTIC PLOT                                       15924
# VII  - MODEL FIT                                                         16040
#    A - WRAPPER                                                           16042
#    B - DELTA METHOD                                                      26998
#    C - MODEL FIT PREDICTIONS                                             27021
#    D - MODEL PLOT                                                        27437
# VIII - MODEL FIT SELECTION                                               27552
#    A - NUMERICAL SUMMARY                                                 27554
#    B - CORRELATION PLOT                                                  27721
#    C - PARAMETERS TABLE                                                  27756
# IX   - EXPLOITATION RATE                                                 28531
#    A - ANNUAL EXPLOITATION RATE TABLE                                    28534
# X    - HIERARCHICAL ESTIMATION OF SURPLUS PRODUCTION                     28727
#    A - LENGTH-WEIGHT MODEL                                               28730
#    B - MEAN MONTHLY BODY WEIGHT                                          28740
#    C - CORRELATION MATRIX TO COVARIANCE MATRIX                           28780
#    D - STANDARD DEVIATIONS OR COVARIANCE MATRIX OF ANNUAL BIOMASS        28810
#    E - FIT OF BIOMASS PRODUCTIONS MODEL                                  30409
#
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
#
################################################################################
#                               0 - STARTUP                                    #
################################################################################
#
.onAttach <- function (lib, pkg) {
    pkg.info <- drop(read.dcf(file=system.file("DESCRIPTION", package="CatDyn"),
                              fields=c("Title","Version","Date")))

   packageStartupMessage(paste(
   "--------------------------------------------------------------\n",
   pkg.info["Title"]),"\n",
   paste(" CatDyn version ", pkg.info["Version"],
   " (built on ", pkg.info["Date"], ") is now loaded\n", sep=""),
	 "--------------------------------------------------------------\n"
    )
}
#
################################################################################
#                           I -  S3 CLASSES AND METHODS                        # 
################################################################################
#
CatDynData <- function(x,...) UseMethod("CatDynData")
CatDynExp  <- function(x,...) UseMethod("CatDynExp")
catdyn     <- function(x,...) UseMethod("catdyn")
CatDynMod  <- function(x,...) UseMethod("CatDynMod")
#
################################################################################
#                                  II - DATA                                   #
################################################################################
#
####################    II A INTRODUCING SOME EXAMPLE DATA    ################## 
#
gayhake    <- read.csv("data/CDMN/chihake.csv", header=TRUE)
gayhakelm  <- read.csv("data/CDMN/chihake.lm.csv", header=TRUE)
gayhakelw  <- read.csv("data/CDMN/chihake.lw.csv", header=TRUE)
lolgahi    <- read.csv("data/CDMN/fklol.csv", header=TRUE)
m.hoenig   <- read.csv("data/CDMN/Hoenig.csv",header=TRUE)
twelver    <- read.csv("data/CDMN/twelver.csv", header=TRUE, colClasses=c("Date","numeric","numeric","numeric"))
#
##############    II B CREATING DATA OBJECTS OF CLASS CatDynData    ############ 
#
as.CatDynData <- function(x,step,fleet.name,coleff,colcat,colmbw,unitseff,unitscat,unitsmbw,nmult,season.dates)
   {
    if(step != "day" && step != "week" && step != "month")
      {stop("step for the catch dynamics must be 'day', 'week', or 'month' ")}
    if(length(fleet.name) < 1 || length(fleet.name) > 2){stop("The number of fleets must be 1 or 2")}
    if(length(unique(fleet.name)) != length(fleet.name)){stop("Fleets must have unique names")}
    if(any(x[,coleff] < 0) || any(x[,colcat] < 0) || any(x[,colmbw] < 0))
      {stop("Catch, effort, and mean body weight observations must all be non-negative")}
    if(sum(is.na(x[,c(coleff,colcat)])) > 0){stop("NAs are not allowed in the catch, effort series")}
    if(any(coleff > dim(x)[2])){stop("coleff are the columns where the effort data is stored")}
    if(any(colcat > dim(x)[2])){stop("colcat are the columns where the catch data is stored")}
    if(any(colmbw > dim(x)[2])){stop("colmbw are the columns where the mean body weight is stored")}
    if(unitscat != "kg" && unitscat != "ton" && unitscat != "ind") {stop("unitscat must be a character (all fleets same unit) either kilograms ('kg'), tonnes ('ton') or numbers ('ind')")}
    if(unitsmbw != "kg" && unitsmbw != "g" && unitsmbw != "ind") {stop("unitsmbw must be a character (all fleets same unit) either grams ('g'), kilograms ('kg') or numbers ('ind')")}
    if(length(unitscat) > 1 || length(unitsmbw) > 1) {stop("The catches and mean body weight of all fleets must be in the same units, thus this parameter must be of length 1")}
    if(nmult != "bill" && nmult != "mill" && nmult != "thou" && nmult != "hund" && nmult != "ind") {stop("nmult, the catch in numbers multiplier, must be 'bill' (billions), 'mill' (millions), 'thou' (thousands), 'hund' (hundreds), or 'ind' (single individuals)")}
    if(length(nmult) > 1) {stop("Since the catches and mean body weight are in the same unit for both fleets, the nmult parameter must be of length 1")}
    if(paste(substr(season.dates[1],5,5),substr(season.dates[1],8,8),sep="") != "--" || paste(substr(season.dates[2],5,5),substr(season.dates[2],8,8),sep="") != "--")
      {stop("season.dates must be a length-2 character vector (start of season, end of season) with dates in the ISO 8601 international standard, i.e. yyyy-mm-dd")}
    cateff                         <- vector("list",2);
    names(cateff)                  <- c("Properties","Data");
    cateff$Data                    <- vector("list",length(fleet.name));
    names(cateff$Data)             <- fleet.name
    cateff$Properties              <- vector("list",3)
    names(cateff$Properties)       <- c("Units","Fleets","Dates")
    cateff$Properties$Units        <- c(step,unitscat,unitsmbw,nmult)
    names(cateff$Properties$Units) <- c("Time Step","Catch","Bodymass","NumbersMultiplier")
    cateff$Properties$Fleets       <- data.frame(Fleet=fleet.name,Units=unitseff,stringsAsFactors=FALSE)
    cateff$Properties$Dates        <- season.dates
    names(cateff$Properties$Dates) <- c("StartDate","EndDate")
    if(step == "day")
      {
       if(paste(substr(season.dates[1],5,5),substr(season.dates[1],8,8),sep="") != "--" || paste(substr(season.dates[2],5,5),substr(season.dates[2],8,8),sep="") != "--")
        {stop("dates of daily catch dynamics must be a length 2 character vector with dates in the ISO 8601 international standard, i.e. yyyy-mm-dd")}
       if(as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) - as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) > 1)
         {stop("For a daily time step the modeling is seasonal, involving no more than two calendar years")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) > as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")))
         {stop("Dates must be arranged in ascending order")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")))
         {stop("Dates must be arranged in ascending order")}          
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%d")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%d")))
         {stop("Dates must be arranged in ascending order")}          
       start <- as.numeric(julian(as.Date(season.dates[1],"%Y-%m-%d"),origin=as.Date(paste(substr(season.dates[1],1,4),"-01-01",sep="")))) + 1;
       for(i in 1:length(fleet.name))
         {
          (if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y"))) 
            {end <-  as.numeric(julian(as.Date(season.dates[2],"%Y-%m-%d"),
                                       origin=as.Date(paste(substr(season.dates[2],1,4),"-01-01",sep=""))) + 1)
             cateff$Data[[i]] <- data.frame(time.step=start:end,x[,coleff[i]],x[,colcat[i]],x[,colmbw[i]])}
           else 
            {end <- (as.numeric(julian(as.Date(paste(substr(season.dates[1],1,4),"-12-31",sep="")),
                                       origin=as.Date(paste(substr(season.dates[1],1,4),"-01-01",sep=""))))-start+2) + 
                     as.numeric(julian(as.Date(season.dates[2],"%Y-%m-%d"),origin=as.Date(paste(substr(season.dates[2],1,4),"-01-01",sep="")))) + 1
             cateff$Data[[i]] <- data.frame(time.step=1:end,x[,coleff[i]],x[,colcat[i]],x[,colmbw[i]]);})
#         if(length(start:(start+end)) != dim(x)[1])
#           {stop("Check season.dates, you have a number of days that is not identical to the number of effort/catch/mean body weight observations \n Consider changing the dates")}
#         cateff$Data[[i]]              <- data.frame(time.step=start:end,x[,coleff[i]],x[,colcat[i]],x[,colmbw[i]]);
         names(cateff$Data[[i]])[2:4]  <-c(paste("obseff.",unitseff[i],sep=""),
                                           paste("obscat.",unitscat,sep=""),
                                           paste("obsmbw.",unitsmbw,sep="")); 
         if(nmult == "bill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
          else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff[,3][[i]]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "ind" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.ind2    <- ifelse(cateff$Data[[i]][,3]==0,0,cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         cateff$Data[[i]]$spikecat  <- unlist(10*(cateff$Data[[i]][5]/max(cateff$Data[[i]][5])-cateff$Data[[i]][2]/max(cateff$Data[[i]][2])));
        }
      }
    else if(step == "week")
      {
       if(paste(substr(season.dates[1],5,5),substr(season.dates[1],8,8),sep="") != "--" || paste(substr(season.dates[2],5,5),substr(season.dates[2],8,8),sep="") != "--")
        {stop("dates of weekly catch dynamics must be a length 2 character vector with dates in the ISO 8601 international standard, i.e. yyyy-mm-dd")}
       if(as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) - as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) > 1)
         {stop("For a weekly time step the modeling is seasonal, involving no more than two calendar years")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) > as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")))
         {stop("Dates must be arranged in ascending order")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")))
         {stop("Dates must be arranged in ascending order")}          
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%d")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%d")))
         {stop("Dates must be arranged in ascending order")}          
       start         <- as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"),"%W"));
       (if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y"))) 
          {end <- as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"),"%W"))}
        else 
          {end <- as.numeric(format(as.Date(paste(substr(season.dates[1],1,4),"-12-31",sep="")),"%W")) + 1 +
                     as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"),"%W"))})
       for(i in 1:length(fleet.name))
         {
#         if(length(start:end) != length(x[,coleff[i]]))
#           {stop("Check season.dates, you have a number of weeks that is not identical to the number of effort/catch/mean body weight observations \n Consider changing the dates")}
         cateff$Data[[i]]              <- data.frame(time.step=start:end,x[,coleff[i]],x[,colcat[i]],x[,colmbw[i]]);
         names(cateff$Data[[i]])[2:4]  <-c(paste("obseff.",unitseff[i],sep=""),
                                           paste("obscat.",unitscat,sep=""),
                                           paste("obsmbw.",unitsmbw,sep="")); 
         if(nmult == "bill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff[,4][[i]]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "ind" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.ind2    <- ifelse(cateff$Data[[i]][,3]==0,0,cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "ind" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.ind2    <- ifelse(cateff$Data[[i]][,3]==0,0,cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
         }
         cateff$Data[[i]]$spikecat  <- unlist(10*(cateff$Data[[i]][5]/max(cateff$Data[[i]][5])-cateff$Data[[i]][2]/max(cateff$Data[[i]][2])));
        }
      }
    else
      {
       if(paste(substr(season.dates[1],5,5),substr(season.dates[1],8,8),sep="") != "--" || paste(substr(season.dates[2],5,5),substr(season.dates[2],8,8),sep="") != "--")
         {stop("dates of monthly catch dynamics must be a length 2 character vector with dates in the ISO 8601 international standard, i.e. yyyy-mm-dd")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) > as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")))
         {stop("Dates must be arranged in ascending order")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")))
         {stop("Dates must be arranged in ascending order")}          
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%Y")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%Y")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%m")) == as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%m")) &&
          as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"), "%d")) >  as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"), "%d")))
         {stop("Dates must be arranged in ascending order")}          
       start         <- as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"),"%m"));
       end           <- as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"),"%m"))*
                       (as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"),"%Y"))-as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"),"%Y"))+1);
       if(start >= end) {stop("Dates must be arranged in ascending order")}
       if(as.numeric(format(as.Date(season.dates[1],"%Y-%m-%d"),"%m")) > 1)
         {stop("For multi-annual models with monthly time step the catch and effort data must start in January of the first year. \n If the fishing season starts at a later month, add lines with 0s to the catch and effort of earlier months backward to January")}
       if(as.numeric(format(as.Date(season.dates[2],"%Y-%m-%d"),"%m")) < 12)
         {stop("For multi-annual models with monthly time step the catch and effort data must end in December of the last year. \n If the fishing season ends at an earlier month, add lines with 0s to the catch and effort of later months forward to December")}
       for(i in 1:length(fleet.name))
         {
         cateff$Data[[i]]              <- data.frame(time.step=seq(start,end,1),x[,coleff[i]],x[,colcat[i]],x[,colmbw[i]]);
         names(cateff$Data[[i]])[2:4]  <-c(paste("obseff.",unitseff[i],sep=""),
                                           paste("obscat.",unitscat,sep=""),
                                           paste("obsmbw.",unitsmbw,sep="")); 
         if(nmult == "bill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "g")
          { 
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff[,3][[i]]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ton" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "g")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*1e3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "kg" && unitsmbw == "kg")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "bill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.bill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-9*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "mill" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.mill    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-6*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "thou" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.thou    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-3*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "hund" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.hund    <- ifelse(cateff$Data[[i]][,3]==0,0,1e-2*cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         else if(nmult == "ind" && unitscat == "ind" && unitsmbw == "ind")
          {
           cateff$Data[[i]]$obscat.ind2    <- ifelse(cateff$Data[[i]][,3]==0,0,cateff$Data[[i]][,3]/cateff$Data[[i]][,4]);
          }
         cateff$Data[[i]]$spikecat  <- unlist(10*(cateff$Data[[i]][5]/max(cateff$Data[[i]][5])-cateff$Data[[i]][2]/max(cateff$Data[[i]][2])));
        }
      }
    oldClass(cateff) <- "CatDynData" 
    return(cateff)
   } 
#
###############################    II C DATA PLOT      #########################
#
#Examine effort-catch relation,observed time series
plot.CatDynData <- function(x,mark,offset,hem,...)
    {
     options(warn=-1)
     if(class(x) != "CatDynData") {stop("Pass and object of class CatDynData as first argument - see the help for as.CatDynData")}
     fleet.name <- x$Properties$Fleets$Fleet
     for(i in 1:length(fleet.name))
       {
       period <- x$Data[[i]][,1]
       effort <- x$Data[[i]][,2]
       catch  <- x$Data[[i]][,5]
       spike  <- x$Data[[i]][,6] 
       mbw    <- x$Data[[i]][,4] 
       tstep  <- x$Properties$Units[1]
       layout(matrix(c(1,2,3,4,4,4,5,5,5,6,6,6,7,7,7),5,3, byrow = TRUE))
       par(oma=c(2,2,2,1), mar=c(4,4,2,2))
       plot(x=effort,y=catch,main="",xlab=paste("Effort (",x$Properties$Fleets[i,"Units"],")",sep=""),ylab=paste("Catch (",x$Properties$Units[4],")",sep="")) 
       hist(x=catch,main="",xlab=paste("Catch (",x$Properties$Units[4],")",sep=""),ylab="Frequency")
       hist(x=effort,main="",xlab=paste("Effort (",x$Properties$Fleets[i,"Units"],")",sep=""),ylab="Frequency")
       plot(x=period,y=effort,xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=paste("Effort (",x$Properties$Fleets[i,"Units"],")",sep=""),axes=FALSE, pch=19)
       if(mark==TRUE)
         {
          text(x=period,y=effort+max(effort)/offset[1],labels=period)
         } 
       axis(side=1,at=seq(head(period,1),tail(period,1),1))
       axis(side=2,at=NULL)
       #obseff.trend    <- loess(effort~period,span=span)
       #obseff.pred     <- predict(obseff.trend)
       #lines(x=period,y=obseff.pred,col="blue",lwd=1)
       if(hem=="N")
         {
         if(tstep=="day")
           {
           text(x=079+10,y=0.9*max(effort),lab="Spring",col='blue')
           text(x=171+10,y=0.9*max(effort),lab="Summer",col='blue')
           text(x=263+10,y=0.9*max(effort),lab="Fall",col='blue')
           text(x=354+10,y=0.9*max(effort),lab="Winter",col='blue')
           abline(v=079,col='blue')
           abline(v=171,col='blue')
           abline(v=263,col='blue')
           abline(v=354,col='blue')
           }
         else if(tstep=="week")
           {
           text(x=12+2,y=0.9*max(effort),lab="Spring",col='blue')
           text(x=25+2,y=0.9*max(effort),lab="Summer",col='blue')
           text(x=38+2,y=0.9*max(effort),lab="Fall",col='blue')
           text(x=51+2,y=0.9*max(effort),lab="Winter",col='blue')
           abline(v=12,col='blue')
           abline(v=25,col='blue')
           abline(v=38,col='blue')
           abline(v=51,col='blue')
           }
         else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(effort),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(effort),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(effort),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(effort),lab="Wn",col='blue')
           }
         }
       else
         {
         if(tstep=="day")
           {
           text(x=079+10,y=0.9*max(effort),lab="Fall",col='blue')
           text(x=171+10,y=0.9*max(effort),lab="Winter",col='blue')
           text(x=263+10,y=0.9*max(effort),lab="Spring",col='blue')
           text(x=354+10,y=0.9*max(effort),lab="Summer",col='blue')
           abline(v=079,col='blue')
           abline(v=171,col='blue')
           abline(v=263,col='blue')
           abline(v=354,col='blue')
           }
         else if(tstep=="week")
           {
           text(x=12+2,y=0.9*max(effort),lab="Fall",col='blue')
           text(x=25+2,y=0.9*max(effort),lab="Winter",col='blue')
           text(x=38+2,y=0.9*max(effort),lab="Spring",col='blue')
           text(x=51+2,y=0.9*max(effort),lab="Summer",col='blue')
           abline(v=12,col='blue')
           abline(v=25,col='blue')
           abline(v=38,col='blue')
           abline(v=51,col='blue')
           }
         else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(effort),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(effort),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(effort),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(effort),lab="Wn",col='blue')
           }
         }
       plot(x=period,y=catch,main="",xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=paste("Catch (",x$Properties$Units[4],")",sep=""),axes=FALSE, pch=19)
       if(mark==TRUE)
         {
          text(x=period,y=catch+max(catch)/offset[2],labels=period)
         } 
       axis(side=1,at=seq(head(period,1),tail(period,1),1))
       axis(side=2,at=NULL)
       if(hem=="N")
         {
          if(tstep=="day")
            {
            text(x=079+10,y=0.9*max(catch),lab="Spring",col='blue')
            text(x=171+10,y=0.9*max(catch),lab="Summer",col='blue')
            text(x=263+10,y=0.9*max(catch),lab="Fall",col='blue')
            text(x=354+10,y=0.9*max(catch),lab="Winter",col='blue')
            abline(v=079,col='blue')
            abline(v=171,col='blue')
            abline(v=263,col='blue')
            abline(v=354,col='blue')
            }
          else if(tstep=="week")
            {
            text(x=12+2,y=0.9*max(catch),lab="Spring",col='blue')
            text(x=25+2,y=0.9*max(catch),lab="Summer",col='blue')
            text(x=38+2,y=0.9*max(catch),lab="Fall",col='blue')
            text(x=51+2,y=0.9*max(catch),lab="Winter",col='blue')
            abline(v=12,col='blue')
            abline(v=25,col='blue')
            abline(v=38,col='blue')
            abline(v=51,col='blue')
            }
          else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(catch),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(catch),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(catch),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(catch),lab="Wn",col='blue')
           }
         }
       else
         {
         if(tstep=="day")
           {
           text(x=079+10,y=0.9*max(catch),lab="Fall",col='blue')
           text(x=171+10,y=0.9*max(catch),lab="Winter",col='blue')
           text(x=263+10,y=0.9*max(catch),lab="Spring",col='blue')
           text(x=354+10,y=0.9*max(catch),lab="Summer",col='blue')
           abline(v=079,col='blue')
           abline(v=171,col='blue')
           abline(v=263,col='blue')
           abline(v=354,col='blue')
           }
         else if(tstep=="week")
           {
           text(x=12+2,y=0.9*max(catch),lab="Fall",col='blue')
           text(x=25+2,y=0.9*max(catch),lab="Winter",col='blue')
           text(x=38+2,y=0.9*max(catch),lab="Spring",col='blue')
           text(x=51+2,y=0.9*max(catch),lab="Summer",col='blue')
           abline(v=12,col='blue')
           abline(v=25,col='blue')
           abline(v=38,col='blue')
           abline(v=51,col='blue')
           }
         else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(catch),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(catch),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(catch),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(catch),lab="Wn",col='blue')
           }
          }
       plot(x=period,y=spike,main="",xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab="Catch Spike",axes=FALSE, pch=19)
       if(mark==TRUE)
         {
          text(x=period,y=spike+max(spike)/offset[3],labels=period)
         } 
       axis(side=1,at=seq(head(period,1),tail(period,1),1))
       axis(side=2,at=NULL)
       abline(h=0)
       if(hem=="N")
         {
          if(tstep=="day")
            {
            text(x=079+10,y=0.9*max(spike),lab="Spring",col='blue')
            text(x=171+10,y=0.9*max(spike),lab="Summer",col='blue')
            text(x=263+10,y=0.9*max(spike),lab="Fall",col='blue')
            text(x=354+10,y=0.9*max(spike),lab="Winter",col='blue')
            abline(v=079,col='blue')
            abline(v=171,col='blue')
            abline(v=263,col='blue')
            abline(v=354,col='blue')
            }
          else if(tstep=="week")
            {
            text(x=12+2,y=0.9*max(spike),lab="Spring",col='blue')
            text(x=25+2,y=0.9*max(spike),lab="Summer",col='blue')
            text(x=38+2,y=0.9*max(spike),lab="Fall",col='blue')
            text(x=51+2,y=0.9*max(spike),lab="Winter",col='blue')
            abline(v=12,col='blue')
            abline(v=25,col='blue')
            abline(v=38,col='blue')
            abline(v=51,col='blue')
            }
          else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(spike),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(spike),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(spike),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(spike),lab="Wn",col='blue')
           }
         }
       else
         {
         if(tstep=="day")
           {
           text(x=079+10,y=0.9*max(spike),lab="Fall",col='blue')
           text(x=171+10,y=0.9*max(spike),lab="Winter",col='blue')
           text(x=263+10,y=0.9*max(spike),lab="Spring",col='blue')
           text(x=354+10,y=0.9*max(spike),lab="Summer",col='blue')
           abline(v=079,col='blue')
           abline(v=171,col='blue')
           abline(v=263,col='blue')
           abline(v=354,col='blue')
           }
         else if(tstep=="week")
           {
           text(x=12+2,y=0.9*max(spike),lab="Fall",col='blue')
           text(x=25+2,y=0.9*max(spike),lab="Winter",col='blue')
           text(x=38+2,y=0.9*max(spike),lab="Spring",col='blue')
           text(x=51+2,y=0.9*max(spike),lab="Summer",col='blue')
           abline(v=12,col='blue')
           abline(v=25,col='blue')
           abline(v=38,col='blue')
           abline(v=51,col='blue')
           }
         else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(spike),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(spike),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(spike),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(spike),lab="Wn",col='blue')
           }
         }
       plot(x=period,y=mbw,xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=paste("Mean Body Mass (",x$Properties$Units[3],")",sep=""),axes=FALSE, pch=19)
       axis(side=1,at=seq(head(period,1),tail(period,1),1))
       axis(side=2,at=NULL)
       if(hem=="N")
         {
          if(tstep=="day")
            {
            text(x=079+10,y=0.9*max(mbw),lab="Spring",col='blue')
            text(x=171+10,y=0.9*max(mbw),lab="Summer",col='blue')
            text(x=263+10,y=0.9*max(mbw),lab="Fall",col='blue')
            text(x=354+10,y=0.9*max(mbw),lab="Winter",col='blue')
            abline(v=079,col='blue')
            abline(v=171,col='blue')
            abline(v=263,col='blue')
            abline(v=354,col='blue')
            }
          else if(tstep=="week")
            {
            text(x=12+2,y=0.9*max(mbw),lab="Spring",col='blue')
            text(x=25+2,y=0.9*max(mbw),lab="Summer",col='blue')
            text(x=38+2,y=0.9*max(mbw),lab="Fall",col='blue')
            text(x=51+2,y=0.9*max(mbw),lab="Winter",col='blue')
            abline(v=12,col='blue')
            abline(v=25,col='blue')
            abline(v=38,col='blue')
            abline(v=51,col='blue')
            }
          else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(mbw),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(mbw),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(mbw),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(mbw),lab="Wn",col='blue')
           }
         }
       else
         {
         if(tstep=="day")
           {
           text(x=079+10,y=0.9*max(mbw),lab="Fall",col='blue')
           text(x=171+10,y=0.9*max(mbw),lab="Winter",col='blue')
           text(x=263+10,y=0.9*max(mbw),lab="Spring",col='blue')
           text(x=354+10,y=0.9*max(mbw),lab="Summer",col='blue')
           abline(v=079,col='blue')
           abline(v=171,col='blue')
           abline(v=263,col='blue')
           abline(v=354,col='blue')
           }
         else if(tstep=="week")
           {
           text(x=12+2,y=0.9*max(mbw),lab="Fall",col='blue')
           text(x=25+2,y=0.9*max(mbw),lab="Winter",col='blue')
           text(x=38+2,y=0.9*max(mbw),lab="Spring",col='blue')
           text(x=51+2,y=0.9*max(mbw),lab="Summer",col='blue')
           abline(v=12,col='blue')
           abline(v=25,col='blue')
           abline(v=38,col='blue')
           abline(v=51,col='blue')
           }
         else
           {
           text(x=seq(4,tail(period,1),12),y=0.9*max(mbw),lab="Sp",col='blue')
           text(x=seq(7,tail(period,1),12),y=0.9*max(mbw),lab="Sm",col='blue')
           text(x=seq(10,tail(period,1),12),y=0.9*max(mbw),lab="Fl",col='blue')
           text(x=seq(1,tail(period,1),12),y=0.9*max(mbw),lab="Wn",col='blue')
           }
         }
       mtext(side=3,outer=TRUE,text=x$Properties$Fleets$Fleet[i])
       devAskNewPage(ask=TRUE)
       }
    devAskNewPage(ask=FALSE)
    }
#
########################       III MODEL TYPE FUNCTIONS     ####################
#
###################################   One Fleet   ##############################
#
################################   Resident Stock   ############################
#
.CDMN0P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=0,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale  <- par[3];
                  logalpha  <- par[4];
                  logbeta   <- par[5];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                    mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                    nstep[i] <- exp(logN0)*exp(-exp(logM)*i) - mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN1P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=1,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logscale  <- par[4];
                  logalpha  <- par[5];
                  logbeta   <- par[6];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                    mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                    nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) -
                                mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN2P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=2,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logscale  <- par[5];
                  logalpha  <- par[6];
                  logbeta   <- par[7];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                    mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                    nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) -
                                mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN3P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=3,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                   ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logscale  <- par[6];
                  logalpha  <- par[7];
                  logbeta   <- par[8];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen){
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN4P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=4,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logscale  <- par[7];
                  logalpha  <- par[8];
                  logbeta   <- par[9];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN5P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=5,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logscale  <- par[8];
                  logalpha  <- par[9];
                  logbeta   <- par[10];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN6P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=6,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logscale  <- par[9];
                  logalpha  <- par[10];
                  logbeta   <- par[11];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN7P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=7,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logscale  <- par[10];
                  logalpha  <- par[11];
                  logbeta   <- par[12];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN8P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=8,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logscale  <- par[11];
                  logalpha  <- par[12];
                  logbeta   <- par[13];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN9P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=9,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logscale  <- par[12];
                  logalpha  <- par[13];
                  logbeta   <- par[14];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN10P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=10,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logscale  <- par[13];
                  logalpha  <- par[14];
                  logbeta   <- par[15];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN11P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=11,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logscale  <- par[14];
                  logalpha  <- par[15];
                  logbeta   <- par[16];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN12P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=12,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logscale  <- par[15];
                  logalpha  <- par[16];
                  logbeta   <- par[17];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN13P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=13,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logscale  <- par[16];
                  logalpha  <- par[17];
                  logbeta   <- par[18];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN14P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=14,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logscale  <- par[17];
                  logalpha  <- par[18];
                  logbeta   <- par[19];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN15P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=15,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logscale  <- par[18];
                  logalpha  <- par[19];
                  logbeta   <- par[20];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN16P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=16,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logscale  <- par[19];
                  logalpha  <- par[20];
                  logbeta   <- par[21];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN17P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=17,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logscale  <- par[20];
                  logalpha  <- par[21];
                  logbeta   <- par[22];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN18P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=18,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logscale  <- par[21];
                  logalpha  <- par[22];
                  logbeta   <- par[23];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN19P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=19,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logscale  <- par[22];
                  logalpha  <- par[23];
                  logbeta   <- par[24];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN20P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=20,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logscale  <- par[23];
                  logalpha  <- par[24];
                  logbeta   <- par[25];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN21P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=21,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.P21    <- dates[22];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logP21    <- par[23];
                  logscale  <- par[24];
                  logalpha  <- par[25];
                  logbeta   <- par[26];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN22P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=22,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.P21    <- dates[22];
                  ts.P22    <- dates[23];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logP21    <- par[23];
                  logP22    <- par[24];
                  logscale  <- par[25];
                  logalpha  <- par[26];
                  logbeta   <- par[27];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start)+1)) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN23P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=23,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.P21    <- dates[22];
                  ts.P22    <- dates[23];
                  ts.P23    <- dates[24];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logP21    <- par[23];
                  logP22    <- par[24];
                  logP23    <- par[25];
                  logscale  <- par[26];
                  logalpha  <- par[27];
                  logbeta   <- par[28];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start)+1)) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start)+1)) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN24P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=24,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.P21    <- dates[22];
                  ts.P22    <- dates[23];
                  ts.P23    <- dates[24];
                  ts.P24    <- dates[25];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start), 0, 1);
                  ind.P24   <- ifelse(1:sealen < (ts.P24-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logP21    <- par[23];
                  logP22    <- par[24];
                  logP23    <- par[25];
                  logP24    <- par[26];
                  logscale  <- par[27];
                  logalpha  <- par[28];
                  logbeta   <- par[29];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start)+1)) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start)+1)) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start)+1)) +
                                 ind.P24[i]*exp(logP24)*exp(-exp(logM)*(i-(ts.P24-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMN25P       <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=25,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.P2     <- dates[3];
                  ts.P3     <- dates[4];
                  ts.P4     <- dates[5];
                  ts.P5     <- dates[6];
                  ts.P6     <- dates[7];
                  ts.P7     <- dates[8];
                  ts.P8     <- dates[9];
                  ts.P9     <- dates[10];
                  ts.P10    <- dates[11];
                  ts.P11    <- dates[12];
                  ts.P12    <- dates[13];
                  ts.P13    <- dates[14];
                  ts.P14    <- dates[15];
                  ts.P15    <- dates[16];
                  ts.P16    <- dates[17];
                  ts.P17    <- dates[18];
                  ts.P18    <- dates[19];
                  ts.P19    <- dates[20];
                  ts.P20    <- dates[21];
                  ts.P21    <- dates[22];
                  ts.P22    <- dates[23];
                  ts.P23    <- dates[24];
                  ts.P24    <- dates[25];
                  ts.P25    <- dates[26];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start), 0, 1);
                  ind.P24   <- ifelse(1:sealen < (ts.P24-ts.start), 0, 1);
                  ind.P25   <- ifelse(1:sealen < (ts.P25-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1     <- par[3];
                  logP2     <- par[4];
                  logP3     <- par[5];
                  logP4     <- par[6];
                  logP5     <- par[7];
                  logP6     <- par[8];
                  logP7     <- par[9];
                  logP8     <- par[10];
                  logP9     <- par[11];
                  logP10    <- par[12];
                  logP11    <- par[13];
                  logP12    <- par[14];
                  logP13    <- par[15];
                  logP14    <- par[16];
                  logP15    <- par[17];
                  logP16    <- par[18];
                  logP17    <- par[19];
                  logP18    <- par[20];
                  logP19    <- par[21];
                  logP20    <- par[22];
                  logP21    <- par[23];
                  logP22    <- par[24];
                  logP23    <- par[25];
                  logP24    <- par[26];
                  logP25    <- par[27];
                  logscale  <- par[28];
                  logalpha  <- par[29];
                  logbeta   <- par[30];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start)+1)) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start)+1)) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start)+1)) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start)+1)) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start)+1)) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start)+1)) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start)+1)) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start)+1)) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start)+1)) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start)+1)) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start)+1)) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start)+1)) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start)+1)) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start)+1)) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start)+1)) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start)+1)) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start)+1)) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start)+1)) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start)+1)) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start)+1)) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start)+1)) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start)+1)) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start)+1)) +
                                 ind.P24[i]*exp(logP24)*exp(-exp(logM)*(i-(ts.P24-ts.start)+1)) +
                                 ind.P25[i]*exp(logP25)*exp(-exp(logM)*(i-(ts.P25-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha));
                  effn1     <- nstep^(exp(logbeta));
                  predcat1  <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
#
############################    Transit Stock   ################################
# Idea to allow for part of PX to go out at time TS.NX - replace          #HERE
# logPX in line 3331 and start count of time to discount for M at ts.start
# Include parameter partial (logical) and if it is TRUE then par should include
# magnitudes of output alongside inputs - Applicable only if p < 1
.CDMNT1P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-1,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logscale  <- par[5];
                     logalpha  <- par[6];
                     logbeta   <- par[7];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logscale  <- par[4];
                     logalpha  <- par[5];
                     logbeta   <- par[6];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT2P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-2,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logscale  <- par[7];
                     logalpha  <- par[8];
                     logbeta   <- par[9];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logscale  <- par[5];
                     logalpha  <- par[6];
                     logbeta   <- par[7];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT3P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-3,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logscale  <- par[9];
                     logalpha  <- par[10];
                     logbeta   <- par[11];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logscale  <- par[6];
                     logalpha  <- par[7];
                     logbeta   <- par[8];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT4P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-4,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[6];
                     logQ3     <- par[7];
                     logP4     <- par[8];
                     logQ4     <- par[9];
                     logscale  <- par[10];
                     logalpha  <- par[11];
                     logbeta   <- par[12];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logscale  <- par[7];
                     logalpha  <- par[8];
                     logbeta   <- par[9];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT5P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-5,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10]
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logscale  <- par[13];
                     logalpha  <- par[14];
                     logbeta   <- par[15];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logscale  <- par[8];
                     logalpha  <- par[9];
                     logbeta   <- par[10];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT6P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-6,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logscale  <- par[15];
                     logalpha  <- par[16];
                     logbeta   <- par[17];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logscale  <- par[9];
                     logalpha  <- par[10];
                     logbeta   <- par[11];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT7P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-7,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logscale  <- par[17];
                     logalpha  <- par[18];
                     logbeta   <- par[19];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logscale  <- par[10];
                     logalpha  <- par[11];
                     logbeta   <- par[12];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT8P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-8,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logscale  <- par[19];
                     logalpha  <- par[20];
                     logbeta   <- par[21];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logscale  <- par[11];
                     logalpha  <- par[12];
                     logbeta   <- par[13];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] -
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT9P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-9,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logscale  <- par[21];
                     logalpha  <- par[22];
                     logbeta   <- par[23];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logscale  <- par[12];
                     logalpha  <- par[13];
                     logbeta   <- par[14];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT10P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-10,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logscale  <- par[23];
                     logalpha  <- par[24];
                     logbeta   <- par[25];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logscale  <- par[13];
                     logalpha  <- par[14];
                     logbeta   <- par[15];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT11P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-11,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10]
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logscale  <- par[25];
                     logalpha  <- par[26];
                     logbeta   <- par[27];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logscale  <- par[14];
                     logalpha  <- par[15];
                     logbeta   <- par[16];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP10+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT12P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-12,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logscale  <- par[27];
                     logalpha  <- par[28];
                     logbeta   <- par[29];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logscale  <- par[15];
                     logalpha  <- par[16];
                     logbeta   <- par[17];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT13P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-13,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logscale  <- par[29];
                     logalpha  <- par[30];
                     logbeta   <- par[31];
                     }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logscale  <- par[16];
                     logalpha  <- par[17];
                     logbeta   <- par[18];
                     }
                 mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT14P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-14,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ11    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logscale  <- par[31];
                     logalpha  <- par[32];
                     logbeta   <- par[33];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logscale  <- par[17];
                     logalpha  <- par[18];
                     logbeta   <- par[19];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT15P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-15,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logscale  <- par[33];
                     logalpha  <- par[34];
                     logbeta   <- par[35];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logscale  <- par[18];
                     logalpha  <- par[19];
                     logbeta   <- par[20];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT16P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-16,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logscale  <- par[35];
                     logalpha  <- par[36];
                     logbeta   <- par[37];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logscale  <- par[19];
                     logalpha  <- par[20];
                     logbeta   <- par[21];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) -
                                mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT17P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-17,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logscale  <- par[37];
                     logalpha  <- par[38];
                     logbeta   <- par[39];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logscale  <- par[20];
                     logalpha  <- par[21];
                     logbeta   <- par[22];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT18P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-18,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logscale  <- par[39];
                     logalpha  <- par[40];
                     logbeta   <- par[41];
                      }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logscale  <- par[21];
                     logalpha  <- par[22];
                     logbeta   <- par[23];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT19P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-19,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logscale  <- par[41];
                     logalpha  <- par[42];
                     logbeta   <- par[43];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logscale  <- par[22];
                     logalpha  <- par[23];
                     logbeta   <- par[24];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT20P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-20,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logscale  <- par[43];
                     logalpha  <- par[44];
                     logbeta   <- par[45];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logscale  <- par[23];
                     logalpha  <- par[24];
                     logbeta   <- par[25];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT21P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-21,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.P21    <- dates[42];
                  ts.N21    <- dates[43];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start+1), 0, 1);
                  ind.N21   <- ifelse(1:sealen < (ts.N21-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logP21    <- par[43];
                     logQ22    <- par[44];
                     logscale  <- par[45];
                     logalpha  <- par[46];
                     logbeta   <- par[47];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logP21    <- par[23];
                     logQ21    <- 1;
                     logscale  <- par[24];
                     logalpha  <- par[25];
                     logbeta   <- par[26];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1))) -
                                 ind.N21[i]*exp((1-partial)*logP21+(partial*logQ21))*exp(-exp(logM)*(i-((1-partial)*ts.P21+partial*ts.N21-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT22P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-22,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.P21    <- dates[42];
                  ts.N21    <- dates[43];
                  ts.P22    <- dates[44];
                  ts.N22    <- dates[45];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start+1), 0, 1);
                  ind.N21   <- ifelse(1:sealen < (ts.N21-ts.start+1), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start+1), 0, 1);
                  ind.N22   <- ifelse(1:sealen < (ts.N22-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ9     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logP21    <- par[43];
                     logQ21    <- par[44];
                     logP22    <- par[45];
                     logQ22    <- par[46];
                     logscale  <- par[47];
                     logalpha  <- par[48];
                     logbeta   <- par[49];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logP21    <- par[23];
                     logQ21    <- 1;
                     logP22    <- par[24];
                     logQ22    <- 1;
                     logscale  <- par[25];
                     logalpha  <- par[26];
                     logbeta   <- par[27];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start+1))) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1))) -
                                 ind.N21[i]*exp((1-partial)*logP21+(partial*logQ21))*exp(-exp(logM)*(i-((1-partial)*ts.P21+partial*ts.N21-ts.start+1))) -
                                 ind.N22[i]*exp((1-partial)*logP22+(partial*logQ22))*exp(-exp(logM)*(i-((1-partial)*ts.P22+partial*ts.N22-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT23P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-23,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.P21    <- dates[42];
                  ts.N21    <- dates[43];
                  ts.P22    <- dates[44];
                  ts.N22    <- dates[45];
                  ts.P23    <- dates[46];
                  ts.N23    <- dates[47];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start+1), 0, 1);
                  ind.N21   <- ifelse(1:sealen < (ts.N21-ts.start+1), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start+1), 0, 1);
                  ind.N22   <- ifelse(1:sealen < (ts.N22-ts.start+1), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start+1), 0, 1);
                  ind.N23   <- ifelse(1:sealen < (ts.N23-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logP21    <- par[43];
                     logQ21    <- par[44];
                     logP22    <- par[45];
                     logQ22    <- par[46];
                     logP23    <- par[47];
                     logQ23    <- par[48];
                     logscale  <- par[49];
                     logalpha  <- par[50];
                     logbeta   <- par[51];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logP21    <- par[23];
                     logQ21    <- 1;
                     logP22    <- par[24];
                     logQ22    <- 1;
                     logP23    <- par[25];
                     logQ23    <- 1;
                     logscale  <- par[26];
                     logalpha  <- par[27];
                     logbeta   <- par[28];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start+1))) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start+1))) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1))) -
                                 ind.N21[i]*exp((1-partial)*logP21+(partial*logQ21))*exp(-exp(logM)*(i-((1-partial)*ts.P21+partial*ts.N21-ts.start+1))) -
                                 ind.N22[i]*exp((1-partial)*logP22+(partial*logQ22))*exp(-exp(logM)*(i-((1-partial)*ts.P22+partial*ts.N22-ts.start+1))) -
                                 ind.N23[i]*exp((1-partial)*logP23+(partial*logQ23))*exp(-exp(logM)*(i-((1-partial)*ts.P23+partial*ts.N23-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT24P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-24,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.P21    <- dates[42];
                  ts.N21    <- dates[43];
                  ts.P22    <- dates[44];
                  ts.N22    <- dates[45];
                  ts.P23    <- dates[46];
                  ts.N23    <- dates[47];
                  ts.P24    <- dates[48];
                  ts.N24    <- dates[49];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start+1), 0, 1);
                  ind.N21   <- ifelse(1:sealen < (ts.N21-ts.start+1), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start+1), 0, 1);
                  ind.N22   <- ifelse(1:sealen < (ts.N22-ts.start+1), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start+1), 0, 1);
                  ind.N23   <- ifelse(1:sealen < (ts.N23-ts.start+1), 0, 1);
                  ind.P24   <- ifelse(1:sealen < (ts.P24-ts.start+1), 0, 1);
                  ind.N24   <- ifelse(1:sealen < (ts.N24-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logP21    <- par[43];
                     logQ21    <- par[44];
                     logP22    <- par[45];
                     logQ22    <- par[46];
                     logP23    <- par[47];
                     logQ23    <- par[48];
                     logP24    <- par[49];
                     logQ24    <- par[50];
                     logscale  <- par[51];
                     logalpha  <- par[52];
                     logbeta   <- par[53];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logP21    <- par[23];
                     logQ21    <- 1;
                     logP22    <- par[24];
                     logQ22    <- 1;
                     logP23    <- par[25];
                     logQ23    <- 1;
                     logP24    <- par[26];
                     logQ24    <- 1;
                     logscale  <- par[27];
                     logalpha  <- par[28];
                     logbeta   <- par[29];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start+1))) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start+1))) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start+1))) +
                                 ind.P24[i]*exp(logP24)*exp(-exp(logM)*(i-(ts.P24-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1))) -
                                 ind.N21[i]*exp((1-partial)*logP21+(partial*logQ21))*exp(-exp(logM)*(i-((1-partial)*ts.P21+partial*ts.N21-ts.start+1))) -
                                 ind.N22[i]*exp((1-partial)*logP22+(partial*logQ22))*exp(-exp(logM)*(i-((1-partial)*ts.P22+partial*ts.N22-ts.start+1))) -
                                 ind.N23[i]*exp((1-partial)*logP23+(partial*logQ23))*exp(-exp(logM)*(i-((1-partial)*ts.P23+partial*ts.N23-ts.start+1))) -
                                 ind.N24[i]*exp((1-partial)*logP24+(partial*logQ24))*exp(-exp(logM)*(i-((1-partial)*ts.P24+partial*ts.N24-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
.CDMNT25P <- function(par,dates,obscat1,obseff1,obsmbm1,distr,properties,output,pp=-25,partial)
  {
                  ts.start  <- head(dates,1);
                  ts.P1     <- dates[2];
                  ts.N1     <- dates[3];
                  ts.P2     <- dates[4];
                  ts.N2     <- dates[5];
                  ts.P3     <- dates[6];
                  ts.N3     <- dates[7];
                  ts.P4     <- dates[8];
                  ts.N4     <- dates[9];
                  ts.P5     <- dates[10];
                  ts.N5     <- dates[11];
                  ts.P6     <- dates[12];
                  ts.N6     <- dates[13];
                  ts.P7     <- dates[14];
                  ts.N7     <- dates[15];
                  ts.P8     <- dates[16];
                  ts.N8     <- dates[17];
                  ts.P9     <- dates[18];
                  ts.N9     <- dates[19];
                  ts.P10    <- dates[20];
                  ts.N10    <- dates[21];
                  ts.P11    <- dates[22];
                  ts.N11    <- dates[23];
                  ts.P12    <- dates[24];
                  ts.N12    <- dates[25];
                  ts.P13    <- dates[26];
                  ts.N13    <- dates[27];
                  ts.P14    <- dates[28];
                  ts.N14    <- dates[29];
                  ts.P15    <- dates[30];
                  ts.N15    <- dates[31];
                  ts.P16    <- dates[32];
                  ts.N16    <- dates[33];
                  ts.P17    <- dates[34];
                  ts.N17    <- dates[35];
                  ts.P18    <- dates[36];
                  ts.N18    <- dates[37];
                  ts.P19    <- dates[38];
                  ts.N19    <- dates[39];
                  ts.P20    <- dates[40];
                  ts.N20    <- dates[41];
                  ts.P21    <- dates[42];
                  ts.N21    <- dates[43];
                  ts.P22    <- dates[44];
                  ts.N22    <- dates[45];
                  ts.P23    <- dates[46];
                  ts.N23    <- dates[47];
                  ts.P24    <- dates[48];
                  ts.N24    <- dates[49];
                  ts.P25    <- dates[50];
                  ts.N25    <- dates[51];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  resn1     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind.P1    <- ifelse(1:sealen < (ts.P1-ts.start+1), 0, 1);
                  ind.N1    <- ifelse(1:sealen < (ts.N1-ts.start+1), 0, 1);
                  ind.P2    <- ifelse(1:sealen < (ts.P2-ts.start+1), 0, 1);
                  ind.N2    <- ifelse(1:sealen < (ts.N2-ts.start+1), 0, 1);
                  ind.P3    <- ifelse(1:sealen < (ts.P3-ts.start+1), 0, 1);
                  ind.N3    <- ifelse(1:sealen < (ts.N3-ts.start+1), 0, 1);
                  ind.P4    <- ifelse(1:sealen < (ts.P4-ts.start+1), 0, 1);
                  ind.N4    <- ifelse(1:sealen < (ts.N4-ts.start+1), 0, 1);
                  ind.P5    <- ifelse(1:sealen < (ts.P5-ts.start+1), 0, 1);
                  ind.N5    <- ifelse(1:sealen < (ts.N5-ts.start+1), 0, 1);
                  ind.P6    <- ifelse(1:sealen < (ts.P6-ts.start+1), 0, 1);
                  ind.N6    <- ifelse(1:sealen < (ts.N6-ts.start+1), 0, 1);
                  ind.P7    <- ifelse(1:sealen < (ts.P7-ts.start+1), 0, 1);
                  ind.N7    <- ifelse(1:sealen < (ts.N7-ts.start+1), 0, 1);
                  ind.P8    <- ifelse(1:sealen < (ts.P8-ts.start+1), 0, 1);
                  ind.N8    <- ifelse(1:sealen < (ts.N8-ts.start+1), 0, 1);
                  ind.P9    <- ifelse(1:sealen < (ts.P9-ts.start+1), 0, 1);
                  ind.N9    <- ifelse(1:sealen < (ts.N9-ts.start+1), 0, 1);
                  ind.P10   <- ifelse(1:sealen < (ts.P10-ts.start+1), 0, 1);
                  ind.N10   <- ifelse(1:sealen < (ts.N10-ts.start+1), 0, 1);
                  ind.P11   <- ifelse(1:sealen < (ts.P11-ts.start+1), 0, 1);
                  ind.N11   <- ifelse(1:sealen < (ts.N11-ts.start+1), 0, 1);
                  ind.P12   <- ifelse(1:sealen < (ts.P12-ts.start+1), 0, 1);
                  ind.N12   <- ifelse(1:sealen < (ts.N12-ts.start+1), 0, 1);
                  ind.P13   <- ifelse(1:sealen < (ts.P13-ts.start+1), 0, 1);
                  ind.N13   <- ifelse(1:sealen < (ts.N13-ts.start+1), 0, 1);
                  ind.P14   <- ifelse(1:sealen < (ts.P14-ts.start+1), 0, 1);
                  ind.N14   <- ifelse(1:sealen < (ts.N14-ts.start+1), 0, 1);
                  ind.P15   <- ifelse(1:sealen < (ts.P15-ts.start+1), 0, 1);
                  ind.N15   <- ifelse(1:sealen < (ts.N15-ts.start+1), 0, 1);
                  ind.P16   <- ifelse(1:sealen < (ts.P16-ts.start+1), 0, 1);
                  ind.N16   <- ifelse(1:sealen < (ts.N16-ts.start+1), 0, 1);
                  ind.P17   <- ifelse(1:sealen < (ts.P17-ts.start+1), 0, 1);
                  ind.N17   <- ifelse(1:sealen < (ts.N17-ts.start+1), 0, 1);
                  ind.P18   <- ifelse(1:sealen < (ts.P18-ts.start+1), 0, 1);
                  ind.N18   <- ifelse(1:sealen < (ts.N18-ts.start+1), 0, 1);
                  ind.P19   <- ifelse(1:sealen < (ts.P19-ts.start+1), 0, 1);
                  ind.N19   <- ifelse(1:sealen < (ts.N19-ts.start+1), 0, 1);
                  ind.P20   <- ifelse(1:sealen < (ts.P20-ts.start+1), 0, 1);
                  ind.N20   <- ifelse(1:sealen < (ts.N20-ts.start+1), 0, 1);
                  ind.P21   <- ifelse(1:sealen < (ts.P21-ts.start+1), 0, 1);
                  ind.N21   <- ifelse(1:sealen < (ts.N21-ts.start+1), 0, 1);
                  ind.P22   <- ifelse(1:sealen < (ts.P22-ts.start+1), 0, 1);
                  ind.N22   <- ifelse(1:sealen < (ts.N22-ts.start+1), 0, 1);
                  ind.P23   <- ifelse(1:sealen < (ts.P23-ts.start+1), 0, 1);
                  ind.N23   <- ifelse(1:sealen < (ts.N23-ts.start+1), 0, 1);
                  ind.P24   <- ifelse(1:sealen < (ts.P24-ts.start+1), 0, 1);
                  ind.N24   <- ifelse(1:sealen < (ts.N24-ts.start+1), 0, 1);
                  ind.P25   <- ifelse(1:sealen < (ts.P25-ts.start+1), 0, 1);
                  ind.N25   <- ifelse(1:sealen < (ts.N25-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  if(partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- par[4];
                     logP2     <- par[5];
                     logQ2     <- par[6];
                     logP3     <- par[7];
                     logQ3     <- par[8];
                     logP4     <- par[9];
                     logQ4     <- par[10];
                     logP5     <- par[11];
                     logQ5     <- par[12];
                     logP6     <- par[13];
                     logQ6     <- par[14];
                     logP7     <- par[15];
                     logQ7     <- par[16];
                     logP8     <- par[17];
                     logQ8     <- par[18];
                     logP9     <- par[19];
                     logQ9     <- par[20];
                     logP10    <- par[21];
                     logQ10    <- par[22];
                     logP11    <- par[23];
                     logQ11    <- par[24];
                     logP12    <- par[25];
                     logQ12    <- par[26];
                     logP13    <- par[27];
                     logQ13    <- par[28];
                     logP14    <- par[29];
                     logQ14    <- par[30];
                     logP15    <- par[31];
                     logQ15    <- par[32];
                     logP16    <- par[33];
                     logQ16    <- par[34];
                     logP17    <- par[35];
                     logQ17    <- par[36];
                     logP18    <- par[37];
                     logQ18    <- par[38];
                     logP19    <- par[39];
                     logQ19    <- par[40];
                     logP20    <- par[41];
                     logQ20    <- par[42];
                     logP21    <- par[43];
                     logQ21    <- par[44];
                     logP22    <- par[45];
                     logQ22    <- par[46];
                     logP23    <- par[47];
                     logQ23    <- par[48];
                     logP24    <- par[49];
                     logQ24    <- par[50];
                     logQ25    <- par[51];
                     logscale  <- par[52];
                     logalpha  <- par[53];
                     logbeta   <- par[54];
                    }
                  if(!partial)
                    {
                     logP1     <- par[3];
                     logQ1     <- 1;
                     logP2     <- par[4];
                     logQ2     <- 1;
                     logP3     <- par[5];
                     logQ3     <- 1;
                     logP4     <- par[6];
                     logQ4     <- 1;
                     logP5     <- par[7];
                     logQ5     <- 1;
                     logP6     <- par[8];
                     logQ6     <- 1;
                     logP7     <- par[9];
                     logQ7     <- 1;
                     logP8     <- par[10];
                     logQ8     <- 1;
                     logP9     <- par[11];
                     logQ9     <- 1;
                     logP10    <- par[12];
                     logQ10    <- 1;
                     logP11    <- par[13];
                     logQ11    <- 1;
                     logP12    <- par[14];
                     logQ12    <- 1;
                     logP13    <- par[15];
                     logQ13    <- 1;
                     logP14    <- par[16];
                     logQ14    <- 1;
                     logP15    <- par[17];
                     logQ15    <- 1;
                     logP16    <- par[18];
                     logQ16    <- 1;
                     logP17    <- par[19];
                     logQ17    <- 1;
                     logP18    <- par[20];
                     logQ18    <- 1;
                     logP19    <- par[21];
                     logQ19    <- 1;
                     logP20    <- par[22];
                     logQ20    <- 1;
                     logP21    <- par[23];
                     logQ21    <- 1;
                     logP22    <- par[24];
                     logQ22    <- 1;
                     logP23    <- par[25];
                     logQ23    <- 1;
                     logP24    <- par[26];
                     logQ24    <- 1;
                     logP25    <- par[27];
                     logQ25    <- 1;
                     logscale  <- par[28];
                     logalpha  <- par[29];
                     logbeta   <- par[30];
                    }
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  resn1[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind.P1[i]*exp(logP1)*exp(-exp(logM)*(i-(ts.P1-ts.start+1))) +
                                 ind.P2[i]*exp(logP2)*exp(-exp(logM)*(i-(ts.P2-ts.start+1))) +
                                 ind.P3[i]*exp(logP3)*exp(-exp(logM)*(i-(ts.P3-ts.start+1))) +
                                 ind.P4[i]*exp(logP4)*exp(-exp(logM)*(i-(ts.P4-ts.start+1))) +
                                 ind.P5[i]*exp(logP5)*exp(-exp(logM)*(i-(ts.P5-ts.start+1))) +
                                 ind.P6[i]*exp(logP6)*exp(-exp(logM)*(i-(ts.P6-ts.start+1))) +
                                 ind.P7[i]*exp(logP7)*exp(-exp(logM)*(i-(ts.P7-ts.start+1))) +
                                 ind.P8[i]*exp(logP8)*exp(-exp(logM)*(i-(ts.P8-ts.start+1))) +
                                 ind.P9[i]*exp(logP9)*exp(-exp(logM)*(i-(ts.P9-ts.start+1))) +
                                 ind.P10[i]*exp(logP10)*exp(-exp(logM)*(i-(ts.P10-ts.start+1))) +
                                 ind.P11[i]*exp(logP11)*exp(-exp(logM)*(i-(ts.P11-ts.start+1))) +
                                 ind.P12[i]*exp(logP12)*exp(-exp(logM)*(i-(ts.P12-ts.start+1))) +
                                 ind.P13[i]*exp(logP13)*exp(-exp(logM)*(i-(ts.P13-ts.start+1))) +
                                 ind.P14[i]*exp(logP14)*exp(-exp(logM)*(i-(ts.P14-ts.start+1))) +
                                 ind.P15[i]*exp(logP15)*exp(-exp(logM)*(i-(ts.P15-ts.start+1))) +
                                 ind.P16[i]*exp(logP16)*exp(-exp(logM)*(i-(ts.P16-ts.start+1))) +
                                 ind.P17[i]*exp(logP17)*exp(-exp(logM)*(i-(ts.P17-ts.start+1))) +
                                 ind.P18[i]*exp(logP18)*exp(-exp(logM)*(i-(ts.P18-ts.start+1))) +
                                 ind.P19[i]*exp(logP19)*exp(-exp(logM)*(i-(ts.P19-ts.start+1))) +
                                 ind.P20[i]*exp(logP20)*exp(-exp(logM)*(i-(ts.P20-ts.start+1))) +
                                 ind.P21[i]*exp(logP21)*exp(-exp(logM)*(i-(ts.P21-ts.start+1))) +
                                 ind.P22[i]*exp(logP22)*exp(-exp(logM)*(i-(ts.P22-ts.start+1))) +
                                 ind.P23[i]*exp(logP23)*exp(-exp(logM)*(i-(ts.P23-ts.start+1))) +
                                 ind.P24[i]*exp(logP24)*exp(-exp(logM)*(i-(ts.P24-ts.start+1))) +
                                 ind.P25[i]*exp(logP25)*exp(-exp(logM)*(i-(ts.P25-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                     resn1[i] <- nstep[i] - 
                                 ind.N1[i]*exp((1-partial)*logP1+(partial*logQ1))*exp(-exp(logM)*(i-((1-partial)*ts.P1+partial*ts.N1-ts.start+1))) -
                                 ind.N2[i]*exp((1-partial)*logP2+(partial*logQ2))*exp(-exp(logM)*(i-((1-partial)*ts.P2+partial*ts.N2-ts.start+1))) -
                                 ind.N3[i]*exp((1-partial)*logP3+(partial*logQ3))*exp(-exp(logM)*(i-((1-partial)*ts.P3+partial*ts.N3-ts.start+1))) -
                                 ind.N4[i]*exp((1-partial)*logP4+(partial*logQ4))*exp(-exp(logM)*(i-((1-partial)*ts.P4+partial*ts.N4-ts.start+1))) -
                                 ind.N5[i]*exp((1-partial)*logP5+(partial*logQ5))*exp(-exp(logM)*(i-((1-partial)*ts.P5+partial*ts.N5-ts.start+1))) -
                                 ind.N6[i]*exp((1-partial)*logP6+(partial*logQ6))*exp(-exp(logM)*(i-((1-partial)*ts.P6+partial*ts.N6-ts.start+1))) -
                                 ind.N7[i]*exp((1-partial)*logP7+(partial*logQ7))*exp(-exp(logM)*(i-((1-partial)*ts.P7+partial*ts.N7-ts.start+1))) -
                                 ind.N8[i]*exp((1-partial)*logP8+(partial*logQ8))*exp(-exp(logM)*(i-((1-partial)*ts.P8+partial*ts.N8-ts.start+1))) -
                                 ind.N9[i]*exp((1-partial)*logP9+(partial*logQ9))*exp(-exp(logM)*(i-((1-partial)*ts.P9+partial*ts.N9-ts.start+1))) -
                                 ind.N10[i]*exp((1-partial)*logP10+(partial*logQ10))*exp(-exp(logM)*(i-((1-partial)*ts.P10+partial*ts.N10-ts.start+1))) -
                                 ind.N11[i]*exp((1-partial)*logP11+(partial*logQ11))*exp(-exp(logM)*(i-((1-partial)*ts.P11+partial*ts.N11-ts.start+1))) -
                                 ind.N12[i]*exp((1-partial)*logP12+(partial*logQ12))*exp(-exp(logM)*(i-((1-partial)*ts.P12+partial*ts.N12-ts.start+1))) -
                                 ind.N13[i]*exp((1-partial)*logP13+(partial*logQ13))*exp(-exp(logM)*(i-((1-partial)*ts.P13+partial*ts.N13-ts.start+1))) -
                                 ind.N14[i]*exp((1-partial)*logP14+(partial*logQ14))*exp(-exp(logM)*(i-((1-partial)*ts.P14+partial*ts.N14-ts.start+1))) -
                                 ind.N15[i]*exp((1-partial)*logP15+(partial*logQ15))*exp(-exp(logM)*(i-((1-partial)*ts.P15+partial*ts.N15-ts.start+1))) -
                                 ind.N16[i]*exp((1-partial)*logP16+(partial*logQ16))*exp(-exp(logM)*(i-((1-partial)*ts.P16+partial*ts.N16-ts.start+1))) -
                                 ind.N17[i]*exp((1-partial)*logP17+(partial*logQ17))*exp(-exp(logM)*(i-((1-partial)*ts.P17+partial*ts.N17-ts.start+1))) -
                                 ind.N18[i]*exp((1-partial)*logP18+(partial*logQ18))*exp(-exp(logM)*(i-((1-partial)*ts.P18+partial*ts.N18-ts.start+1))) -
                                 ind.N19[i]*exp((1-partial)*logP19+(partial*logQ19))*exp(-exp(logM)*(i-((1-partial)*ts.P19+partial*ts.N19-ts.start+1))) -
                                 ind.N20[i]*exp((1-partial)*logP20+(partial*logQ20))*exp(-exp(logM)*(i-((1-partial)*ts.P20+partial*ts.N20-ts.start+1))) -
                                 ind.N21[i]*exp((1-partial)*logP21+(partial*logQ21))*exp(-exp(logM)*(i-((1-partial)*ts.P21+partial*ts.N21-ts.start+1))) -
                                 ind.N22[i]*exp((1-partial)*logP22+(partial*logQ22))*exp(-exp(logM)*(i-((1-partial)*ts.P22+partial*ts.N22-ts.start+1))) -
                                 ind.N23[i]*exp((1-partial)*logP23+(partial*logQ23))*exp(-exp(logM)*(i-((1-partial)*ts.P23+partial*ts.N23-ts.start+1))) -
                                 ind.N24[i]*exp((1-partial)*logP24+(partial*logQ24))*exp(-exp(logM)*(i-((1-partial)*ts.P24+partial*ts.N24-ts.start+1))) -
                                 ind.N25[i]*exp((1-partial)*logP25+(partial*logQ25))*exp(-exp(logM)*(i-((1-partial)*ts.P25+partial*ts.N25-ts.start+1)));
                    }
                  effeff1  <- obseff1^(exp(logalpha));
                  effn1    <- resn1^(exp(logbeta));
                  predcat1 <- exp(logscale)*(effeff1*effn1)*exp(-exp(logM)/2);
                  Likel    <- .CatDynLik1F(obscat1,predcat1,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp1F.Res(properties,nstep,obsmbm1,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr == "apnormal" | distr == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]]));
                       }
                     else
                       {
                        negsup <- -sum(Likel[["Likelihood"]]);
                       }
                     return(negsup);
                    }
 }
#
##################################### Two Fleets ###############################
#
#################################   Resident Stock   ###########################
#
.CDMN0P0P<- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,0),partial)
  {

                  ts.start  <- head(dates,1);
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logscale2 <- par[6];
                  logalpha2 <- par[7];
                  logbeta2  <- par[8];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] +mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) - mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN0P1P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,1),partial)
  {
                  ts.start  <- head(dates,1);
                  ts2.P1    <- dates[2];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logP1F2   <- par[6];
                  logscale2 <- par[7];
                  logalpha2 <- par[8];
                  logbeta2  <- par[9];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN0P2P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,2),partial)
  {
                  ts.start  <- head(dates,1);
                  ts2.P1    <- dates[2];
                  ts2.P2    <- dates[3];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logP1F2   <- par[6];
                  logP2F2   <- par[7];
                  logscale2 <- par[8];
                  logalpha2 <- par[9];
                  logbeta2  <- par[10];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN0P3P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,3),partial)
  {
                  ts.start  <- head(dates,1);
                  ts2.P1    <- dates[2];
                  ts2.P2    <- dates[3];
                  ts2.P3    <- dates[4];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logP1F2   <- par[6];
                  logP2F2   <- par[7];
                  logP3F2   <- par[8];
                  logscale2 <- par[9];
                  logalpha2 <- par[10];
                  logbeta2  <- par[11];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN0P4P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,4),partial)
  {
                  ts.start  <- head(dates,1);
                  ts2.P1    <- dates[2];
                  ts2.P2    <- dates[3];
                  ts2.P3    <- dates[4];
                  ts2.P4    <- dates[5];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logP1F2   <- par[6];
                  logP2F2   <- par[7];
                  logP3F2   <- par[8];
                  logP4F2   <- par[9];
                  logscale2 <- par[10];
                  logalpha2 <- par[11];
                  logbeta2  <- par[12];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN0P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(0,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts2.P1    <- dates[2];
                  ts2.P2    <- dates[3];
                  ts2.P3    <- dates[4];
                  ts2.P4    <- dates[5];
                  ts2.P5    <- dates[6];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logscale1 <- par[3];
                  logalpha1 <- par[4];
                  logbeta1  <- par[5];
                  logP1F2   <- par[6];
                  logP2F2   <- par[7];
                  logP3F2   <- par[8];
                  logP4F2   <- par[9];
                  logP5F2   <- par[10];
                  logscale2 <- par[11];
                  logalpha2 <- par[12];
                  logbeta2  <- par[13];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN1P1P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(1,1),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts2.P1    <- dates[3];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start+1), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start+1), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logscale1 <- par[4];
                  logalpha1 <- par[5];
                  logbeta1  <- par[6];
                  logP1F2   <- par[7];
                  logscale2 <- par[8];
                  logalpha2 <- par[9];
                  logbeta2  <- par[10];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start+1))) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start+1))) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN1P2P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(1,2),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts2.P1    <- dates[3];
                  ts2.P2    <- dates[4];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logscale1 <- par[4];
                  logalpha1 <- par[5];
                  logbeta1  <- par[6];
                  logP1F2   <- par[7];
                  logP2F2   <- par[8];
                  logscale2 <- par[9];
                  logalpha2 <- par[10];
                  logbeta2  <- par[11];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN1P3P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(1,3),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts2.P1    <- dates[3];
                  ts2.P2    <- dates[4];
                  ts2.P3    <- dates[5];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logscale1 <- par[4];
                  logalpha1 <- par[5];
                  logbeta1  <- par[6];
                  logP1F2   <- par[7];
                  logP2F2   <- par[8];
                  logP3F2   <- par[9];
                  logscale2 <- par[10];
                  logalpha2 <- par[11];
                  logbeta2  <- par[12];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN1P4P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(1,4),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts2.P1    <- dates[3];
                  ts2.P2    <- dates[4];
                  ts2.P3    <- dates[5];
                  ts2.P4    <- dates[6];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logscale1 <- par[4];
                  logalpha1 <- par[5];
                  logbeta1  <- par[6];
                  logP1F2   <- par[7];
                  logP2F2   <- par[8];
                  logP3F2   <- par[9];
                  logP4F2   <- par[10];
                  logscale2 <- par[11];
                  logalpha2 <- par[12];
                  logbeta2  <- par[13];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN1P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(1,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts2.P1    <- dates[3];
                  ts2.P2    <- dates[4];
                  ts2.P3    <- dates[5];
                  ts2.P4    <- dates[6];
                  ts2.P5    <- dates[7];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logscale1 <- par[4];
                  logalpha1 <- par[5];
                  logbeta1  <- par[6];
                  logP1F2   <- par[7];
                  logP2F2   <- par[8];
                  logP3F2   <- par[9];
                  logP4F2   <- par[10];
                  logP5F2   <- par[11];
                  logscale2 <- par[12];
                  logalpha2 <- par[13];
                  logbeta2  <- par[14];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN2P2P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(2,2),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts2.P1    <- dates[4];
                  ts2.P2    <- dates[5];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logscale1 <- par[5];
                  logalpha1 <- par[6];
                  logbeta1  <- par[7];
                  logP1F2   <- par[8];
                  logP2F2   <- par[9];
                  logscale2 <- par[10];
                  logalpha2 <- par[11];
                  logbeta2  <- par[12];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN2P3P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(2,3),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts2.P1    <- dates[4];
                  ts2.P2    <- dates[5];
                  ts2.P3    <- dates[6];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logscale1 <- par[5];
                  logalpha1 <- par[6];
                  logbeta1  <- par[7];
                  logP1F2   <- par[8];
                  logP2F2   <- par[9];
                  logP3F2   <- par[10];
                  logscale2 <- par[11];
                  logalpha2 <- par[12];
                  logbeta2  <- par[13];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN2P4P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(2,4),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts2.P1    <- dates[4];
                  ts2.P2    <- dates[5];
                  ts2.P3    <- dates[6];
                  ts2.P4    <- dates[7];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logscale1 <- par[5];
                  logalpha1 <- par[6];
                  logbeta1  <- par[7];
                  logP1F2   <- par[8];
                  logP2F2   <- par[9];
                  logP3F2   <- par[10];
                  logP4F2   <- par[11];
                  logscale2 <- par[12];
                  logalpha2 <- par[13];
                  logbeta2  <- par[14];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN2P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(2,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts2.P1    <- dates[4];
                  ts2.P2    <- dates[5];
                  ts2.P3    <- dates[6];
                  ts2.P4    <- dates[7];
                  ts2.P5    <- dates[8];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logscale1 <- par[5];
                  logalpha1 <- par[6];
                  logbeta1  <- par[7];
                  logP1F2   <- par[8];
                  logP2F2   <- par[9];
                  logP3F2   <- par[10];
                  logP4F2   <- par[11];
                  logP5F2   <- par[12];
                  logscale2 <- par[13];
                  logalpha2 <- par[14];
                  logbeta2  <- par[15];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN3P3P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(3,3),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts2.P1    <- dates[5];
                  ts2.P2    <- dates[6];
                  ts2.P3    <- dates[7];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logscale1 <- par[6];
                  logalpha1 <- par[7];
                  logbeta1  <- par[8];
                  logP1F2   <- par[9];
                  logP2F2   <- par[10];
                  logP3F2   <- par[11];
                  logscale2 <- par[12];
                  logalpha2 <- par[13];
                  logbeta2  <- par[14];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                    {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                    }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN3P4P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(3,4),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts2.P1    <- dates[5];
                  ts2.P2    <- dates[6];
                  ts2.P3    <- dates[7];
                  ts2.P4    <- dates[8];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logscale1 <- par[6];
                  logalpha1 <- par[7];
                  logbeta1  <- par[8];
                  logP1F2   <- par[9];
                  logP2F2   <- par[10];
                  logP3F2   <- par[11];
                  logP4F2   <- par[12];
                  logscale2 <- par[13];
                  logalpha2 <- par[14];
                  logbeta2  <- par[15];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN3P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(3,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts2.P1    <- dates[5];
                  ts2.P2    <- dates[6];
                  ts2.P3    <- dates[7];
                  ts2.P4    <- dates[8];
                  ts2.P5    <- dates[9];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logscale1 <- par[6];
                  logalpha1 <- par[7];
                  logbeta1  <- par[8];
                  logP1F2   <- par[9];
                  logP2F2   <- par[10];
                  logP3F2   <- par[11];
                  logP4F2   <- par[12];
                  logP5F2   <- par[13];
                  logscale2 <- par[14];
                  logalpha2 <- par[15];
                  logbeta2  <- par[16];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN4P4P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(4,4),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts2.P1    <- dates[6];
                  ts2.P2    <- dates[7];
                  ts2.P3    <- dates[8];
                  ts2.P4    <- dates[9];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logscale1 <- par[7];
                  logalpha1 <- par[8];
                  logbeta1  <- par[9];
                  logP1F2   <- par[10];
                  logP2F2   <- par[11];
                  logP3F2   <- par[12];
                  logP4F2   <- par[13];
                  logscale2 <- par[14];
                  logalpha2 <- par[15];
                  logbeta2  <- par[16];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN4P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(4,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts2.P1    <- dates[6];
                  ts2.P2    <- dates[7];
                  ts2.P3    <- dates[8];
                  ts2.P4    <- dates[9];
                  ts2.P5    <- dates[10];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logscale1 <- par[7];
                  logalpha1 <- par[8];
                  logbeta1  <- par[9];
                  logP1F2   <- par[10];
                  logP2F2   <- par[11];
                  logP3F2   <- par[12];
                  logP4F2   <- par[13];
                  logP5F2   <- par[14];
                  logscale2 <- par[15];
                  logalpha2 <- par[16];
                  logbeta2  <- par[17];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN5P5P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(5,5),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts2.P1    <- dates[7];
                  ts2.P2    <- dates[8];
                  ts2.P3    <- dates[9];
                  ts2.P4    <- dates[10];
                  ts2.P5    <- dates[11];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logscale1 <- par[8];
                  logalpha1 <- par[9];
                  logbeta1  <- par[10];
                  logP1F2   <- par[11];
                  logP2F2   <- par[12];
                  logP3F2   <- par[13];
                  logP4F2   <- par[14];
                  logP5F2   <- par[15];
                  logscale2 <- par[16];
                  logalpha2 <- par[17];
                  logbeta2  <- par[18];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                  ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN6P6P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(6,6),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts2.P1    <- dates[8];
                  ts2.P2    <- dates[9];
                  ts2.P3    <- dates[10];
                  ts2.P4    <- dates[11];
                  ts2.P5    <- dates[12];
                  ts2.P6    <- dates[13];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logscale1 <- par[9];
                  logalpha1 <- par[10];
                  logbeta1  <- par[11];
                  logP1F2   <- par[12];
                  logP2F2   <- par[13];
                  logP3F2   <- par[14];
                  logP4F2   <- par[15];
                  logP5F2   <- par[16];
                  logP6F2   <- par[17];
                  logscale2 <- par[18];
                  logalpha2 <- par[19];
                  logbeta2  <- par[20];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                      mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                      nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                  ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                  ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                  ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                  ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                  ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                  ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                  ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                  ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                  ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                  ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                  ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                  ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) -
                                  mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN7P7P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(7,7),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts2.P1    <- dates[9];
                  ts2.P2    <- dates[10];
                  ts2.P3    <- dates[11];
                  ts2.P4    <- dates[12];
                  ts2.P5    <- dates[13];
                  ts2.P6    <- dates[14];
                  ts2.P7    <- dates[15];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logscale1 <- par[10];
                  logalpha1 <- par[11];
                  logbeta1  <- par[12];
                  logP1F2   <- par[13];
                  logP2F2   <- par[14];
                  logP3F2   <- par[15];
                  logP4F2   <- par[16];
                  logP5F2   <- par[17];
                  logP6F2   <- par[18];
                  logP7F2   <- par[19];
                  logscale2 <- par[20];
                  logalpha2 <- par[21];
                  logbeta2  <- par[22];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN8P8P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(8,8),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts2.P1    <- dates[10];
                  ts2.P2    <- dates[11];
                  ts2.P3    <- dates[12];
                  ts2.P4    <- dates[13];
                  ts2.P5    <- dates[14];
                  ts2.P6    <- dates[15];
                  ts2.P7    <- dates[16];
                  ts2.P8    <- dates[17];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logscale1 <- par[11];
                  logalpha1 <- par[12];
                  logbeta1  <- par[13];
                  logP1F2   <- par[14];
                  logP2F2   <- par[15];
                  logP3F2   <- par[16];
                  logP4F2   <- par[17];
                  logP5F2   <- par[18];
                  logP6F2   <- par[19];
                  logP7F2   <- par[20];
                  logP8F2   <- par[21];
                  logscale2 <- par[22];
                  logalpha2 <- par[23];
                  logbeta2  <- par[24];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN9P9P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(9,9),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts2.P1    <- dates[11];
                  ts2.P2    <- dates[12];
                  ts2.P3    <- dates[13];
                  ts2.P4    <- dates[14];
                  ts2.P5    <- dates[15];
                  ts2.P6    <- dates[16];
                  ts2.P7    <- dates[17];
                  ts2.P8    <- dates[18];
                  ts2.P9    <- dates[19];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logscale1 <- par[12];
                  logalpha1 <- par[13];
                  logbeta1  <- par[14];
                  logP1F2   <- par[15];
                  logP2F2   <- par[16];
                  logP3F2   <- par[17];
                  logP4F2   <- par[18];
                  logP5F2   <- par[19];
                  logP6F2   <- par[20];
                  logP7F2   <- par[21];
                  logP8F2   <- par[22];
                  logP9F2   <- par[23];
                  logscale2 <- par[24];
                  logalpha2 <- par[25];
                  logbeta2  <- par[26];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN10P10P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(10,10),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts2.P1    <- dates[12];
                  ts2.P2    <- dates[13];
                  ts2.P3    <- dates[14];
                  ts2.P4    <- dates[15];
                  ts2.P5    <- dates[16];
                  ts2.P6    <- dates[17];
                  ts2.P7    <- dates[18];
                  ts2.P8    <- dates[19];
                  ts2.P9    <- dates[20];
                  ts2.P10   <- dates[21];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                   ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logscale1 <- par[13];
                  logalpha1 <- par[14];
                  logbeta1  <- par[15];
                  logP1F2   <- par[16];
                  logP2F2   <- par[17];
                  logP3F2   <- par[18];
                  logP4F2   <- par[19];
                  logP5F2   <- par[20];
                  logP6F2   <- par[21];
                  logP7F2   <- par[22];
                  logP8F2   <- par[23];
                  logP9F2   <- par[24];
                  logP10F2  <- par[25];
                  logscale2 <- par[26];
                  logalpha2 <- par[27];
                  logbeta2  <- par[28];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN11P11P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(11,11),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts2.P1    <- dates[13];
                  ts2.P2    <- dates[14];
                  ts2.P3    <- dates[15];
                  ts2.P4    <- dates[16];
                  ts2.P5    <- dates[17];
                  ts2.P6    <- dates[18];
                  ts2.P7    <- dates[19];
                  ts2.P8    <- dates[20];
                  ts2.P9    <- dates[21];
                  ts2.P10   <- dates[22];
                  ts2.P11   <- dates[23];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logscale1 <- par[14];
                  logalpha1 <- par[15];
                  logbeta1  <- par[16];
                  logP1F2   <- par[17];
                  logP2F2   <- par[18];
                  logP3F2   <- par[19];
                  logP4F2   <- par[20];
                  logP5F2   <- par[21];
                  logP6F2   <- par[22];
                  logP7F2   <- par[23];
                  logP8F2   <- par[24];
                  logP9F2   <- par[25];
                  logP10F2  <- par[26];
                  logP11F2  <- par[27];
                  logscale2 <- par[28];
                  logalpha2 <- par[29];
                  logbeta2  <- par[30];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN12P12P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(12,12),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts2.P1    <- dates[14];
                  ts2.P2    <- dates[15];
                  ts2.P3    <- dates[16];
                  ts2.P4    <- dates[17];
                  ts2.P5    <- dates[18];
                  ts2.P6    <- dates[19];
                  ts2.P7    <- dates[20];
                  ts2.P8    <- dates[21];
                  ts2.P9    <- dates[22];
                  ts2.P10   <- dates[23];
                  ts2.P11   <- dates[24];
                  ts2.P12   <- dates[25];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logscale1 <- par[15];
                  logalpha1 <- par[16];
                  logbeta1  <- par[17];
                  logP1F2   <- par[18];
                  logP2F2   <- par[19];
                  logP3F2   <- par[20];
                  logP4F2   <- par[21];
                  logP5F2   <- par[22];
                  logP6F2   <- par[23];
                  logP7F2   <- par[24];
                  logP8F2   <- par[25];
                  logP9F2   <- par[26];
                  logP10F2  <- par[27];
                  logP11F2  <- par[28];
                  logP12F2  <- par[29];
                  logscale2 <- par[30];
                  logalpha2 <- par[31];
                  logbeta2  <- par[32];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN13P13P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(13,13),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts2.P1    <- dates[15];
                  ts2.P2    <- dates[16];
                  ts2.P3    <- dates[17];
                  ts2.P4    <- dates[18];
                  ts2.P5    <- dates[19];
                  ts2.P6    <- dates[20];
                  ts2.P7    <- dates[21];
                  ts2.P8    <- dates[22];
                  ts2.P9    <- dates[23];
                  ts2.P10   <- dates[24];
                  ts2.P11   <- dates[25];
                  ts2.P12   <- dates[26];
                  ts2.P13   <- dates[27];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logscale1 <- par[16];
                  logalpha1 <- par[17];
                  logbeta1  <- par[18];
                  logP1F2   <- par[19];
                  logP2F2   <- par[20];
                  logP3F2   <- par[21];
                  logP4F2   <- par[22];
                  logP5F2   <- par[23];
                  logP6F2   <- par[24];
                  logP7F2   <- par[25];
                  logP8F2   <- par[26];
                  logP9F2   <- par[27];
                  logP10F2  <- par[28];
                  logP11F2  <- par[29];
                  logP12F2  <- par[30];
                  logP13F2  <- par[31];
                  logscale2 <- par[32];
                  logalpha2 <- par[33];
                  logbeta2  <- par[34];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN14P14P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(14,14),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts2.P1    <- dates[16];
                  ts2.P2    <- dates[17];
                  ts2.P3    <- dates[18];
                  ts2.P4    <- dates[19];
                  ts2.P5    <- dates[20];
                  ts2.P6    <- dates[21];
                  ts2.P7    <- dates[22];
                  ts2.P8    <- dates[23];
                  ts2.P9    <- dates[24];
                  ts2.P10   <- dates[25];
                  ts2.P11   <- dates[26];
                  ts2.P12   <- dates[27];
                  ts2.P13   <- dates[28];
                  ts2.P14   <- dates[29];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logscale1 <- par[17];
                  logalpha1 <- par[18];
                  logbeta1  <- par[19];
                  logP1F2   <- par[20];
                  logP2F2   <- par[21];
                  logP3F2   <- par[22];
                  logP4F2   <- par[23];
                  logP5F2   <- par[24];
                  logP6F2   <- par[25];
                  logP7F2   <- par[26];
                  logP8F2   <- par[27];
                  logP9F2   <- par[28];
                  logP10F2  <- par[29];
                  logP11F2  <- par[30];
                  logP12F2  <- par[31];
                  logP13F2  <- par[32];
                  logP14F2  <- par[33];
                  logscale2 <- par[34];
                  logalpha2 <- par[35];
                  logbeta2  <- par[36];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN15P15P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(15,15),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts2.P1    <- dates[17];
                  ts2.P2    <- dates[18];
                  ts2.P3    <- dates[19];
                  ts2.P4    <- dates[20];
                  ts2.P5    <- dates[21];
                  ts2.P6    <- dates[22];
                  ts2.P7    <- dates[23];
                  ts2.P8    <- dates[24];
                  ts2.P9    <- dates[25];
                  ts2.P10   <- dates[26];
                  ts2.P11   <- dates[27];
                  ts2.P12   <- dates[28];
                  ts2.P13   <- dates[29];
                  ts2.P14   <- dates[30];
                  ts2.P15   <- dates[31];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logscale1 <- par[18];
                  logalpha1 <- par[19];
                  logbeta1  <- par[20];
                  logP1F2   <- par[21];
                  logP2F2   <- par[22];
                  logP3F2   <- par[23];
                  logP4F2   <- par[24];
                  logP5F2   <- par[25];
                  logP6F2   <- par[26];
                  logP7F2   <- par[27];
                  logP8F2   <- par[28];
                  logP9F2   <- par[29];
                  logP10F2  <- par[30];
                  logP11F2  <- par[31];
                  logP12F2  <- par[32];
                  logP13F2  <- par[33];
                  logP14F2  <- par[34];
                  logP15F2  <- par[35];
                  logscale2 <- par[36];
                  logalpha2 <- par[37];
                  logbeta2  <- par[38];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN16P16P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(16,16),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts2.P1    <- dates[18];
                  ts2.P2    <- dates[19];
                  ts2.P3    <- dates[20];
                  ts2.P4    <- dates[21];
                  ts2.P5    <- dates[22];
                  ts2.P6    <- dates[23];
                  ts2.P7    <- dates[24];
                  ts2.P8    <- dates[25];
                  ts2.P9    <- dates[26];
                  ts2.P10   <- dates[27];
                  ts2.P11   <- dates[28];
                  ts2.P12   <- dates[29];
                  ts2.P13   <- dates[30];
                  ts2.P14   <- dates[31];
                  ts2.P15   <- dates[32];
                  ts2.P16   <- dates[33];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logscale1 <- par[19];
                  logalpha1 <- par[20];
                  logbeta1  <- par[21];
                  logP1F2   <- par[22];
                  logP2F2   <- par[23];
                  logP3F2   <- par[24];
                  logP4F2   <- par[25];
                  logP5F2   <- par[26];
                  logP6F2   <- par[27];
                  logP7F2   <- par[28];
                  logP8F2   <- par[29];
                  logP9F2   <- par[30];
                  logP10F2  <- par[31];
                  logP11F2  <- par[32];
                  logP12F2  <- par[33];
                  logP13F2  <- par[34];
                  logP14F2  <- par[35];
                  logP15F2  <- par[36];
                  logP16F2  <- par[37];
                  logscale2 <- par[38];
                  logalpha2 <- par[39];
                  logbeta2  <- par[40];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN17P17P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(17,17),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts2.P1    <- dates[19];
                  ts2.P2    <- dates[20];
                  ts2.P3    <- dates[21];
                  ts2.P4    <- dates[22];
                  ts2.P5    <- dates[23];
                  ts2.P6    <- dates[24];
                  ts2.P7    <- dates[25];
                  ts2.P8    <- dates[26];
                  ts2.P9    <- dates[27];
                  ts2.P10   <- dates[28];
                  ts2.P11   <- dates[29];
                  ts2.P12   <- dates[30];
                  ts2.P13   <- dates[31];
                  ts2.P14   <- dates[32];
                  ts2.P15   <- dates[33];
                  ts2.P16   <- dates[34];
                  ts2.P17   <- dates[35];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logscale1 <- par[20];
                  logalpha1 <- par[21];
                  logbeta1  <- par[22];
                  logP1F2   <- par[23];
                  logP2F2   <- par[24];
                  logP3F2   <- par[25];
                  logP4F2   <- par[26];
                  logP5F2   <- par[27];
                  logP6F2   <- par[28];
                  logP7F2   <- par[29];
                  logP8F2   <- par[30];
                  logP9F2   <- par[31];
                  logP10F2  <- par[32];
                  logP11F2  <- par[33];
                  logP12F2  <- par[34];
                  logP13F2  <- par[35];
                  logP14F2  <- par[36];
                  logP15F2  <- par[37];
                  logP16F2  <- par[38];
                  logP17F2  <- par[39];
                  logscale2 <- par[40];
                  logalpha2 <- par[41];
                  logbeta2  <- par[42];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN18P18P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(18,18),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts2.P1    <- dates[20];
                  ts2.P2    <- dates[21];
                  ts2.P3    <- dates[22];
                  ts2.P4    <- dates[23];
                  ts2.P5    <- dates[24];
                  ts2.P6    <- dates[25];
                  ts2.P7    <- dates[26];
                  ts2.P8    <- dates[27];
                  ts2.P9    <- dates[28];
                  ts2.P10   <- dates[29];
                  ts2.P11   <- dates[30];
                  ts2.P12   <- dates[31];
                  ts2.P13   <- dates[32];
                  ts2.P14   <- dates[33];
                  ts2.P15   <- dates[34];
                  ts2.P16   <- dates[35];
                  ts2.P17   <- dates[36];
                  ts2.P18   <- dates[37];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logscale1 <- par[21];
                  logalpha1 <- par[22];
                  logbeta1  <- par[23];
                  logP1F2   <- par[24];
                  logP2F2   <- par[25];
                  logP3F2   <- par[26];
                  logP4F2   <- par[27];
                  logP5F2   <- par[28];
                  logP6F2   <- par[29];
                  logP7F2   <- par[30];
                  logP8F2   <- par[31];
                  logP9F2   <- par[32];
                  logP10F2  <- par[33];
                  logP11F2  <- par[34];
                  logP12F2  <- par[35];
                  logP13F2  <- par[36];
                  logP14F2  <- par[37];
                  logP15F2  <- par[38];
                  logP16F2  <- par[39];
                  logP17F2  <- par[40];
                  logP18F2  <- par[41];
                  logscale2 <- par[42];
                  logalpha2 <- par[43];
                  logbeta2  <- par[44];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN19P19P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(19,19),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts2.P1    <- dates[21];
                  ts2.P2    <- dates[22];
                  ts2.P3    <- dates[23];
                  ts2.P4    <- dates[24];
                  ts2.P5    <- dates[25];
                  ts2.P6    <- dates[26];
                  ts2.P7    <- dates[27];
                  ts2.P8    <- dates[28];
                  ts2.P9    <- dates[29];
                  ts2.P10   <- dates[30];
                  ts2.P11   <- dates[31];
                  ts2.P12   <- dates[32];
                  ts2.P13   <- dates[33];
                  ts2.P14   <- dates[34];
                  ts2.P15   <- dates[35];
                  ts2.P16   <- dates[36];
                  ts2.P17   <- dates[37];
                  ts2.P18   <- dates[38];
                  ts2.P19   <- dates[39];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logscale1 <- par[22];
                  logalpha1 <- par[23];
                  logbeta1  <- par[24];
                  logP1F2   <- par[25];
                  logP2F2   <- par[26];
                  logP3F2   <- par[27];
                  logP4F2   <- par[28];
                  logP5F2   <- par[29];
                  logP6F2   <- par[30];
                  logP7F2   <- par[31];
                  logP8F2   <- par[32];
                  logP9F2   <- par[33];
                  logP10F2  <- par[34];
                  logP11F2  <- par[35];
                  logP12F2  <- par[36];
                  logP13F2  <- par[37];
                  logP14F2  <- par[38];
                  logP15F2  <- par[39];
                  logP16F2  <- par[40];
                  logP17F2  <- par[41];
                  logP18F2  <- par[42];
                  logP19F2  <- par[43];
                  logscale2 <- par[44];
                  logalpha2 <- par[45];
                  logbeta2  <- par[46];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN20P20P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(20,20),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts2.P1    <- dates[22];
                  ts2.P2    <- dates[23];
                  ts2.P3    <- dates[24];
                  ts2.P4    <- dates[25];
                  ts2.P5    <- dates[26];
                  ts2.P6    <- dates[27];
                  ts2.P7    <- dates[28];
                  ts2.P8    <- dates[29];
                  ts2.P9    <- dates[30];
                  ts2.P10   <- dates[31];
                  ts2.P11   <- dates[32];
                  ts2.P12   <- dates[33];
                  ts2.P13   <- dates[34];
                  ts2.P14   <- dates[35];
                  ts2.P15   <- dates[36];
                  ts2.P16   <- dates[37];
                  ts2.P17   <- dates[38];
                  ts2.P18   <- dates[39];
                  ts2.P19   <- dates[40];
                  ts2.P20   <- dates[41];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logscale1 <- par[23];
                  logalpha1 <- par[24];
                  logbeta1  <- par[25];
                  logP1F2   <- par[26];
                  logP2F2   <- par[27];
                  logP3F2   <- par[28];
                  logP4F2   <- par[29];
                  logP5F2   <- par[30];
                  logP6F2   <- par[31];
                  logP7F2   <- par[32];
                  logP8F2   <- par[33];
                  logP9F2   <- par[34];
                  logP10F2  <- par[35];
                  logP11F2  <- par[36];
                  logP12F2  <- par[37];
                  logP13F2  <- par[38];
                  logP14F2  <- par[39];
                  logP15F2  <- par[40];
                  logP16F2  <- par[41];
                  logP17F2  <- par[42];
                  logP18F2  <- par[43];
                  logP19F2  <- par[44];
                  logP20F2  <- par[45];
                  logscale2 <- par[46];
                  logalpha2 <- par[47];
                  logbeta2  <- par[48];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN21P21P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(21,21),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts1.P21   <- dates[22];
                  ts2.P1    <- dates[23];
                  ts2.P2    <- dates[24];
                  ts2.P3    <- dates[25];
                  ts2.P4    <- dates[26];
                  ts2.P5    <- dates[27];
                  ts2.P6    <- dates[28];
                  ts2.P7    <- dates[29];
                  ts2.P8    <- dates[30];
                  ts2.P9    <- dates[31];
                  ts2.P10   <- dates[32];
                  ts2.P11   <- dates[33];
                  ts2.P12   <- dates[34];
                  ts2.P13   <- dates[35];
                  ts2.P14   <- dates[36];
                  ts2.P15   <- dates[37];
                  ts2.P16   <- dates[38];
                  ts2.P17   <- dates[39];
                  ts2.P18   <- dates[40];
                  ts2.P19   <- dates[41];
                  ts2.P20   <- dates[42];
                  ts2.P21   <- dates[43];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  ind1.P21  <- ifelse(1:sealen < (ts1.P21-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  ind2.P21  <- ifelse(1:sealen < (ts2.P21-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logP21F1  <- par[23];
                  logscale1 <- par[24];
                  logalpha1 <- par[25];
                  logbeta1  <- par[26];
                  logP1F2   <- par[27];
                  logP2F2   <- par[28];
                  logP3F2   <- par[29];
                  logP4F2   <- par[30];
                  logP5F2   <- par[31];
                  logP6F2   <- par[32];
                  logP7F2   <- par[33];
                  logP8F2   <- par[34];
                  logP9F2   <- par[35];
                  logP10F2  <- par[36];
                  logP11F2  <- par[37];
                  logP12F2  <- par[38];
                  logP13F2  <- par[39];
                  logP14F2  <- par[40];
                  logP15F2  <- par[41];
                  logP16F2  <- par[42];
                  logP17F2  <- par[43];
                  logP18F2  <- par[44];
                  logP19F2  <- par[45];
                  logP20F2  <- par[46];
                  logP21F2  <- par[47];
                  logscale2 <- par[48];
                  logalpha2 <- par[49];
                  logbeta2  <- par[50];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind1.P21[i]*exp(logP21F1)*exp(-exp(logM)*(i-(ts1.P21-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) +
                                 ind2.P21[i]*exp(logP21F2)*exp(-exp(logM)*(i-(ts2.P21-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN22P22P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(22,22),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts1.P21   <- dates[22];
                  ts1.P22   <- dates[23];
                  ts2.P1    <- dates[24];
                  ts2.P2    <- dates[25];
                  ts2.P3    <- dates[26];
                  ts2.P4    <- dates[27];
                  ts2.P5    <- dates[28];
                  ts2.P6    <- dates[29];
                  ts2.P7    <- dates[30];
                  ts2.P8    <- dates[31];
                  ts2.P9    <- dates[32];
                  ts2.P10   <- dates[33];
                  ts2.P11   <- dates[34];
                  ts2.P12   <- dates[35];
                  ts2.P13   <- dates[36];
                  ts2.P14   <- dates[37];
                  ts2.P15   <- dates[38];
                  ts2.P16   <- dates[39];
                  ts2.P17   <- dates[40];
                  ts2.P18   <- dates[41];
                  ts2.P19   <- dates[42];
                  ts2.P20   <- dates[43];
                  ts2.P21   <- dates[44];
                  ts2.P22   <- dates[45];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  ind1.P21  <- ifelse(1:sealen < (ts1.P21-ts.start), 0, 1);
                  ind1.P22  <- ifelse(1:sealen < (ts1.P22-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  ind2.P21  <- ifelse(1:sealen < (ts2.P21-ts.start), 0, 1);
                  ind2.P22  <- ifelse(1:sealen < (ts2.P22-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logP21F1  <- par[23];
                  logP22F1  <- par[24];
                  logscale1 <- par[25];
                  logalpha1 <- par[26];
                  logbeta1  <- par[27];
                  logP1F2   <- par[28];
                  logP2F2   <- par[29];
                  logP3F2   <- par[30];
                  logP4F2   <- par[31];
                  logP5F2   <- par[32];
                  logP6F2   <- par[33];
                  logP7F2   <- par[34];
                  logP8F2   <- par[35];
                  logP9F2   <- par[36];
                  logP10F2  <- par[37];
                  logP11F2  <- par[38];
                  logP12F2  <- par[39];
                  logP13F2  <- par[40];
                  logP14F2  <- par[41];
                  logP15F2  <- par[42];
                  logP16F2  <- par[43];
                  logP17F2  <- par[44];
                  logP18F2  <- par[45];
                  logP19F2  <- par[46];
                  logP20F2  <- par[47];
                  logP21F2  <- par[48];
                  logP22F2  <- par[49];
                  logscale2 <- par[50];
                  logalpha2 <- par[51];
                  logbeta2  <- par[52];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind1.P21[i]*exp(logP21F1)*exp(-exp(logM)*(i-(ts1.P21-ts.start)+1)) +
                                 ind1.P22[i]*exp(logP22F1)*exp(-exp(logM)*(i-(ts1.P22-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) +
                                 ind2.P21[i]*exp(logP21F2)*exp(-exp(logM)*(i-(ts2.P21-ts.start)+1)) +
                                 ind2.P22[i]*exp(logP22F2)*exp(-exp(logM)*(i-(ts2.P22-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN23P23P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(23,23),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts1.P21   <- dates[22];
                  ts1.P22   <- dates[23];
                  ts1.P23   <- dates[24];
                  ts2.P1    <- dates[25];
                  ts2.P2    <- dates[26];
                  ts2.P3    <- dates[27];
                  ts2.P4    <- dates[28];
                  ts2.P5    <- dates[29];
                  ts2.P6    <- dates[30];
                  ts2.P7    <- dates[31];
                  ts2.P8    <- dates[32];
                  ts2.P9    <- dates[33];
                  ts2.P10   <- dates[34];
                  ts2.P11   <- dates[35];
                  ts2.P12   <- dates[36];
                  ts2.P13   <- dates[37];
                  ts2.P14   <- dates[38];
                  ts2.P15   <- dates[39];
                  ts2.P16   <- dates[40];
                  ts2.P17   <- dates[41];
                  ts2.P18   <- dates[42];
                  ts2.P19   <- dates[43];
                  ts2.P20   <- dates[44];
                  ts2.P21   <- dates[45];
                  ts2.P22   <- dates[46];
                  ts2.P23   <- dates[47];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  ind1.P21  <- ifelse(1:sealen < (ts1.P21-ts.start), 0, 1);
                  ind1.P22  <- ifelse(1:sealen < (ts1.P22-ts.start), 0, 1);
                  ind1.P23  <- ifelse(1:sealen < (ts1.P23-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  ind2.P21  <- ifelse(1:sealen < (ts2.P21-ts.start), 0, 1);
                  ind2.P22  <- ifelse(1:sealen < (ts2.P22-ts.start), 0, 1);
                  ind2.P23  <- ifelse(1:sealen < (ts2.P23-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logP21F1  <- par[23];
                  logP22F1  <- par[24];
                  logP23F1  <- par[25];
                  logscale1 <- par[26];
                  logalpha1 <- par[27];
                  logbeta1  <- par[28];
                  logP1F2   <- par[29];
                  logP2F2   <- par[30];
                  logP3F2   <- par[31];
                  logP4F2   <- par[32];
                  logP5F2   <- par[33];
                  logP6F2   <- par[34];
                  logP7F2   <- par[35];
                  logP8F2   <- par[36];
                  logP9F2   <- par[37];
                  logP10F2  <- par[38];
                  logP11F2  <- par[39];
                  logP12F2  <- par[40];
                  logP13F2  <- par[41];
                  logP14F2  <- par[42];
                  logP15F2  <- par[43];
                  logP16F2  <- par[44];
                  logP17F2  <- par[45];
                  logP18F2  <- par[46];
                  logP19F2  <- par[47];
                  logP20F2  <- par[48];
                  logP21F2  <- par[49];
                  logP22F2  <- par[50];
                  logP23F2  <- par[51];
                  logscale2 <- par[52];
                  logalpha2 <- par[53];
                  logbeta2  <- par[54];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind1.P21[i]*exp(logP21F1)*exp(-exp(logM)*(i-(ts1.P21-ts.start)+1)) +
                                 ind1.P22[i]*exp(logP22F1)*exp(-exp(logM)*(i-(ts1.P22-ts.start)+1)) +
                                 ind1.P23[i]*exp(logP23F1)*exp(-exp(logM)*(i-(ts1.P23-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) +
                                 ind2.P21[i]*exp(logP21F2)*exp(-exp(logM)*(i-(ts2.P21-ts.start)+1)) +
                                 ind2.P22[i]*exp(logP22F2)*exp(-exp(logM)*(i-(ts2.P22-ts.start)+1)) +
                                 ind2.P23[i]*exp(logP23F2)*exp(-exp(logM)*(i-(ts2.P23-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN24P24P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(24,24),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts1.P21   <- dates[22];
                  ts1.P22   <- dates[23];
                  ts1.P23   <- dates[24];
                  ts1.P24   <- dates[25];
                  ts2.P1    <- dates[26];
                  ts2.P2    <- dates[27];
                  ts2.P3    <- dates[28];
                  ts2.P4    <- dates[29];
                  ts2.P5    <- dates[30];
                  ts2.P6    <- dates[31];
                  ts2.P7    <- dates[32];
                  ts2.P8    <- dates[33];
                  ts2.P9    <- dates[34];
                  ts2.P10   <- dates[35];
                  ts2.P11   <- dates[36];
                  ts2.P12   <- dates[37];
                  ts2.P13   <- dates[38];
                  ts2.P14   <- dates[39];
                  ts2.P15   <- dates[40];
                  ts2.P16   <- dates[41];
                  ts2.P17   <- dates[42];
                  ts2.P18   <- dates[43];
                  ts2.P19   <- dates[44];
                  ts2.P20   <- dates[45];
                  ts2.P21   <- dates[46];
                  ts2.P22   <- dates[47];
                  ts2.P23   <- dates[48];
                  ts2.P24   <- dates[49];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  ind1.P21  <- ifelse(1:sealen < (ts1.P21-ts.start), 0, 1);
                  ind1.P22  <- ifelse(1:sealen < (ts1.P22-ts.start), 0, 1);
                  ind1.P23  <- ifelse(1:sealen < (ts1.P23-ts.start), 0, 1);
                  ind1.P24  <- ifelse(1:sealen < (ts1.P24-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  ind2.P21  <- ifelse(1:sealen < (ts2.P21-ts.start), 0, 1);
                  ind2.P22  <- ifelse(1:sealen < (ts2.P22-ts.start), 0, 1);
                  ind2.P23  <- ifelse(1:sealen < (ts2.P23-ts.start), 0, 1);
                  ind2.P24  <- ifelse(1:sealen < (ts2.P24-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logP21F1  <- par[23];
                  logP22F1  <- par[24];
                  logP23F1  <- par[25];
                  logP24F1  <- par[26];
                  logscale1 <- par[27];
                  logalpha1 <- par[28];
                  logbeta1  <- par[29];
                  logP1F2   <- par[30];
                  logP2F2   <- par[31];
                  logP3F2   <- par[32];
                  logP4F2   <- par[33];
                  logP5F2   <- par[34];
                  logP6F2   <- par[35];
                  logP7F2   <- par[36];
                  logP8F2   <- par[37];
                  logP9F2   <- par[38];
                  logP10F2  <- par[39];
                  logP11F2  <- par[40];
                  logP12F2  <- par[41];
                  logP13F2  <- par[42];
                  logP14F2  <- par[43];
                  logP15F2  <- par[44];
                  logP16F2  <- par[45];
                  logP17F2  <- par[46];
                  logP18F2  <- par[47];
                  logP19F2  <- par[48];
                  logP20F2  <- par[49];
                  logP21F2  <- par[50];
                  logP22F2  <- par[51];
                  logP23F2  <- par[52];
                  logP24F2  <- par[53];
                  logscale2 <- par[54];
                  logalpha2 <- par[55];
                  logbeta2  <- par[56];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind1.P21[i]*exp(logP21F1)*exp(-exp(logM)*(i-(ts1.P21-ts.start)+1)) +
                                 ind1.P22[i]*exp(logP22F1)*exp(-exp(logM)*(i-(ts1.P22-ts.start)+1)) +
                                 ind1.P23[i]*exp(logP23F1)*exp(-exp(logM)*(i-(ts1.P23-ts.start)+1)) +
                                 ind1.P24[i]*exp(logP24F1)*exp(-exp(logM)*(i-(ts1.P24-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) +
                                 ind2.P21[i]*exp(logP21F2)*exp(-exp(logM)*(i-(ts2.P21-ts.start)+1)) +
                                 ind2.P22[i]*exp(logP22F2)*exp(-exp(logM)*(i-(ts2.P22-ts.start)+1)) +
                                 ind2.P23[i]*exp(logP23F2)*exp(-exp(logM)*(i-(ts2.P23-ts.start)+1)) +
                                 ind2.P24[i]*exp(logP24F2)*exp(-exp(logM)*(i-(ts2.P24-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
.CDMN25P25P <- function(par,dates,obscat1,obseff1,obsmbm1,obscat2,obseff2,obsmbm2,distr,properties,output,pp=c(25,25),partial)
  {
                  ts.start  <- head(dates,1);
                  ts1.P1    <- dates[2];
                  ts1.P2    <- dates[3];
                  ts1.P3    <- dates[4];
                  ts1.P4    <- dates[5];
                  ts1.P5    <- dates[6];
                  ts1.P6    <- dates[7];
                  ts1.P7    <- dates[8];
                  ts1.P8    <- dates[9];
                  ts1.P9    <- dates[10];
                  ts1.P10   <- dates[11];
                  ts1.P11   <- dates[12];
                  ts1.P12   <- dates[13];
                  ts1.P13   <- dates[14];
                  ts1.P14   <- dates[15];
                  ts1.P15   <- dates[16];
                  ts1.P16   <- dates[17];
                  ts1.P17   <- dates[18];
                  ts1.P18   <- dates[19];
                  ts1.P19   <- dates[20];
                  ts1.P20   <- dates[21];
                  ts1.P21   <- dates[22];
                  ts1.P22   <- dates[23];
                  ts1.P23   <- dates[24];
                  ts1.P24   <- dates[25];
                  ts1.P25   <- dates[26];
                  ts2.P1    <- dates[27];
                  ts2.P2    <- dates[28];
                  ts2.P3    <- dates[29];
                  ts2.P4    <- dates[30];
                  ts2.P5    <- dates[31];
                  ts2.P6    <- dates[32];
                  ts2.P7    <- dates[33];
                  ts2.P8    <- dates[34];
                  ts2.P9    <- dates[35];
                  ts2.P10   <- dates[36];
                  ts2.P11   <- dates[37];
                  ts2.P12   <- dates[38];
                  ts2.P13   <- dates[39];
                  ts2.P14   <- dates[40];
                  ts2.P15   <- dates[41];
                  ts2.P16   <- dates[42];
                  ts2.P17   <- dates[43];
                  ts2.P18   <- dates[44];
                  ts2.P19   <- dates[45];
                  ts2.P20   <- dates[46];
                  ts2.P21   <- dates[47];
                  ts2.P22   <- dates[48];
                  ts2.P23   <- dates[49];
                  ts2.P24   <- dates[50];
                  ts2.P25   <- dates[51];
                  ts.end    <- tail(dates,1);
                  sealen    <- ts.end-ts.start+1;
                  nstep     <- vector("numeric",sealen);
                  mccum     <- vector("numeric",sealen);
                  effeff1   <- vector("numeric",sealen);
                  effn1     <- vector("numeric",sealen);
                  predcat1  <- vector("numeric",sealen);
                  ind1.P1   <- ifelse(1:sealen < (ts1.P1-ts.start), 0, 1);
                  ind1.P2   <- ifelse(1:sealen < (ts1.P2-ts.start), 0, 1);
                  ind1.P3   <- ifelse(1:sealen < (ts1.P3-ts.start), 0, 1);
                  ind1.P4   <- ifelse(1:sealen < (ts1.P4-ts.start), 0, 1);
                  ind1.P5   <- ifelse(1:sealen < (ts1.P5-ts.start), 0, 1);
                  ind1.P6   <- ifelse(1:sealen < (ts1.P6-ts.start), 0, 1);
                  ind1.P7   <- ifelse(1:sealen < (ts1.P7-ts.start), 0, 1);
                  ind1.P8   <- ifelse(1:sealen < (ts1.P8-ts.start), 0, 1);
                  ind1.P9   <- ifelse(1:sealen < (ts1.P9-ts.start), 0, 1);
                  ind1.P10  <- ifelse(1:sealen < (ts1.P10-ts.start), 0, 1);
                  ind1.P11  <- ifelse(1:sealen < (ts1.P11-ts.start), 0, 1);
                  ind1.P12  <- ifelse(1:sealen < (ts1.P12-ts.start), 0, 1);
                  ind1.P13  <- ifelse(1:sealen < (ts1.P13-ts.start), 0, 1);
                  ind1.P14  <- ifelse(1:sealen < (ts1.P14-ts.start), 0, 1);
                  ind1.P15  <- ifelse(1:sealen < (ts1.P15-ts.start), 0, 1);
                  ind1.P16  <- ifelse(1:sealen < (ts1.P16-ts.start), 0, 1);
                  ind1.P17  <- ifelse(1:sealen < (ts1.P17-ts.start), 0, 1);
                  ind1.P18  <- ifelse(1:sealen < (ts1.P18-ts.start), 0, 1);
                  ind1.P19  <- ifelse(1:sealen < (ts1.P19-ts.start), 0, 1);
                  ind1.P20  <- ifelse(1:sealen < (ts1.P20-ts.start), 0, 1);
                  ind1.P21  <- ifelse(1:sealen < (ts1.P21-ts.start), 0, 1);
                  ind1.P22  <- ifelse(1:sealen < (ts1.P22-ts.start), 0, 1);
                  ind1.P23  <- ifelse(1:sealen < (ts1.P23-ts.start), 0, 1);
                  ind1.P24  <- ifelse(1:sealen < (ts1.P24-ts.start), 0, 1);
                  ind1.P25  <- ifelse(1:sealen < (ts1.P25-ts.start), 0, 1);
                  effeff2   <- vector("numeric",sealen);
                  effn2     <- vector("numeric",sealen);
                  predcat2  <- vector("numeric",sealen);
                  ind2.P1   <- ifelse(1:sealen < (ts2.P1-ts.start), 0, 1);
                  ind2.P2   <- ifelse(1:sealen < (ts2.P2-ts.start), 0, 1);
                  ind2.P3   <- ifelse(1:sealen < (ts2.P3-ts.start), 0, 1);
                  ind2.P4   <- ifelse(1:sealen < (ts2.P4-ts.start), 0, 1);
                  ind2.P5   <- ifelse(1:sealen < (ts2.P5-ts.start), 0, 1);
                  ind2.P6   <- ifelse(1:sealen < (ts2.P6-ts.start), 0, 1);
                  ind2.P7   <- ifelse(1:sealen < (ts2.P7-ts.start), 0, 1);
                  ind2.P8   <- ifelse(1:sealen < (ts2.P8-ts.start), 0, 1);
                  ind2.P9   <- ifelse(1:sealen < (ts2.P9-ts.start), 0, 1);
                  ind2.P10  <- ifelse(1:sealen < (ts2.P10-ts.start), 0, 1);
                  ind2.P11  <- ifelse(1:sealen < (ts2.P11-ts.start), 0, 1);
                  ind2.P12  <- ifelse(1:sealen < (ts2.P12-ts.start), 0, 1);
                  ind2.P13  <- ifelse(1:sealen < (ts2.P13-ts.start), 0, 1);
                  ind2.P14  <- ifelse(1:sealen < (ts2.P14-ts.start), 0, 1);
                  ind2.P15  <- ifelse(1:sealen < (ts2.P15-ts.start), 0, 1);
                  ind2.P16  <- ifelse(1:sealen < (ts2.P16-ts.start), 0, 1);
                  ind2.P17  <- ifelse(1:sealen < (ts2.P17-ts.start), 0, 1);
                  ind2.P18  <- ifelse(1:sealen < (ts2.P18-ts.start), 0, 1);
                  ind2.P19  <- ifelse(1:sealen < (ts2.P19-ts.start), 0, 1);
                  ind2.P20  <- ifelse(1:sealen < (ts2.P20-ts.start), 0, 1);
                  ind2.P21  <- ifelse(1:sealen < (ts2.P21-ts.start), 0, 1);
                  ind2.P22  <- ifelse(1:sealen < (ts2.P22-ts.start), 0, 1);
                  ind2.P23  <- ifelse(1:sealen < (ts2.P23-ts.start), 0, 1);
                  ind2.P24  <- ifelse(1:sealen < (ts2.P24-ts.start), 0, 1);
                  ind2.P25  <- ifelse(1:sealen < (ts2.P25-ts.start), 0, 1);
                  logM      <- par[1];
                  logN0     <- par[2];
                  logP1F1   <- par[3];
                  logP2F1   <- par[4];
                  logP3F1   <- par[5];
                  logP4F1   <- par[6];
                  logP5F1   <- par[7];
                  logP6F1   <- par[8];
                  logP7F1   <- par[9];
                  logP8F1   <- par[10];
                  logP9F1   <- par[11];
                  logP10F1  <- par[12];
                  logP11F1  <- par[13];
                  logP12F1  <- par[14];
                  logP13F1  <- par[15];
                  logP14F1  <- par[16];
                  logP15F1  <- par[17];
                  logP16F1  <- par[18];
                  logP17F1  <- par[19];
                  logP18F1  <- par[20];
                  logP19F1  <- par[21];
                  logP20F1  <- par[22];
                  logP21F1  <- par[23];
                  logP22F1  <- par[24];
                  logP23F1  <- par[25];
                  logP24F1  <- par[26];
                  logP25F1  <- par[27];
                  logscale1 <- par[28];
                  logalpha1 <- par[29];
                  logbeta1  <- par[30];
                  logP1F2   <- par[31];
                  logP2F2   <- par[32];
                  logP3F2   <- par[33];
                  logP4F2   <- par[34];
                  logP5F2   <- par[35];
                  logP6F2   <- par[36];
                  logP7F2   <- par[37];
                  logP8F2   <- par[38];
                  logP9F2   <- par[39];
                  logP10F2  <- par[40];
                  logP11F2  <- par[41];
                  logP12F2  <- par[42];
                  logP13F2  <- par[43];
                  logP14F2  <- par[44];
                  logP15F2  <- par[45];
                  logP16F2  <- par[46];
                  logP17F2  <- par[47];
                  logP18F2  <- par[48];
                  logP19F2  <- par[49];
                  logP20F2  <- par[50];
                  logP21F2  <- par[51];
                  logP22F2  <- par[52];
                  logP23F2  <- par[53];
                  logP24F2  <- par[54];
                  logP25F2  <- par[55];
                  logscale2 <- par[56];
                  logalpha2 <- par[57];
                  logbeta2  <- par[58];
                  mccum[1]  <- 0;
                  nstep[1]  <- exp(logN0)*exp(-exp(logM));
                  for(i in 2:sealen)
                     {
                     mccum[i] <- obscat1[i-1] + obscat2[i-1] + mccum[i-1]*exp(-exp(logM));
                     nstep[i] <- exp(logN0)*exp(-exp(logM)*i) +
                                 ind1.P1[i]*exp(logP1F1)*exp(-exp(logM)*(i-(ts1.P1-ts.start)+1)) +
                                 ind1.P2[i]*exp(logP2F1)*exp(-exp(logM)*(i-(ts1.P2-ts.start)+1)) +
                                 ind1.P3[i]*exp(logP3F1)*exp(-exp(logM)*(i-(ts1.P3-ts.start)+1)) +
                                 ind1.P4[i]*exp(logP4F1)*exp(-exp(logM)*(i-(ts1.P4-ts.start)+1)) +
                                 ind1.P5[i]*exp(logP5F1)*exp(-exp(logM)*(i-(ts1.P5-ts.start)+1)) +
                                 ind1.P6[i]*exp(logP6F1)*exp(-exp(logM)*(i-(ts1.P6-ts.start)+1)) +
                                 ind1.P7[i]*exp(logP7F1)*exp(-exp(logM)*(i-(ts1.P7-ts.start)+1)) +
                                 ind1.P8[i]*exp(logP8F1)*exp(-exp(logM)*(i-(ts1.P8-ts.start)+1)) +
                                 ind1.P9[i]*exp(logP9F1)*exp(-exp(logM)*(i-(ts1.P9-ts.start)+1)) +
                                 ind1.P10[i]*exp(logP10F1)*exp(-exp(logM)*(i-(ts1.P10-ts.start)+1)) +
                                 ind1.P11[i]*exp(logP11F1)*exp(-exp(logM)*(i-(ts1.P11-ts.start)+1)) +
                                 ind1.P12[i]*exp(logP12F1)*exp(-exp(logM)*(i-(ts1.P12-ts.start)+1)) +
                                 ind1.P13[i]*exp(logP13F1)*exp(-exp(logM)*(i-(ts1.P13-ts.start)+1)) +
                                 ind1.P14[i]*exp(logP14F1)*exp(-exp(logM)*(i-(ts1.P14-ts.start)+1)) +
                                 ind1.P15[i]*exp(logP15F1)*exp(-exp(logM)*(i-(ts1.P15-ts.start)+1)) +
                                 ind1.P16[i]*exp(logP16F1)*exp(-exp(logM)*(i-(ts1.P16-ts.start)+1)) +
                                 ind1.P17[i]*exp(logP17F1)*exp(-exp(logM)*(i-(ts1.P17-ts.start)+1)) +
                                 ind1.P18[i]*exp(logP18F1)*exp(-exp(logM)*(i-(ts1.P18-ts.start)+1)) +
                                 ind1.P19[i]*exp(logP19F1)*exp(-exp(logM)*(i-(ts1.P19-ts.start)+1)) +
                                 ind1.P20[i]*exp(logP20F1)*exp(-exp(logM)*(i-(ts1.P20-ts.start)+1)) +
                                 ind1.P21[i]*exp(logP21F1)*exp(-exp(logM)*(i-(ts1.P21-ts.start)+1)) +
                                 ind1.P22[i]*exp(logP22F1)*exp(-exp(logM)*(i-(ts1.P22-ts.start)+1)) +
                                 ind1.P23[i]*exp(logP23F1)*exp(-exp(logM)*(i-(ts1.P23-ts.start)+1)) +
                                 ind1.P24[i]*exp(logP24F1)*exp(-exp(logM)*(i-(ts1.P24-ts.start)+1)) +
                                 ind1.P25[i]*exp(logP25F1)*exp(-exp(logM)*(i-(ts1.P25-ts.start)+1)) +
                                 ind2.P1[i]*exp(logP1F2)*exp(-exp(logM)*(i-(ts2.P1-ts.start)+1)) +
                                 ind2.P2[i]*exp(logP2F2)*exp(-exp(logM)*(i-(ts2.P2-ts.start)+1)) +
                                 ind2.P3[i]*exp(logP3F2)*exp(-exp(logM)*(i-(ts2.P3-ts.start)+1)) +
                                 ind2.P4[i]*exp(logP4F2)*exp(-exp(logM)*(i-(ts2.P4-ts.start)+1)) +
                                 ind2.P5[i]*exp(logP5F2)*exp(-exp(logM)*(i-(ts2.P5-ts.start)+1)) +
                                 ind2.P6[i]*exp(logP6F2)*exp(-exp(logM)*(i-(ts2.P6-ts.start)+1)) +
                                 ind2.P7[i]*exp(logP7F2)*exp(-exp(logM)*(i-(ts2.P7-ts.start)+1)) +
                                 ind2.P8[i]*exp(logP8F2)*exp(-exp(logM)*(i-(ts2.P8-ts.start)+1)) +
                                 ind2.P9[i]*exp(logP9F2)*exp(-exp(logM)*(i-(ts2.P9-ts.start)+1)) +
                                 ind2.P10[i]*exp(logP10F2)*exp(-exp(logM)*(i-(ts2.P10-ts.start)+1)) +
                                 ind2.P11[i]*exp(logP11F2)*exp(-exp(logM)*(i-(ts2.P11-ts.start)+1)) +
                                 ind2.P12[i]*exp(logP12F2)*exp(-exp(logM)*(i-(ts2.P12-ts.start)+1)) +
                                 ind2.P13[i]*exp(logP13F2)*exp(-exp(logM)*(i-(ts2.P13-ts.start)+1)) +
                                 ind2.P14[i]*exp(logP14F2)*exp(-exp(logM)*(i-(ts2.P14-ts.start)+1)) +
                                 ind2.P15[i]*exp(logP15F2)*exp(-exp(logM)*(i-(ts2.P15-ts.start)+1)) +
                                 ind2.P16[i]*exp(logP16F2)*exp(-exp(logM)*(i-(ts2.P16-ts.start)+1)) +
                                 ind2.P17[i]*exp(logP17F2)*exp(-exp(logM)*(i-(ts2.P17-ts.start)+1)) +
                                 ind2.P18[i]*exp(logP18F2)*exp(-exp(logM)*(i-(ts2.P18-ts.start)+1)) +
                                 ind2.P19[i]*exp(logP19F2)*exp(-exp(logM)*(i-(ts2.P19-ts.start)+1)) +
                                 ind2.P20[i]*exp(logP20F2)*exp(-exp(logM)*(i-(ts2.P20-ts.start)+1)) +
                                 ind2.P21[i]*exp(logP21F2)*exp(-exp(logM)*(i-(ts2.P21-ts.start)+1)) +
                                 ind2.P22[i]*exp(logP22F2)*exp(-exp(logM)*(i-(ts2.P22-ts.start)+1)) +
                                 ind2.P23[i]*exp(logP23F2)*exp(-exp(logM)*(i-(ts2.P23-ts.start)+1)) +
                                 ind2.P24[i]*exp(logP24F2)*exp(-exp(logM)*(i-(ts2.P24-ts.start)+1)) +
                                 ind2.P25[i]*exp(logP25F2)*exp(-exp(logM)*(i-(ts2.P25-ts.start)+1)) -
                                 mccum[i]*exp(-exp(logM)/2);
                     }
                  effeff1   <- obseff1^(exp(logalpha1));
                  effn1     <- nstep^(exp(logbeta1));
                  predcat1  <- exp(logscale1)*(effeff1*effn1)*exp(-exp(logM)/2);
                  effeff2   <- obseff2^(exp(logalpha2));
                  effn2     <- nstep^(exp(logbeta2));
                  predcat2  <- exp(logscale2)*(effeff2*effn2)*exp(-exp(logM)/2);
                  Likel     <- .CatDynLik2F(obscat1,predcat1,obscat2,predcat2,distr,par)
                  if(output == "predict")
                    {
                    catdynexp <- .CatDynExp2F.Res(properties,nstep,obsmbm1,obsmbm2,pp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
                    class(catdynexp) <- "CatDynExp";
                    return(catdynexp);
                    }
                  else
                    {
                     if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] != "apnormal" & distr[2] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,1])) - sum(Likel[["Likelihood"]][,2]);
                       }

                     else if(distr[2] == "apnormal" | distr[2] == "aplnormal" & distr[1] != "apnormal" & distr[1] != "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*log(sum(Likel[["Likelihood"]][,2])) - sum(Likel[["Likelihood"]][,1]);
                       }
                     else if(distr[1] == "apnormal" | distr[1] == "aplnormal" & distr[2] == "apnormal" | distr[2] == "aplnormal")
                       {
                        negsup <- ((sealen-2)/2)*(log(sum(Likel[["Likelihood"]][,1])) + log(sum(Likel[["Likelihood"]][,2])));
                       }
                     else
                       {
                        negsup <- - sum(Likel[["Likelihood"]][,1]) - sum(Likel[["Likelihood"]][,2])
                       }
                     return(negsup);
                    }
 }
#
########################## IV LIKELIHOOD AND PREDICTION ########################
#
##########################  Dispersion Parameter NegBin  #######################
#
#.psi.nb2      <- function(psi,predcat1,obscat1) {sum(2*psi*log((psi+predcat1)/(psi+obscat1)) +
#                                                     psi/(psi+obscat1) -
#                                                     obscat1*(2*psi+obscat1)/(6*psi*(psi+obscat1)^2)) - psi}
#
############################### Likelihood Models  #############################
#
.CatDynLik1F   <- function(obscat1,predcat1,distr,par) # <- put par in the arguments
  {
                  Likel        <- vector("list",4);
                  names(Likel) <- c("Dispersion","Deviance","Likelihood","DevianceResidual");
                  sealen       <- length(obscat1);
                  #1/9
                  if(distr=='poisson')
                    {
                     psi1        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #2/9
                  else if(distr=='negbin')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #3/9
                  else if(distr=='normal')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- (obscat1-predcat1)^2;
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #4/9
                  else if(distr=='apnormal')
                    {
                     psi1        <- NA;
                     dev1        <- NA;
                     likcontr1   <- (obscat1-predcat1)^2;
                     res1        <- obscat1-predcat1;
                    }
                  #5/9
                  else if(distr=='lognormal')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #6/9
                  else if(distr=='aplnormal')
                    {
                     psi1        <- NA;
                     dev1        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                    }
                  #7/9
                  else if(distr=='gamma')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-(2/psi1)*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #8/9
                  else if(distr=='roblognormal')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-log(psi1)+log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  #9/9
                  else if(distr=='gumbel')
                    {
                     psi1        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(-1+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-log(psi1)-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                    }
                  Likel[["Dispersion"]]       <- psi1
                  Likel[["Deviance"]]         <- dev1
                  Likel[["Likelihood"]]       <- likcontr1
                  Likel[["DevianceResidual"]] <- res1
                  return(Likel);
  }
#
.CatDynLik2F   <- function(obscat1,predcat1,obscat2,predcat2,distr,par)
  {
                  Likel        <- vector("list",4);
                  names(Likel) <- c("Dispersion","Deviance","Likelihood","DevianceResidual");
                  sealen       <- length(obscat1);
                  #1/81
                  if(sum(distr==c('poisson','poisson')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #2/81
                  else if(sum(distr==c('poisson','negbin')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #3/81
                  else if(sum(distr==c('poisson','normal')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- (obscat2-predcat2)^2;
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- -(1/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #4/81
                  else if(sum(distr==c('poisson','apnormal')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- NA;
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #5/81
                  else if(sum(distr==c('poisson','lognormal')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #6/81
                  else if(sum(distr==c('poisson','aplnormal')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- NA;
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #7/81
                  else if(sum(distr==c('poisson','gamma')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #8/81
                  else if(sum(distr==c('poisson','roblognormal')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #9/81
                  else if(sum(distr==c('poisson','gumbel')) == 2)
                    {
                     psi1        <- 1;
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,2*(obscat1*log(obscat1)-obscat1*log(predcat1)-(obscat1-predcat1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(predcat1==0,0,obscat1*log(predcat1) - predcat1 - lfactorial(obscat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #10/81
                  else if(sum(distr==c('negbin','poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #11/81
                  else if(sum(distr==c('negbin','negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #12/81
                  else if(sum(distr==c('negbin', 'normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- -(1/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #13/81
                  else if(sum(distr==c('negbin', 'apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- obscat2-predcat2;
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- dev2^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- dev2;
                    }
                  #14/81
                  else if(sum(distr==c('negbin', 'lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #15/81
                  else if(sum(distr==c('negbin', 'aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- NA;
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- log(obscat2)-log(predcat2);
                    }
                  #16/81
                  else if(sum(distr==c('negbin', 'gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #17/81
                  else if(sum(distr==c('negbin', 'roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #18/81
                  else if(sum(distr==c('negbin', 'gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0,2*log(1+predcat1),
                                                      2*(obscat1*log(obscat1/predcat1)-(obscat1+1)*log((1+obscat1)/(1+predcat1))));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(predcat1==0,0,
                                           obscat1*log(1/psi1) +
                                           obscat1*log(predcat1) -
                                           (obscat1 + psi1)*log(1 + predcat1/psi1) +
                                           lgamma(obscat1 + psi1) -
                                           lgamma(obscat1 + 1) -
                                           lgamma(psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #19/81
                  else if(sum(distr==c('normal','poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ((obscat1-predcat1)^2)/sealen;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #20/81
                  else if(sum(distr==c('normal', 'negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #21/81
                  else if(sum(distr==c('normal','normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- -(1/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #22/81
                  else if(sum(distr==c('normal','apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- NA;
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #23/81
                  else if(sum(distr==c('normal','lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #24/81
                  else if(sum(distr==c('normal','aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- NA;
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #25/81
                  else if(sum(distr==c('normal','gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #26/81
                  else if(sum(distr==c('normal','roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #27/81
                  else if(sum(distr==c('normal','gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ((obscat1-predcat1)^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- -(1/2)*log(2*pi*psi1)-(1/(2*psi1))*(obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #28/81
                  else if(sum(distr==c('apnormal','poisson')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- 1;
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #29/81
                  else if(sum(distr==c('apnormal','negbin')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat1/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #30/81
                  else if(sum(distr==c('apnormal','normal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ((obscat2-predcat2)^2)/sealen;
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- -(sealen/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #31/81
                  else if(sum(distr==c('apnormal','apnormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- NA;
                     dev1        <- NA;
                     dev2        <- NA;
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- obscat1-predcat1;
                     res2        <- obscat2-predcat2;
                    }
                  #32/81
                  else if(sum(distr==c('apnormal','lognormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #33/81
                  else if(sum(distr==c('apnormal','aplnormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- NA;
                     dev1        <- NA;
                     dev2        <- NA;
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- obscat1-predcat1;
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #34/81
                  else if(sum(distr==c('apnormal','gamma')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #35/81
                  else if(sum(distr==c('apnormal','roblognormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #36/81
                  else if(sum(distr==c('apnormal','gumbel')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- (obscat1-predcat1)^2;
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- obscat1-predcat1;
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #37/81
                  else if(sum(distr==c('lognormal', 'poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2)/sealen;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #38/81
                  else if(sum(distr==c('lognormal','negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #39/81
                  else if(sum(distr==c('lognormal','normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ((obscat2-predcat2)^2)/sealen;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- -(1/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #40/81
                  else if(sum(distr==c('lognormal','apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(sealen/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #41/81
                  else if(sum(distr==c('lognormal','lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #42/81
                  else if(sum(distr==c('lognormal','aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #43/81
                  else if(sum(distr==c('lognormal','gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #44/81
                  else if(sum(distr==c('lognormal','roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #45/81
                  else if(sum(distr==c('lognormal','gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,-(1/2)*log(2*obscat1^2*pi*psi1)-(1/(2*psi1))*(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #46/81
                  else if(sum(distr==c('aplnormal','poisson')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- 1;
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #47/81
                  else if(sum(distr==c('aplnormal','negbin')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #48/81
                  else if(sum(distr==c('aplnormal','normal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- -(sealen/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #49/81
                  else if(sum(distr==c('aplnormal','apnormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- NA;
                     dev1        <- NA;
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- obscat2-predcat2;
                    }
                  #50/81
                  else if(sum(distr==c('aplnormal','lognormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #51/81
                  else if(sum(distr==c('aplnormal','aplnormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- NA;
                     dev1        <- NA;
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #52/81
                  else if(sum(distr==c('aplnormal','gamma')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #53/81
                  else if(sum(distr==c('aplnormal','roblognormal')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #54/81
                  else if(sum(distr==c('aplnormal','gumbel')) == 2)
                    {
                     psi1        <- NA;
                     psi2        <- exp(tail(par,1));
                     dev1        <- NA;
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- ifelse(obscat1==0 | predcat1==0,0,log(obscat1)-log(predcat1));
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #55/81
                  else if(sum(distr==c('gamma','poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #56/81
                  else if(sum(distr==c('gamma','negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #57/81
                  else if(sum(distr==c('gamma','normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- -(sealen/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #58/81
                  else if(sum(distr==c('gamma','apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #59/81
                  else if(sum( distr==c('gamma','lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #60/81
                  else if(sum(distr==c('gamma','aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #61/81
                  else if(sum(distr==c('gamma','gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #62/81
                  else if(sum( distr==c('gamma','roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #63/81
                  else if(sum( distr==c('gamma','gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(log(obscat1/predcat1)-(obscat1-predcat1)/predcat1));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,(1/psi1)*(log(obscat1)-log(psi1*predcat1))-log(obscat1)-sealen*lgamma(1/psi1)-obscat1/(psi1*predcat1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #64/81
                  else if(sum(distr==c('roblognormal','poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #65/81
                  else if(sum(distr==c('roblognormal','negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #66/81
                  else if(sum(distr==c('roblognormal','normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- -(sealen/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #67/81
                  else if(sum(distr==c('roblognormal','apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #68/81
                  else if(sum( distr==c('roblognormal','lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #69/81
                  else if(sum(distr==c('roblognormal','aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #70/81
                  else if(sum(distr==c('roblognormal','gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #71/81
                  else if(sum( distr==c('roblognormal','roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #72/81
                  else if(sum( distr==c('roblognormal','gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,(log(obscat1)-log(predcat1))^2);
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)-log(exp(-0.5*(log(obscat1/predcat1)/psi1+0.5*psi1)^2)+0.01));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #73/81
                  else if(sum(distr==c('gumbel','poisson')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- 1;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,2*(obscat2*log(obscat2)-obscat2*log(predcat2)-(obscat2-predcat2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(predcat2==0,0,obscat2*log(predcat2) - predcat2 - lfactorial(obscat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #74/81
                  else if(sum(distr==c('gumbel','negbin')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0,2*log(1+predcat2),
                                                      2*(obscat2*log(obscat2/predcat2)-(obscat2+1)*log((1+obscat2)/(1+predcat2))));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(predcat2==0,0,
                                           obscat2*log(1/psi2) +
                                           obscat2*log(predcat2) -
                                           (obscat2 + psi2)*log(1 + predcat2/psi2) +
                                           lgamma(obscat2 + psi2) -
                                           lgamma(obscat2 + 1) -
                                           lgamma(psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #75/81
                  else if(sum(distr==c('gumbel','normal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ((obscat2-predcat2)^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- -(sealen/2)*log(2*pi*psi2)-(1/(2*psi2))*(obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #76/81
                  else if(sum(distr==c('gumbel','apnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- (obscat2-predcat2)^2;
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- obscat2-predcat2;
                    }
                  #77/81
                  else if(sum( distr==c('gumbel','lognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,-(1/2)*log(2*obscat2^2*pi*psi2)-(1/(2*psi2))*(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #78/81
                  else if(sum(distr==c('gumbel','aplnormal')) == 2)
                    {
                     psi1        <- exp(tail(par,1));
                     psi2        <- NA;
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- NA;
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- ifelse(obscat2==0 | predcat2==0,0,log(obscat2)-log(predcat2));
                    }
                  #79/81
                  else if(sum(distr==c('gumbel','gamma')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(log(obscat2/predcat2)-(obscat2-predcat2)/predcat2));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,(1/psi2)*(log(obscat2)-log(psi2*predcat2))-log(obscat2)-sealen*lgamma(1/psi2)-obscat2/(psi2*predcat2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #80/81
                  else if(sum( distr==c('gumbel','roblognormal')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,(log(obscat2)-log(predcat2))^2);
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)-log(exp(-0.5*(log(obscat2/predcat2)/psi2+0.5*psi2)^2)+0.01));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  #81/81
                  else if(sum( distr==c('gumbel','gumbel')) == 2)
                    {
                     psi1        <- exp(tail(par,2)[1]);
                     psi2        <- exp(tail(par,1));
                     dev1        <- ifelse(obscat1==0 | predcat1==0,0,-2*(1-(obscat1-predcat1)/psi1-exp(-(obscat1-predcat1)/psi1)));
                     dev2        <- ifelse(obscat2==0 | predcat2==0,0,-2*(1-(obscat2-predcat2)/psi2-exp(-(obscat2-predcat2)/psi2)));
                     likcontr1   <- ifelse(obscat1==0 | predcat1==0,0,log(psi1)+(obscat1-predcat1)/psi1+exp(-(obscat1-predcat1)/psi1));
                     likcontr2   <- ifelse(obscat2==0 | predcat2==0,0,log(psi2)+(obscat2-predcat2)/psi2+exp(-(obscat2-predcat2)/psi2));
                     res1        <- sign(obscat1-predcat1)*sqrt(dev1);
                     res2        <- sign(obscat2-predcat2)*sqrt(dev2);
                    }
                  Likel[[1]] <- c(psi1,psi2)
                  Likel[[2]] <- data.frame(fleet1=dev1,fleet2=dev2)
                  Likel[[3]] <- data.frame(fleet1=likcontr1,fleet2=likcontr2)
                  Likel[[4]] <- data.frame(fleet1=res1,fleet2=res2)
                  return(Likel);
  }
#
###################################  PREDICTIONS ###############################
#
.CatDynExp1F.Res <- function(properties,nstep,obsmbm1,ppp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,partial)
  {
                  partial   <- partial
                  sdistr    <- c("poisson","apnormal","aplnormal")
                  biom      <- vector("numeric",length(nstep))
                  obscat.w  <- vector("numeric",length(nstep))
                  predcat.w <- vector("numeric",length(nstep))
                  if(properties$Units[2] == "ind")
                    {
                     biom      <- NA
                     obscat.w  <- NA
                     predcat.w <- NA
                    }
                  if(properties$Units[2] != "ind")
                    {
                     #Set biom in tonnes for both units of individual body weight
                     #Set obscat.w, predcat.w in kg for both units of individual body weight
                     biom <- obsmbm1*(1e-6*(properties$Units[3] == "g")+
                                      1e-3*(properties$Units[3] == "kg"))*
                             nstep*(1e9*(properties$Units[4] == "bill")+
                                    1e6*(properties$Units[4] == "mill")+
                                    1e3*(properties$Units[4] == "thou")+
                                    1e2*(properties$Units[4] == "hund"))
                     obscat.w <- obsmbm1*(1e-3*(properties$Units[3] == "g")+
                                          1e0*(properties$Units[3] == "kg"))*
                                 obscat1*(1e9*(properties$Units[4] == "bill")+
                                          1e6*(properties$Units[4] == "mill")+
                                          1e3*(properties$Units[4] == "thou")+
                                          1e2*(properties$Units[4] == "hund"))
                     predcat.w <- obsmbm1*(1e-3*(properties$Units[3] == "g")+
                                           1e0*(properties$Units[3] == "kg"))*
                                  predcat1*(1e9*(properties$Units[4] == "bill")+
                                            1e6*(properties$Units[4] == "mill")+
                                            1e3*(properties$Units[4] == "thou")+
                                            1e2*(properties$Units[4] == "hund"))
                    }
                  catdynres                         <- vector("list",2);
                  names(catdynres)                  <- c("Properties","Model");
                  catdynres$Properties              <- properties;
                  catdynres$Model                   <- vector("list",5);
                  names(catdynres$Model)            <- c("Type","Dates","Distribution","Parameters","Results");
                  catdynres$Model$Type              <- ppp;
                  catdynres$Model$Dates             <- dates;
                  catdynres$Model$Distribution      <- distr;
                  catdynres$Model$Parameters        <- exp(par);
                  if(ppp==0)
                    {
                     if(distr %in% sdistr)
                       {
                        names(catdynres$Model$Parameters) <- c("M","N0","k","alpha","beta")
                       }
                     if(!distr %in% sdistr)
                       {
                        names(catdynres$Model$Parameters) <- c("M","N0","k","alpha","beta","psi")
                       }
                    }
                  if(ppp>0)
                    {
                     if(distr %in% sdistr)
                       {
                        names(catdynres$Model$Parameters) <- c("M","N0",paste("P",1:ppp,sep=""),"k","alpha","beta")
                       }
                     if(!distr %in% sdistr)
                       {
                        names(catdynres$Model$Parameters) <- c("M","N0",paste("P",1:ppp,sep=""),"k","alpha","beta","psi")
                       }
                    }
                  if(ppp<0)
                    {
                     ppp <- abs(ppp);
                     if(distr %in% sdistr)
                       {
                        if(!partial)
                          {
                           names(catdynres$Model$Parameters) <- c("M","N0",paste("P",1:ppp,sep=""),"k","alpha","beta")
                          }
                        if(partial)
                          {
                           names(catdynres$Model$Parameters) <- c("M","N0",paste(c("P","Q"),sort(rep(1:ppp,2)),sep=""),"k","alpha","beta")
                          }
                       }
                     if(!distr %in% sdistr)
                       {
                        if(!partial)
                          {
                           names(catdynres$Model$Parameters) <- c("M","N0",paste("P",1:ppp,sep=""),"k","alpha","beta","psi")
                          }
                        if(partial)
                          {
                           names(catdynres$Model$Parameters) <- c("M","N0",paste(c("P","Q"),sort(rep(1:ppp,2)),sep=""),"k","alpha","beta","psi")
                          }
                       }
                    }
                  catdynres$Model$Results           <- data.frame(period=ts.start:ts.end,
                                                                  obseff1=obseff1,
                                                                  obscat.n=obscat1,
                                                                  predcat.n=predcat1,
                                                                  obscat.w=obscat.w,
                                                                  predcat.w=predcat.w,
                                                                  deviance=Likel[[2]],
                                                                  likcontr=Likel[[3]],
                                                                  devresid=Likel[[4]],
                                                                  npred=nstep,
                                                                  biompred=biom,
                                                                  obsexplot=NA,
                                                                  predexplot=NA,
                                                                  F.obsexplot=NA,
                                                                  F.predexplot=NA);
                  if(properties$Units[2] == "ind")
                    {
                     catdynres$Model$Results$obsexplot  <- obscat1/nstep
                     catdynres$Model$Results$predexplot <- predcat1/nstep
                     obsexplot.n                        <- obscat1/nstep
                     predexplot.n                       <- predcat1/nstep
                    }
                  if(properties$Units[2] != "ind")
                    {
                     catdynres$Model$Results$obsexplot   <- 1e-3*obscat.w/biom
                     catdynres$Model$Results$predexplot  <- 1e-3*predcat.w/biom
                     obsexplot.n                         <- obscat1/nstep
                     predexplot.n                        <- predcat1/nstep
                    }
                  for(t in 1:(ts.end-ts.start+1))
                    {
                     #if(biom[t]==0)
                     #  {
                     #   catdynres$Model$Results$biompred[t]  <- NA
                     #   catdynres$Model$Results$obsexplot[t]  <- NA
                     #   catdynres$Model$Results$predexplot[t] <- NA
                     #  }
                     catdynres$Model$Results$F.obsexplot[t]  <- ifelse(obsexplot.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),obsexplot.n[t],extendInt="yes")$root)
                     catdynres$Model$Results$F.predexplot[t] <- ifelse(predexplot.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),predexplot.n[t],extendInt="yes")$root)
                    }
                  names(catdynres$Model$Results)    <- c(paste("Period",properties$Units[1],sep="."),
                                                         paste("Effort",properties$Fleets[1,2],sep="."),
                                                         paste("Observed.Catch",properties$Units[4],sep="."),
                                                         paste("Predicted.Catch",properties$Units[4],sep="."),
                                                         "Observed.Catch.kg",
                                                         "Predicted.Catch.kg",
                                                         "Deviance",
                                                         "Likelihood",
                                                         "Deviance.Residuals",
                                                         paste("Predicted.Abundance",properties$Units[4],sep="."),
                                                         "Predicted.Biomass.tonnes",
                                                         "Observed.Explotrate",
                                                         "Predicted.Explotrate",
                                                         paste("Observed.F.1/",properties$Units[1],sep=""),
                                                         paste("Predicted.F.1/",properties$Units[1],sep=""))
                  return(catdynres);
  }
#
.CatDynExp2F.Res <- function(properties,nstep,obsmbm1,obsmbm2,ppp,dates,distr,par,Likel,ts.start,ts.end,obseff1,obscat1,predcat1,obseff2,obscat2,predcat2)
  {
                  sdistr.set <- c("poisson","apnormal","aplnormal");
                  fleet.name <- properties$Fleets$Fleet
                  if(properties$Units[2] == "ind")
                    {
                     biom <- NA
                    }
                  else
                    {
                     #Set biom in tonnes for both units of individual body weight
                     #Set obscat.w, predcat.w in kg for both units of individual body weight
                     biom <- mean(c(obsmbm1*(1e-6*(properties$Units[3] == "g")+
                                             1e-3*(properties$Units[3] == "kg")),
                                    obsmbm2*(1e-6*(properties$Units[3] == "g")+
                                             1e-3*(properties$Units[3] == "kg"))),na.rm=TRUE)*
                             nstep*(1e9*(properties$Units[4] == "bill")+
                                    1e6*(properties$Units[4] == "mill")+
                                    1e3*(properties$Units[4] == "thou")+
                                    1e2*(properties$Units[4] == "hund"))
                     obscat1.w <- obsmbm1*(1e-3*(properties$Units[3] == "g")+
                                           1e0*(properties$Units[3] == "kg"))*
                                  obscat1*(1e9*(properties$Units[4] == "bill")+
                                           1e6*(properties$Units[4] == "mill")+
                                           1e3*(properties$Units[4] == "thou")+
                                           1e2*(properties$Units[4] == "hund"))
                     predcat1.w <- obsmbm1*(1e-3*(properties$Units[3] == "g")+
                                            1e0*(properties$Units[3] == "kg"))*
                                   predcat1*(1e9*(properties$Units[4] == "bill")+
                                             1e6*(properties$Units[4] == "mill")+
                                             1e3*(properties$Units[4] == "thou")+
                                             1e2*(properties$Units[4] == "hund"))
                     obscat2.w <- obsmbm2*(1e-3*(properties$Units[3] == "g")+
                                           1e0*(properties$Units[3] == "kg"))*
                                  obscat2*(1e9*(properties$Units[4] == "bill")+
                                           1e6*(properties$Units[4] == "mill")+
                                           1e3*(properties$Units[4] == "thou")+
                                           1e2*(properties$Units[4] == "hund"))
                     predcat2.w <- obsmbm2*(1e-3*(properties$Units[3] == "g")+
                                            1e0*(properties$Units[3] == "kg"))*
                                   predcat2*(1e9*(properties$Units[4] == "bill")+
                                             1e6*(properties$Units[4] == "mill")+
                                             1e3*(properties$Units[4] == "thou")+
                                             1e2*(properties$Units[4] == "hund"))
                    }
                  catdynres                         <- vector("list",2);
                  names(catdynres)                  <- c("Properties","Model");
                  catdynres$Properties              <- properties;
                  catdynres$Model                   <- vector("list",5);
                  names(catdynres$Model)            <- c("Type","Dates","Distribution","Parameters","Results");
                  catdynres$Model$Type              <- ppp;
                  catdynres$Model$Dates             <- dates;
                  catdynres$Model$Distribution      <- distr;
                  catdynres$Model$Parameters        <- exp(par);
                  if(ppp == c(0,0))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else if(ppp == c(0,1))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else if(ppp == c(0,2))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else if(ppp == c(0,3))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else if(ppp == c(0,4))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else if(ppp == c(0,5))
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                         c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                      c(rep(fleet.name[1],3+ppp[1]),rep(fleet.name[2],3+ppp[2])),sep=""),
                                                paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                       }
                    }
                  else
                    {
                     if(sum(distr%in%sdistr.set) == 2)
                       {
                        par.names <- c("M","N0",paste("P",1:ppp[1],".",fleet.name[1],sep=""),
                                                paste(c("k.","alpha.","beta."),fleet.name[1],sep=""),
                                                paste("P",1:ppp[2],".",fleet.name[2],sep=""),
                                                paste(c("k.","alpha.","beta."),fleet.name[2],sep=""));
                       }
                     if(sum(distr%in%sdistr.set) == 1)
                       {
                        if(distr[1]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste("P",1:ppp[1],".",fleet.name[1],sep=""),
                                                   paste(c("k.","alpha.","beta."),fleet.name[1],sep=""),
                                                   paste("P",1:ppp[2],".",fleet.name[2],sep=""),
                                                   paste(c("k.","alpha.","beta."),fleet.name[2],sep=""),
                                                   paste("psi2.",fleet.name[2],sep=""));
                          }
                        if(distr[2]%in%sdistr.set)
                          {
                           par.names <- c("M","N0",paste("P",1:ppp[1],".",fleet.name[1],sep=""),
                                                   paste(c("k.","alpha.","beta."),fleet.name[1],sep=""),
                                                   paste("P",1:ppp[2],".",fleet.name[2],sep=""),
                                                   paste(c("k.","alpha.","beta."),fleet.name[2],sep=""),
                                                   paste("psi1.",fleet.name[1],sep=""));
                          }
                       }
                     if(sum(distr%in%sdistr.set) == 0)
                       {
                        par.names <- c("M","N0",paste("P",1:ppp[1],".",fleet.name[1],sep=""),
                                                paste(c("k.","alpha.","beta."),fleet.name[1],sep=""),
                                                paste("P",1:ppp[2],".",fleet.name[2],sep=""),
                                                paste(c("k.","alpha.","beta."),fleet.name[2],sep=""),
                                                paste("psi.",fleet.name[1],sep=""),paste("psi.",fleet.name[2],sep=""));
                       }
                    }
                  names(catdynres$Model$Parameters) <- par.names;
                  catdynres$Model$Results           <- data.frame(period=ts.start:ts.end,
                                                                  obseff1=obseff1,
                                                                  obscat1.n=obscat1,
                                                                  predcat1.n=predcat1,
                                                                  obscat1.w=obscat1.w,
                                                                  predcat1.w=predcat1.w,
                                                                  deviance1=Likel[[2]][1],
                                                                  likcontr1=Likel[[3]][1],
                                                                  devresid1=Likel[[4]][1],
                                                                  obseff2=obseff2,
                                                                  obscat2.n=obscat2,
                                                                  predcat2.n=predcat2,
                                                                  obscat2.w=obscat2.w,
                                                                  predcat2.w=predcat2.w,
                                                                  deviance2=Likel[[2]][2],
                                                                  likcontr2=Likel[[3]][2],
                                                                  devresid2=Likel[[4]][2],
                                                                  npred=nstep,
                                                                  biompred=biom,
                                                                  obsexplot1=NA,
                                                                  predexplot1=NA,
                                                                  obsexplot2=NA,
                                                                  predexplot2=NA,
                                                                  obsexplot=NA,
                                                                  predexplot=NA,
                                                                  F.obsexplot1=NA,
                                                                  F.predexplot1=NA,
                                                                  F.obsexplot2=NA,
                                                                  F.predexplot2=NA,
                                                                  F.obsexplot=NA,
                                                                  F.predexplot=NA);
                  if(properties$Units[2] == "ind")
                    {
                     catdynres$Model$Results$obsexplot1  <- obscat1/nstep
                     catdynres$Model$Results$predexplot1 <- predcat1/nstep
                     catdynres$Model$Results$obsexplot2  <- obscat2/nstep
                     catdynres$Model$Results$predexplot2 <- predcat2/nstep
                     catdynres$Model$Results$obsexplot   <- (obscat1+obscat2)/nstep
                     catdynres$Model$Results$predexplot  <- (predcat1+predcat2)/nstep
                    }
                  if(properties$Units[2] != "ind")
                    {
                     catdynres$Model$Results$obsexplot1  <- 1e-3*obscat1/biom
                     catdynres$Model$Results$predexplot1 <- 1e-3*predcat1/biom
                     catdynres$Model$Results$obsexplot2  <- 1e-3*obscat2/biom
                     catdynres$Model$Results$predexplot2 <- 1e-3*predcat2/biom
                     catdynres$Model$Results$obsexplot   <- 1e-3*(obscat1+obscat2)/biom
                     catdynres$Model$Results$predexplot  <- 1e-3*(predcat1+predcat2)/biom
                     obsexplot1.n                        <- obscat1/nstep
                     predexplot1.n                       <- predcat1/nstep
                     obsexplot2.n                        <- obscat2/nstep
                     predexplot2.n                       <- predcat2/nstep
                     obsexplot.n                         <- (obscat1+obscat2)/nstep
                     predexplot.n                        <- (predcat1+predcat2)/nstep
                    }
                  for(t in 1:(ts.end-ts.start+1))
                    {
                     if(biom[t]==0)
                       {
                        catdynres$Model$Results$biompred[t]    <- NA
                        catdynres$Model$Results$obsexplot1[t]  <- NA
                        catdynres$Model$Results$predexplot1[t] <- NA
                        catdynres$Model$Results$obsexplot2[t]  <- NA
                        catdynres$Model$Results$predexplot2[t] <- NA
                        catdynres$Model$Results$obsexplot[t]   <- NA
                        catdynres$Model$Results$predexplot[t]  <- NA
                       }
                     catdynres$Model$Results$F.obsexplot1[t]  <- ifelse(obsexplot1.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),obsexplot1.n[t], extendInt = "yes")$root)
                     catdynres$Model$Results$F.predexplot1[t] <- ifelse(predexplot1.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),predexplot1.n[t], extendInt = "yes")$root)
                     catdynres$Model$Results$F.obsexplot2[t]  <- ifelse(obsexplot2.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),obsexplot2.n[t], extendInt = "yes")$root)
                     catdynres$Model$Results$F.predexplot2[t] <- ifelse(predexplot2.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),predexplot2.n[t], extendInt = "yes")$root)
                     catdynres$Model$Results$F.obsexplot[t]   <- ifelse(obsexplot.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),obsexplot.n[t], extendInt = "yes")$root)
                     catdynres$Model$Results$F.predexplot[t]  <- ifelse(predexplot.n[t]==0,0,uniroot(.F.explotrate,c(1e-9,1e1),exp(par[1]),predexplot.n[t], extendInt = "yes")$root)
                    }
                  names(catdynres$Model$Results) <- c(paste("Period.",properties$Units[1],sep=""),
                                                      paste("Effort",properties$Fleets[1,1],properties$Fleets[1,2],sep="."),
                                                      paste("Observed.Catch",properties$Fleets[1,1],properties$Units[4],sep="."),
                                                      paste("Predicted.Catch",properties$Fleets[1,1],properties$Units[4],sep="."),
                                                      paste("Observed.Catch",properties$Fleets[1,1],"kg",sep="."),
                                                      paste("Predicted.Catch",properties$Fleets[1,1],"kg",sep="."),
                                                      paste("Deviance",properties$Fleets[1,1],properties$Units[4],sep="."),
                                                      paste("Likelihood",properties$Fleets[1,1],properties$Units[4],sep="."),
                                                      paste("Deviance.Residuals",properties$Fleets[1,1],properties$Units[4],sep="."),
                                                      paste("Effort",properties$Fleets[2,1],properties$Fleets[2,2],sep="."),
                                                      paste("Observed.Catch",properties$Fleets[2,1],properties$Units[4],sep="."),
                                                      paste("Predicted.Catch",properties$Fleets[2,1],properties$Units[4],sep="."),
                                                      paste("Observed.Catch",properties$Fleets[2,1],"kg",sep="."),
                                                      paste("Predicted.Catch",properties$Fleets[2,1],"kg",sep="."),
                                                      paste("Deviance",properties$Fleets[2,1],properties$Units[4],sep="."),
                                                      paste("Likelihood",properties$Fleets[2,1],properties$Units[4],sep="."),
                                                      paste("Deviance.Residuals",properties$Fleets[2,1],properties$Units[4],sep="."),
                                                      paste("Predicted.Abundance",properties$Units[4],sep="."),
                                                      "Predicted.Biomass.tonnes",
                                                      paste("Observed.Explotrate",properties$Fleets[1,1],sep="."),
                                                      paste("Predicted.Explotrate",properties$Fleets[1,1],sep="."),
                                                      paste("Observed.Explotrate",properties$Fleets[2,1],sep="."),
                                                      paste("Predicted.Explotrate",properties$Fleets[2,1],sep="."),
                                                      "Observed.Explotrate.Total",
                                                      "Predicted.Explotrate.Total",
                                                      paste("Observed.F",properties$Fleets[1,1],"1/",properties$Units[1],sep="."),
                                                      paste("Predicted.F",properties$Fleets[1,1],"1/",properties$Units[1],sep="."),
                                                      paste("Observed.F",properties$Fleets[2,1],"1/",properties$Units[1],sep="."),
                                                      paste("Predicted.F",properties$Fleets[2,1],"1/",properties$Units[1],sep="."),
                                                      paste("Observed.F.Total","1/",properties$Units[1],sep="."),
                                                      paste("Predicted.F.Total","1/",properties$Units[1],sep="."))
                  return(catdynres);
  }
#########################  V - MODEL EXPLORATORY WRAPPER  ######################
#
catdynexp <- function(x, p, par, dates, distr, partial=TRUE)
    {
     fleet.name <- x$Properties$Fleets$Fleet
     distr.set  <- c("poisson","negbin","normal","apnormal","lognormal","aplnormal","gamma","gumbel","roblognormal")
     if(class(x) != "CatDynData") {stop("Pass an object of class CatDynData as first argument - see the help for as.CatDynData")}
     if(any(is.na(p))) {stop("NAs are not allowed in the perturbations per fleet vector 'p'")}
     if(length(p) < 1 || length(p) > 2) {stop("The integer vector 'p' determines the number of perturbations per fleet; its length must be 1 for single fleet, 2 for two fleets")}
     if(any(p < -25) || any(p > 25)) {stop("Parameter p, the number of perturbations per fleet shall not be more than 25, not less than -25 for transit fisheries")}
     if(class(p) != "numeric") {stop("'p' must be a numeric vector or a scalar")}
     if(any(is.na(par))) {stop("NAs are not allowed in the parameter vector 'par'")}
     if(length(par) < 4 || length(par) > 60) {stop("For any of the model versions the number of parameters is > 3 and < 61")}
     if(class(par) != "numeric") {stop("'par' must be a numeric vector")}
     if(any(is.na(dates))){stop("NAs are not allowed in the dates vector")}
     if(dates[1] > dates[2]) {stop("Initial date must not be more than next date")}
     if(tail(dates,1) < tail(dates,2)[1]) {stop("Final date must not be less than previous date")}
     options(warn=-1)
     if(length(fleet.name) == 1)
       {
        if(p >= 0)
          {
           if(sum(sort(p) == p)<length(p)) {stop("Number of perturbations per fleet must not be arranged in descending order")}
           if(length(dates) != (sum(p)+2)) {stop("The dates vector must contain initial time step, time steps of all perturbations, and final time step")}
           if(sum(sort(dates) == dates)<length(dates)){stop("Dates must be arranged in ascending order")}
          }
        if(p < 0)
          {
          if(length(dates) != (2*abs(p)+2)) {stop("The dates vector must contain initial time step, time step of entry of each perturbation \n immediately followed by time step of its exit, for all perturbations ordered by time of entry, and final time step")}
          }
        if(!distr%in%distr.set)
          {stop("distr must be a length-1 character vector with either 'poisson', 'negbin', 'normal', 'apnormal', 'lognormal', 'aplnormal', 'gamma', 'roblognormal', or 'gumbel' ")}
        parlist <- list(par=par, 
                        dates=dates, 
                        obseff1=x$Data[[fleet.name]][,2], 
                        obscat1=x$Data[[fleet.name]][,5], 
                        obsmbm1=x$Data[[fleet.name]][,4], 
                        distr=distr, 
                        properties=x$Properties,
                        partial=partial,
                        output="predict");
        if(p==0)
          {
          if(length(dates) != 2)
            {
             stop("For a 1-fleet 0 perturbation (simple depletion model) dates must be a vector with the following time step marks: initial, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 5)
               {
                stop("For a 1-fleet 0 perturbation (simple depletion model) fit with poisson or adjusted profile likelihood par must be a vector of length 5")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 6)
               {
                stop("For a 1-fleet 0 perturbation (simple depletion model) fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 6")
               }
            }
          results <- do.call(.CDMN0P, parlist);
          }
        if(p==1)
          {
          if(length(dates) != 3)
            {
             stop("For a 1-fleet 1-perturbation model dates must be a vector with the following time step marks: initial, perturbation 1, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 6)
               {
                stop("For a 1-fleet 1 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 6")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 7)
               {
                stop("For a 1-fleet 1 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 7")
               }
            }
          results <- do.call(.CDMN1P, parlist);
          }
        if(p==2)
          {
          if(length(dates) != 4)
            {
             stop("For a 1-fleet 2-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, perturbation 2, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 7)
               {
                stop("For a 1-fleet 2 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 7")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 8)
               {
                stop("For a 1-fleet 2 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
               }
            }
          results <- do.call(.CDMN2P, parlist);
          }
        if(p==3)
          {
          if(length(dates) != 5)
            {
             stop("For a 1-fleet 3-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, perturbation 2, perturbation 3, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 8)
               {
                stop("For a 1-fleet 3 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 8")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 9)
               {
                stop("For a 1-fleet 3 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 9")
               }
            }
          results <- do.call(.CDMN3P, parlist);
          }
        if(p==4)
          {
          if(length(dates) != 6)
            {
             stop("For a 1-fleet 4-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 4, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 9)
               {
                stop("For a 1-fleet 4 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 9")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 10)
               {
                stop("For a 1-fleet 4 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
               }
            }
          results <- do.call(.CDMN4P, parlist);
          }
        if(p==5)
          {
          if(length(dates) != 7)
            {
             stop("For a 1-fleet 5-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 5, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 10)
               {
                stop("For a 1-fleet 5 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 10")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 11)
               {
                stop("For a 1-fleet 5 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 11")
               }
            }
          results <- do.call(.CDMN5P, parlist);
          }
        if(p==6)
          {
          if(length(dates) != 8)
            {
             stop("For a 1-fleet 6-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 6, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 11)
               {
                stop("For a 1-fleet 6 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 11")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 12)
               {
                stop("For a 1-fleet 6 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
               }
            }
          results <- do.call(.CDMN6P, parlist);
          }
        if(p==7)
          {
          if(length(dates) != 9)
            {
             stop("For a 1-fleet 7-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 7, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 12)
               {
                stop("For a 1-fleet 7 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 12")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 13)
               {
                stop("For a 1-fleet 7 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 13")
               }
            }
          results <- do.call(.CDMN7P, parlist);
          }
        if(p==8)
          {
          if(length(dates) != 10)
            {
             stop("For a 1-fleet 8-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 8, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 13)
               {
                stop("For a 1-fleet 8 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 13")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 14)
               {
                stop("For a 1-fleet 8 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
               }
            }
          results <- do.call(.CDMN8P, parlist);
          }
        if(p==9)
          {
          if(length(dates) != 11)
            {
             stop("For a 1-fleet 9-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 9, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 14)
               {
                stop("For a 1-fleet 9 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 14")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 15)
               {
                stop("For a 1-fleet 9 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 15")
               }
            }
          results <- do.call(.CDMN9P, parlist);
          }
        if(p==10)
          {
          if(length(dates) != 12)
            {
             stop("For a 1-fleet 10-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 10, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 15)
               {
                stop("For a 1-fleet 10 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 15")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 16)
               {
                stop("For a 1-fleet 10 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
               }
            }
          results <- do.call(.CDMN10P, parlist);
          }
        if(p==11)
          {
          if(length(dates) != 13)
            {
             stop("For a 1-fleet 11-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 11, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 16)
               {
                stop("For a 1-fleet 11 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 16")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 17)
               {
                stop("For a 1-fleet 11 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 17")
               }
            }
          results <- do.call(.CDMN11P, parlist);
          }
        if(p==12)
          {
          if(length(dates) != 14)
            {
             stop("For a 1-fleet 12-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 12, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 17)
               {
                stop("For a 1-fleet 12 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 17")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 18)
               {
                stop("For a 1-fleet 12 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
               }
            }
          results <- do.call(.CDMN12P, parlist);
          }
        if(p==13)
          {
          if(length(dates) != 15)
            {
             stop("For a 1-fleet 13-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 13, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 18)
               {
                stop("For a 1-fleet 13 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 18")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 19)
               {
                stop("For a 1-fleet 13 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 19")
               }
            }
          results <- do.call(.CDMN13P, parlist);
          }
        if(p==14)
          {
          if(length(dates) != 16)
            {
             stop("For a 1-fleet 14-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 14, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 19)
               {
                stop("For a 1-fleet 14 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 19")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 20)
               {
                stop("For a 1-fleet 14 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 20")
               }
            }
          results <- do.call(.CDMN14P, parlist);
          }
        if(p==15)
          {
          if(length(dates) != 17)
            {
             stop("For a 1-fleet 15-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 15, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 20)
               {
                stop("For a 1-fleet 15 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 20")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 21)
               {
                stop("For a 1-fleet 15 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 21")
               }
            }
          results <- do.call(.CDMN15P, parlist);
          }
        if(p==16)
          {
          if(length(dates) != 18)
            {
             stop("For a 1-fleet 16-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 16, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 21)
               {
                stop("For a 1-fleet 16 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 21")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 22)
               {
                stop("For a 1-fleet 16 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 22")
               }
            }
          results <- do.call(.CDMN16P, parlist);
          }
        if(p==17)
          {
          if(length(dates) != 19)
            {
             stop("For a 1-fleet 17-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 17, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 22)
               {
                stop("For a 1-fleet 17 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 22")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 23)
               {
                stop("For a 1-fleet 17 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 23")
               }
            }
          results <- do.call(.CDMN17P, parlist);
          }
        if(p==18)
          {
          if(length(dates) != 20)
            {
             stop("For a 1-fleet 18-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 18, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 23)
               {
                stop("For a 1-fleet 18 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 23")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 24)
               {
                stop("For a 1-fleet 18 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 24")
               }
            }
          results <- do.call(.CDMN18P, parlist);
          }
        if(p==19)
          {
          if(length(dates) != 21)
            {
             stop("For a 1-fleet 19-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 19, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 24)
               {
                stop("For a 1-fleet 19 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 24")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 25)
               {
                stop("For a 1-fleet 19 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 25")
               }
            }
          results <- do.call(.CDMN19P, parlist);
          }
        if(p==20)
          {
          if(length(dates) != 22)
            {
             stop("For a 1-fleet 20-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 20, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 25)
               {
                stop("For a 1-fleet 20 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 25")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 26)
               {
                stop("For a 1-fleet 20 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 26")
               }
            }
          results <- do.call(.CDMN20P, parlist);
          }
        if(p==21)
          {
          if(length(dates) != 23)
            {
             stop("For a 1-fleet 21-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 21, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 26)
               {
                stop("For a 1-fleet 21 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 26")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 27)
               {
                stop("For a 1-fleet 21 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 27")
               }
            }
          results <- do.call(.CDMN21P, parlist);
          }
        if(p==22)
          {
          if(length(dates) != 24)
            {
             stop("For a 1-fleet 22-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 22, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 27)
               {
                stop("For a 1-fleet 22 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 27")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 28)
               {
                stop("For a 1-fleet 22 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 28")
               }
            }
          results <- do.call(.CDMN22P, parlist);
          }
        if(p==23)
          {
          if(length(dates) != 25)
            {
             stop("For a 1-fleet 23-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 23, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 28)
               {
                stop("For a 1-fleet 23 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 28")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 29)
               {
                stop("For a 1-fleet 23 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 29")
               }
            }
          results <- do.call(.CDMN23P, parlist);
          }
        if(p==24)
          {
          if(length(dates) != 26)
            {
             stop("For a 1-fleet 24-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 24, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 29)
               {
                stop("For a 1-fleet 24 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 29")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 30)
               {
                stop("For a 1-fleet 24 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 30")
               }
            }
          results <- do.call(.CDMN24P, parlist);
          }
        if(p==25)
          {
          if(length(dates) != 27)
            {
             stop("For a 1-fleet 25-perturbations model dates must be a vector with the following time step marks: initial, perturbation 1, ..., perturbation 25, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(length(par) != 30)
               {
                stop("For a 1-fleet 25 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 30")
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(length(par) != 31)
               {
                stop("For a 1-fleet 25 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 31")
               }
            }
          results <- do.call(.CDMN25P, parlist);
          }
        #Partial emigration (partial=TRUE) and transit (partial=FALSE) models
        if(p==-1)
          {
          if(length(dates) != 4)
            {
             stop("For a 1-fleet 1-perturbation transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 7)
                  {
                   stop("For a 1-fleet 1 perturbation transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 7")
                  }
               }
             if(!partial)
               {
                if(length(par) != 6)
                  {
                   stop("For a 1-fleet 1 perturbation transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 6")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 8)
                  {
                   stop("For a 1-fleet 1 perturbation transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
                  }
               }
             if(!partial)
               {
                if(length(par) != 7)
                  {
                   stop("For a 1-fleet 1 perturbation transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 7")
                  }
               }
            }
          results <- do.call(.CDMNT1P, parlist);
          }
        if(p==-2)
          {
          if(length(dates) != 6)
            {
             stop("For a 1-fleet 2-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, perturbation 2, exit 2, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 9)
                  {
                   stop("For a 1-fleet 2 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 9")
                  }
               }
             if(!partial)
               {
                if(length(par) != 7)
                  {
                   stop("For a 1-fleet 2 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 7")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 10)
                  {
                   stop("For a 1-fleet 2 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
                  }
               }
             if(!partial)
               {
                if(length(par) != 8)
                  {
                   stop("For a 1-fleet 2 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
                  }
               }
            }
          results <- do.call(.CDMNT2P, parlist);
          }
        if(p==-3)
          {
          if(length(dates) != 8)
            {
             stop("For a 1-fleet 3-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, perturbation 2, exit 2, perturbation 3, exit 3, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 11)
                  {
                   stop("For a 1-fleet 3 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 11")
                  }
               }
             if(!partial)
               {
                if(length(par) != 8)
                  {
                   stop("For a 1-fleet 3 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 8")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 12)
                  {
                   stop("For a 1-fleet 3 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
                  }
               }
             if(!partial)
               {
                if(length(par) != 9)
                  {
                   stop("For a 1-fleet 3 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 9")
                  }
               }
            }
          results <- do.call(.CDMNT3P, parlist);
          }
        if(p==-4)
          {
          if(length(dates) != 10)
            {
             stop("For a 1-fleet 4-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 4, exit 4, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 13)
                  {
                   stop("For a 1-fleet 4 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 13")
                  }
               }
             if(!partial)
               {
                if(length(par) != 9)
                  {
                   stop("For a 1-fleet 4 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 9")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 14)
                  {
                   stop("For a 1-fleet 4 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
                  }
               }
             if(!partial)
               {
                if(length(par) != 10)
                  {
                   stop("For a 1-fleet 4 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
                  }
               }
            }
          results <- do.call(.CDMNT4P, parlist);
          }
        if(p==-5)
          {
          if(length(dates) != 12)
            {
             stop("For a 1-fleet 5-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 5, exit 6, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 15)
                  {
                   stop("For a 1-fleet 5 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 15")
                  }
               }
             if(!partial)
               {
                if(length(par) != 10)
                  {
                   stop("For a 1-fleet 5 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 10")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 16)
                  {
                   stop("For a 1-fleet 5 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
                  }
               }
             if(!partial)
               {
                if(length(par) != 11)
                  {
                   stop("For a 1-fleet 5 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 11")
                  }
               }
            }
          results <- do.call(.CDMNT5P, parlist);
          }
        if(p==-6)
          {
          if(length(dates) != 14)
            {
             stop("For a 1-fleet 6-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 6, exit 6, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 17)
                  {
                   stop("For a 1-fleet 6 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 17")
                  }
               }
             if(!partial)
               {
                if(length(par) != 11)
                  {
                   stop("For a 1-fleet 6 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 11")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 18)
                  {
                   stop("For a 1-fleet 6 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
                  }
               }
             if(!partial)
               {
                if(length(par) != 12)
                  {
                   stop("For a 1-fleet 6 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
                  }
               }
            }
          results <- do.call(.CDMNT6P, parlist);
          }
        if(p==-7)
          {
          if(length(dates) != 16)
            {
             stop("For a 1-fleet 7-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 7, exit 7, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 19)
                  {
                   stop("For a 1-fleet 7 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 19")
                  }
               }
             if(!partial)
               {
                if(length(par) != 12)
                  {
                   stop("For a 1-fleet 7 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 12")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 20)
                  {
                   stop("For a 1-fleet 7 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 20")
                  }
               }
             if(!partial)
               {
                if(length(par) != 13)
                  {
                   stop("For a 1-fleet 7 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 13")
                  }
               }
            }
          results <- do.call(.CDMNT7P, parlist);
          }
        if(p==-8)
          {
          if(length(dates) != 18)
            {
             stop("For a 1-fleet 8-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 8, exit 8, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 21)
                  {
                   stop("For a 1-fleet 8 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 21")
                  }
               }
             if(!partial)
               {
                if(length(par) != 13)
                  {
                   stop("For a 1-fleet 8 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 13")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 22)
                  {
                   stop("For a 1-fleet 8 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 22")
                  }
               }
             if(!partial)
               {
                if(length(par) != 14)
                  {
                   stop("For a 1-fleet 8 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
                  }
               }
            }
          results <- do.call(.CDMNT8P, parlist);
          }
        if(p==-9)
          {
          if(length(dates) != 20)
            {
             stop("For a 1-fleet 9-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 9, exit 9, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 23)
                  {
                   stop("For a 1-fleet 9 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 23")
                  }
               }
             if(!partial)
               {
                if(length(par) != 14)
                  {
                   stop("For a 1-fleet 9 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 14")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 24)
                  {
                   stop("For a 1-fleet 9 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 24")
                  }
               }
             if(!partial)
               {
                if(length(par) != 15)
                  {
                   stop("For a 1-fleet 9 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 15")
                  }
               }
            }
          results <- do.call(.CDMNT9P, parlist);
          }
        if(p==-10)
          {
          if(length(dates) != 22)
            {
             stop("For a 1-fleet 10-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 10, exit 10, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 25)
                  {
                   stop("For a 1-fleet 10 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 25")
                  }
               }
             if(!partial)
               {
                if(length(par) != 15)
                  {
                   stop("For a 1-fleet 10 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 15")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 26)
                  {
                   stop("For a 1-fleet 10 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 26")
                  }
               }
             if(!partial)
               {
                if(length(par) != 16)
                  {
                   stop("For a 1-fleet 10 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
                  }
               }
            }
          results <- do.call(.CDMNT10P, parlist);
          }
        if(p==-11)
          {
          if(length(dates) != 24)
            {
             stop("For a 1-fleet 11-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 11, exit 11, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 27)
                  {
                   stop("For a 1-fleet 11 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 27")
                  }
               }
             if(!partial)
               {
                if(length(par) != 16)
                  {
                   stop("For a 1-fleet 11 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 16")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 28)
                  {
                   stop("For a 1-fleet 11 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 28")
                  }
               }
             if(!partial)
               {
                if(length(par) != 17)
                  {
                   stop("For a 1-fleet 11 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 17")
                  }
               }
            }
          results <- do.call(.CDMNT11P, parlist);
          }
        if(p==-12)
          {
          if(length(dates) != 26)
            {
             stop("For a 1-fleet 12-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 12, exit 12, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 29)
                  {
                   stop("For a 1-fleet 12 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 29")
                  }
               }
             if(!partial)
               {
                if(length(par) != 17)
                  {
                   stop("For a 1-fleet 12 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 17")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 30)
                  {
                   stop("For a 1-fleet 12 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 30")
                  }
               }
             if(!partial)
               {
                if(length(par) != 18)
                  {
                   stop("For a 1-fleet 12 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
                  }
               }
            }
          results <- do.call(.CDMNT12P, parlist);
          }
        if(p==-13)
          {
          if(length(dates) != 28)
            {
             stop("For a 1-fleet 13-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 13, exit 13, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 31)
                  {
                   stop("For a 1-fleet 13 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 31")
                  }
               }
             if(!partial)
               {
                if(length(par) != 18)
                  {
                   stop("For a 1-fleet 13 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 18")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 32)
                  {
                   stop("For a 1-fleet 13 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 32")
                  }
               }
             if(!partial)
               {
                if(length(par) != 19)
                  {
                   stop("For a 1-fleet 13 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 19")
                  }
               }
            }
          results <- do.call(.CDMNT13P, parlist);
          }
        if(p==-14)
          {
          if(length(dates) != 30)
            {
             stop("For a 1-fleet 14-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 14, exit 14, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 33)
                  {
                   stop("For a 1-fleet 14 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 33")
                  }
               }
             if(!partial)
               {
                if(length(par) != 19)
                  {
                   stop("For a 1-fleet 14 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 19")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 34)
                  {
                   stop("For a 1-fleet 14 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 34")
                  }
               }
             if(!partial)
               {
                if(length(par) != 20)
                  {
                   stop("For a 1-fleet 14 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 20")
                  }
               }
            }
          results <- do.call(.CDMNT14P, parlist);
          }
        if(p==-15)
          {
          if(length(dates) != 32)
            {
             stop("For a 1-fleet 15-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 15, exit 15, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 35)
                  {
                   stop("For a 1-fleet 15 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 35")
                  }
               }
             if(!partial)
               {
                if(length(par) != 20)
                  {
                   stop("For a 1-fleet 15 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 20")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 36)
                  {
                   stop("For a 1-fleet 15 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 36")
                  }
               }
             if(!partial)
               {
                if(length(par) != 21)
                  {
                   stop("For a 1-fleet 15 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 21")
                  }
               }
            }
          results <- do.call(.CDMNT15P, parlist);
          }
        if(p==-16)
          {
          if(length(dates) != 34)
            {
             stop("For a 1-fleet 16-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 16, exit 16, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 37)
                  {
                   stop("For a 1-fleet 16 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 37")
                  }
               }
             if(!partial)
               {
                if(length(par) != 21)
                  {
                   stop("For a 1-fleet 16 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 21")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 38)
                  {
                   stop("For a 1-fleet 16 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 38")
                  }
               }
             if(!partial)
               {
                if(length(par) != 22)
                  {
                   stop("For a 1-fleet 16 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 22")
                  }
               }
            }
          results <- do.call(.CDMNT16P, parlist);
          }
        if(p==-17)
          {
          if(length(dates) != 36)
            {
             stop("For a 1-fleet 17-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 17, exit 17, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 39)
                  {
                   stop("For a 1-fleet 17 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 39")
                  }
               }
             if(!partial)
               {
                if(length(par) != 22)
                  {
                   stop("For a 1-fleet 17 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 22")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 40)
                  {
                   stop("For a 1-fleet 17 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 40")
                  }
               }
             if(!partial)
               {
                if(length(par) != 23)
                  {
                   stop("For a 1-fleet 17 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 23")
                  }
               }
            }
          results <- do.call(.CDMNT17P, parlist);
          }
        if(p==-18)
          {
          if(length(dates) != 38)
            {
             stop("For a 1-fleet 18-perturbations model transit dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 18, exit 18, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 41)
                  {
                   stop("For a 1-fleet 18 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 41")
                  }
               }
             if(!partial)
               {
                if(length(par) != 23)
                  {
                   stop("For a 1-fleet 18 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 23")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 42)
                  {
                   stop("For a 1-fleet 18 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 42")
                  }
               }
             if(!partial)
               {
                if(length(par) != 24)
                  {
                   stop("For a 1-fleet 18 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 24")
                  }
               }
            }
          results <- do.call(.CDMNT18P, parlist);
          }
        if(p==-19)
          {
          if(length(dates) != 40)
            {
             stop("For a 1-fleet 19-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 19, exit 19, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 43)
                  {
                   stop("For a 1-fleet 19 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 43")
                  }
               }
             if(!partial)
               {
                if(length(par) != 24)
                  {
                   stop("For a 1-fleet 19 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 24")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 44)
                  {
                   stop("For a 1-fleet 19 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 44")
                  }
               }
             if(!partial)
               {
                if(length(par) != 25)
                  {
                   stop("For a 1-fleet 19 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 25")
                  }
               }
            }
          results <- do.call(.CDMNT19P, parlist);
          }
        if(p==-20)
          {
          if(length(dates) != 42)
            {
             stop("For a 1-fleet 20-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 20, exit 20, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 45)
                  {
                   stop("For a 1-fleet 20 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 45")
                  }
               }
             if(!partial)
               {
                if(length(par) != 25)
                  {
                   stop("For a 1-fleet 20 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 25")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 46)
                  {
                   stop("For a 1-fleet 20 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 46")
                  }
               }
             if(!partial)
               {
                if(length(par) != 26)
                  {
                   stop("For a 1-fleet 20 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 26")
                  }
               }
            }
          results <- do.call(.CDMNT20P, parlist);
          }
        if(p==-21)
          {
          if(length(dates) != 44)
            {
             stop("For a 1-fleet 21-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 21, exit 21, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 47)
                  {
                   stop("For a 1-fleet 21 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 47")
                  }
               }
             if(!partial)
               {
                if(length(par) != 26)
                  {
                   stop("For a 1-fleet 21 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 26")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 48)
                  {
                   stop("For a 1-fleet 21 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 48")
                  }
               }
             if(!partial)
               {
                if(length(par) != 27)
                  {
                   stop("For a 1-fleet 21 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 27")
                  }
               }
            }
          results <- do.call(.CDMNT21P, parlist);
          }
        if(p==-22)
          {
          if(length(dates) != 46)
            {
             stop("For a 1-fleet 22-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 22, exit 22, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 49)
                  {
                   stop("For a 1-fleet 22 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 49")
                  }
               }
             if(!partial)
               {
                if(length(par) != 27)
                  {
                   stop("For a 1-fleet 22 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 27")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 50)
                  {
                   stop("For a 1-fleet 22 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 50")
                  }
               }
             if(!partial)
               {
                if(length(par) != 28)
                  {
                   stop("For a 1-fleet 22 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 28")
                  }
               }
            }
          results <- do.call(.CDMNT22P, parlist);
          }
        if(p==-23)
          {
          if(length(dates) != 48)
            {
             stop("For a 1-fleet 23-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 23, exit 23, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 51)
                  {
                   stop("For a 1-fleet 23 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 51")
                  }
               }
             if(!partial)
               {
                if(length(par) != 28)
                  {
                   stop("For a 1-fleet 23 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 28")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 52)
                  {
                   stop("For a 1-fleet 23 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 52")
                  }
               }
             if(!partial)
               {
                if(length(par) != 29)
                  {
                   stop("For a 1-fleet 23 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 29")
                  }
               }
            }
          results <- do.call(.CDMNT23P, parlist);
          }
        if(p==-24)
          {
          if(length(dates) != 50)
            {
             stop("For a 1-fleet 24-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 24, exit 24, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 53)
                  {
                   stop("For a 1-fleet 24 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 53")
                  }
               }
             if(!partial)
               {
                if(length(par) != 29)
                  {
                   stop("For a 1-fleet 24 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 29")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 54)
                  {
                   stop("For a 1-fleet 24 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 54")
                  }
               }
             if(!partial)
               {
                if(length(par) != 30)
                  {
                   stop("For a 1-fleet 24 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 30")
                  }
               }
            }
          results <- do.call(.CDMNT24P, parlist);
          }
        if(p==-25)
          {
          if(length(dates) != 52)
            {
             stop("For a 1-fleet 25-perturbations transit model dates must be a vector with the following time step marks: initial, perturbation 1, exit 1, ..., perturbation 25, exit 25, final")
            }
          if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
            {
             if(partial)
               {
                if(length(par) != 55)
                  {
                   stop("For a 1-fleet 25 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 55")
                  }
               }
             if(!partial)
               {
                if(length(par) != 30)
                  {
                   stop("For a 1-fleet 25 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 30")
                  }
               }
            }
          if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
            {
             if(partial)
               {
                if(length(par) != 56)
                  {
                   stop("For a 1-fleet 25 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 56")
                  }
               }
             if(!partial)
               {
                if(length(par) != 31)
                  {
                   stop("For a 1-fleet 25 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 31")
                  }
               }
            }
          results <- do.call(.CDMNT25P, parlist);
          }
       }
     #Two fleets
     if(length(fleet.name) == 2)
       {
        partial <- partial
        if(p[1] > p[2])
          {stop("The number of perturbations of the first fleet must equal or less than the number of perturbations of the second fleet")}
        if(sum(distr%in%distr.set) != 2)
          {stop("'distr' must be a length-2 character vector with any of the 49 pairs that can be made with 'poisson','negbin','normal','apnormal','lognormal','aplnormal', 'gamma', 'roblognormal', or 'gumbel')")}
        parlist <- list(par=par,
                        dates=dates, 
                        obseff1=x$Data[[fleet.name[1]]][,2], 
                        obscat1=x$Data[[fleet.name[1]]][,5], 
                        obsmbm1=x$Data[[fleet.name[1]]][,4], 
                        obseff2=x$Data[[fleet.name[2]]][,2], 
                        obscat2=x$Data[[fleet.name[2]]][,5], 
                        obsmbm2=x$Data[[fleet.name[2]]][,4],
                        distr=distr, 
                        properties=x$Properties,
                        partial=partial,
                        output="predict");
        sdistr.set <- c("poisson","apnormal","aplnormal")
        if(sum(p == c(0,0)) == length(p))
          {
          if(length(dates) != 2)
            {
             stop("For a 2-fleet 0-perturbation 0-perturbation model dates must be a vector with the following time step marks: initial, and final time steps in the season")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 10)
               {
                stop("For a 2-fleet 0 perturbation model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 10 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 9)
               {
                stop("For a 2-fleet 0 perturbation model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 9 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 8)
               {
                stop("For a 2-fleet 0 perturbation model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 8")
               }
            }
          results <- do.call(.CDMN0P0P, parlist);
          }
        if(sum(p == c(0,1)) == length(p))
          {
          if(length(dates) != 3)
            {
             stop("For a 2-fleet 0P 1P model dates must be a vector with the following time step marks: initial, fleet 2 perturbation 1, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 11)
               {
                stop("For a 2-fleet 0P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 11 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 10)
               {
                stop("For a 2-fleet 0P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 10 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 9)
               {
                stop("For a 2-fleet 0P 1P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 9")
               }
            }
          results <- do.call(.CDMN0P1P, parlist);
          }
        if(sum(p == c(0,2)) == length(p))
          {
          if(length(dates) != 4)
            {
             stop("For a 2-fleet 0-perturbation 2-perturbation model dates must be a vector with the following time step marks: initial, fleet 2 perturbation 1, fleet 2 perturbation 2, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 0P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 12 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 11)
               {
                stop("For a 2-fleet 0P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 11 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 10)
               {
                stop("For a 2-fleet 0P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 10")
               }
            }
          results <- do.call(.CDMN0P2P, parlist);
          }
        if(sum(p == c(0,3)) == length(p))
          {
          if(length(dates) != 5)
            {
             stop("For a 2-fleet 0-perturbation 3-perturbation model dates must be a vector with the following time step marks: initial, fleet 2 perturbation 1, fleet 2 perturbation 2, fleet 2 perturbation 3, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 0P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 13 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 0P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 12 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 11)
               {
                stop("For a 2-fleet 0P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 11")
               }
            }
          results <- do.call(.CDMN0P3P, parlist);
          }
        if(sum(p == c(0,4)) == length(p))
          {
          if(length(dates) != 6)
            {
             stop("For a 2-fleet 0-perturbation 4-perturbation model dates must be a vector with the following time step marks: initial, fleet 2 perturbation 1, ..., fleet 2 perturbation 4, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 0P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 0P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 0P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
               }
            }
          results <- do.call(.CDMN0P4P, parlist);
          }
        if(sum(p == c(0,5)) == length(p))
          {
          if(length(dates) != 7)
            {
             stop("For a 2-fleet 0-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 0P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 0P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 0P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
               }
            }
          results <- do.call(.CDMN0P5P, parlist);
          }
        if(sum(p == c(1,1)) == length(p))
          {
          if(length(dates) != 4)
            {
             stop("For a 2-fleet 1-perturbation 1-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 2 perturbation 1, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 1P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 12 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 11)
               {
                stop("For a 2-fleet 1P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 11 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 10)
               {
                stop("For a 2-fleet 1P 1P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 10")
               }
            }
          results <- do.call(.CDMN1P1P, parlist);
          }                                                                                                                                            
        if(sum(p == c(1,2)) == length(p))
          {
          if(length(dates) != 5)
            {
             stop("For a 2-fleet 1-perturbation 2-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 2 perturbation 1, fleet 2 perturbation 2, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 1P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 13 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 1P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 12 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 11)
               {
                stop("For a 2-fleet 1P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 11")
               }
            }
          results <- do.call(.CDMN1P2P, parlist);
          }
        if(sum(p == c(1,3)) == length(p))
          {
          if(length(dates) != 6)
            {
             stop("For a 2-fleet 1-perturbation 3-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 2 perturbation 1, ..., fleet 2 perturbation 3, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 1P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 1P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 1P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
               }
            }
          results <- do.call(.CDMN1P3P, parlist);
          }
        if(sum(p == c(1,4)) == length(p))
          {
          if(length(dates) != 7)
            {
             stop("For a 2-fleet 1-perturbation 4-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 2 perturbation 1, ..., fleet 2 perturbation 4, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 1P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 1P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 1P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
               }
            }
          results <- do.call(.CDMN1P4P, parlist);
          }
        if(sum(p == c(1,5)) == length(p))
          {
          if(length(dates) != 8)
            {
             stop("For a 2-fleet 1-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 1P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 1P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 1P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
               }
            }
          results <- do.call(.CDMN1P5P, parlist);
          }
        if(sum(p == c(2,2)) == length(p))
          {
          if(length(dates) != 6)
            {
             stop("For a 2-fleet 2-perturbation 2-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 1 perturbation 2, fleet 2 perturbation 1, fleet 2 perturbation 2, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 2P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 2P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 12)
               {
                stop("For a 2-fleet 2P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
               }
            }
          results <- do.call(.CDMN2P2P, parlist);
          }
        if(sum(p == c(2,3)) == length(p))
          {
          if(length(dates) != 7)
            {
             stop("For a 2-fleet 2-perturbation 3-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 1 perturbation 2, fleet 2 perturbation 1, ..., fleet 2 perturbation 3, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 2P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 2P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 13)
               {
                stop("For a 2-fleet 2P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
               }
            }
          results <- do.call(.CDMN2P3P, parlist);
          }
        if(sum(p == c(2,4)) == length(p))
          {
          if(length(dates) != 8)
            {
             stop("For a 2-fleet 2-perturbation 4-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 1 perturbation 2, fleet 2 perturbation 1, ..., fleet 2 perturbation 4, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 2P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 2P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 2P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
               }
            }
          results <- do.call(.CDMN2P4P, parlist);
          }
        if(sum(p == c(2,5)) == length(p))
          {
          if(length(dates) != 9)
            {
             stop("For a 2-fleet 2-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, fleet 1 perturbation 2, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 17)
               {
                stop("For a 2-fleet 2P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 17 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 2P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 16 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 2P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 15")
               }
            }
          results <- do.call(.CDMN2P5P, parlist);
          }
        if(sum(p == c(3,3)) == length(p))
          {
          if(length(dates) != 8)
            {
             stop("For a 2-fleet 3-perturbation 3-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 3, ..., fleet 2 perturbation 2, fleet 2 perturbation 3, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 3P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 3P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 14)
               {
                stop("For a 2-fleet 3P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
               }
            }
          results <- do.call(.CDMN3P3P, parlist);
          }
        if(sum(p == c(3,4)) == length(p))
          {
          if(length(dates) != 9)
            {
             stop("For a 2-fleet 3-perturbation 4-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 3, fleet 2 perturbation 1, ..., fleet 2 perturbation 4, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 17)
               {
                stop("For a 2-fleet 3P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 17 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 3P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 16 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 15)
               {
                stop("For a 2-fleet 3P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 15")
               }
            }
          results <- do.call(.CDMN3P4P, parlist);
          }
        if(sum(p == c(3,5)) == length(p))
          {
          if(length(dates) != 10)
            {
             stop("For a 2-fleet 3-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 3, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 18)
               {
                stop("For a 2-fleet 3P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 18 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 17)
               {
                stop("For a 2-fleet 3P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 17 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 3P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 16")
               }
            }
          results <- do.call(.CDMN3P5P, parlist);
          }
        if(sum(p == c(4,4)) == length(p))
          {
          if(length(dates) != 10)
            {
             stop("For a 2-fleet 4-perturbation 4-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 3, fleet 1 perturbation 4, fleet 2 perturbation 1, fleet 2 perturbation 2, fleet 2 perturbation 3, fleet 2 perturbation 4, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 18)
               {
                stop("For a 2-fleet 4P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 18 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 17)
               {
                stop("For a 2-fleet 4P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 17 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 16)
               {
                stop("For a 2-fleet 4P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 16")
               }
            }
          results <- do.call(.CDMN4P4P, parlist);
          }
        if(sum(p == c(4,5)) == length(p))
          {
          if(length(dates) != 11)
            {
             stop("For a 2-fleet 4-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 4, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 19)
               {
                stop("For a 2-fleet 4P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 19 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 18)
               {
                stop("For a 2-fleet 4P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 18 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 17)
               {
                stop("For a 2-fleet 4P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 17")
               }
            }
          results <- do.call(.CDMN4P5P, parlist);
          }
        if(sum(p == c(5,5)) == length(p))
          {
          if(length(dates) != 12)
            {
             stop("For a 2-fleet 5-perturbation 5-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 5, fleet 2 perturbation 1, ..., fleet 2 perturbation 5, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 20)
               {
                stop("For a 2-fleet 5P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 20 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 19)
               {
                stop("For a 2-fleet 5P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 19 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 18)
               {
                stop("For a 2-fleet 5P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 18")
               }
            }
          results <- do.call(.CDMN5P5P, parlist);
          }
        if(sum(p == c(6,6)) == length(p))
          {
          if(length(dates) != 14)
            {
             stop("For a 2-fleet 6-perturbation 6-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 6, fleet 2 perturbation 1, ..., fleet 2 perturbation 6, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 22)
               {
                stop("For a 2-fleet 6P 6P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 22 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 21)
               {
                stop("For a 2-fleet 6P 6P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 21 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 20)
               {
                stop("For a 2-fleet 6P 6P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 20")
               }
            }
          results <- do.call(.CDMN6P6P, parlist);
          }
        if(sum(p == c(7,7)) == length(p))
          {
          if(length(dates) != 16)
            {
             stop("For a 2-fleet 7-perturbation 7-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 7, fleet 2 perturbation 1, ..., fleet 2 perturbation 7, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 24)
               {
                stop("For a 2-fleet 7P 7P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 24 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 23)
               {
                stop("For a 2-fleet 7P 7P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 23 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 22)
               {
                stop("For a 2-fleet 7P 7P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 22")
               }
            }
          results <- do.call(.CDMN7P7P, parlist);
          }
        if(sum(p == c(8,8)) == length(p))
          {
          if(length(dates) != 18)
            {
             stop("For a 2-fleet 8-perturbation 8-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 8, fleet 2 perturbation 1, ..., fleet 2 perturbation 8, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 26)
               {
                stop("For a 2-fleet 8P 8P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 26 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 25)
               {
                stop("For a 2-fleet 8P 8P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 25 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 24)
               {
                stop("For a 2-fleet 8P 8P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 24")
               }
            }
          results <- do.call(.CDMN8P8P, parlist);
          }
        if(sum(p == c(9,9)) == length(p))
          {
          if(length(dates) != 20)
            {
             stop("For a 2-fleet 9-perturbation 9-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 9, fleet 2 perturbation 1, ..., fleet 2 perturbation 9, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 28)
               {
                stop("For a 2-fleet 9P 9P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 28 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 27)
               {
                stop("For a 2-fleet 9P 9P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 27 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 26)
               {
                stop("For a 2-fleet 9P 9P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 26")
               }
            }
          results <- do.call(.CDMN9P9P, parlist);
          }
        if(sum(p == c(10,10)) == length(p))
          {
          if(length(dates) != 22)
            {
             stop("For a 2-fleet 10-perturbation 10-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 10, fleet 2 perturbation 1, ..., fleet 2 perturbation 10, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 30)
               {
                stop("For a 2-fleet 10P 10P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 30 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 29)
               {
                stop("For a 2-fleet 10P 10P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 29 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 28)
               {
                stop("For a 2-fleet 10P 10P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 28")
               }
            }
          results <- do.call(.CDMN10P10P, parlist);
          }
        if(sum(p == c(11,11)) == length(p))
          {
          if(length(dates) != 24)
            {
             stop("For a 2-fleet 11-perturbation 11-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 11, fleet 2 perturbation 1, ..., fleet 2 perturbation 11, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 32)
               {
                stop("For a 2-fleet 11P 11P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 32 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 31)
               {
                stop("For a 2-fleet 11P 11P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 31 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 30)
               {
                stop("For a 2-fleet 11P 11P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 30")
               }
            }
          results <- do.call(.CDMN11P11P, parlist);
          }
        if(sum(p == c(12,12)) == length(p))
          {
          if(length(dates) != 26)
            {
             stop("For a 2-fleet 12-perturbation 12-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 12, fleet 2 perturbation 1, ..., fleet 2 perturbation 12, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 34)
               {
                stop("For a 2-fleet 12P 12P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 34 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 33)
               {
                stop("For a 2-fleet 12P 12P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 33 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 32)
               {
                stop("For a 2-fleet 12P 12P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 32")
               }
            }
          results <- do.call(.CDMN12P12P, parlist);
          }
        if(sum(p == c(13,13)) == length(p))
          {
          if(length(dates) != 28)
            {
             stop("For a 2-fleet 13-perturbation 13-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 13, fleet 2 perturbation 1, ..., fleet 2 perturbation 13, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 36)
               {
                stop("For a 2-fleet 13P 13P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 36 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 35)
               {
                stop("For a 2-fleet 13P 13P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 35 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 34)
               {
                stop("For a 2-fleet 13P 13P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 34")
               }
            }
          results <- do.call(.CDMN13P13P, parlist);
          }
        if(sum(p == c(14,14)) == length(p))
          {
          if(length(dates) != 30)
            {
             stop("For a 2-fleet 14-perturbation 14-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 14, fleet 2 perturbation 1, ..., fleet 2 perturbation 14, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 38)
               {
                stop("For a 2-fleet 14P 14P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 38 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 37)
               {
                stop("For a 2-fleet 14P 14P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 37 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 36)
               {
                stop("For a 2-fleet 14P 14P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 36")
               }
            }
          results <- do.call(.CDMN14P14P, parlist);
          }
        if(sum(p == c(15,15)) == length(p))
          {
          if(length(dates) != 32)
            {
             stop("For a 2-fleet 15-perturbation 15-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 15, fleet 2 perturbation 1, ..., fleet 2 perturbation 15, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 40)
               {
                stop("For a 2-fleet 15P 15P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 40 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 39)
               {
                stop("For a 2-fleet 15P 15P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 39 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 38)
               {
                stop("For a 2-fleet 15P 15P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 38")
               }
            }
          results <- do.call(.CDMN15P15P, parlist);
          }
        if(sum(p == c(16,16)) == length(p))
          {
          if(length(dates) != 34)
            {
             stop("For a 2-fleet 16-perturbation 16-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 16, fleet 2 perturbation 1, ..., fleet 2 perturbation 16, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 42)
               {
                stop("For a 2-fleet 16P 16P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 42 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 41)
               {
                stop("For a 2-fleet 16P 16P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 41 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 40)
               {
                stop("For a 2-fleet 16P 16P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 40")
               }
            }
          results <- do.call(.CDMN16P16P, parlist);
          }
        if(sum(p == c(17,17)) == length(p))
          {
          if(length(dates) != 36)
            {
             stop("For a 2-fleet 17-perturbation 17-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 17, fleet 2 perturbation 1, ..., fleet 2 perturbation 17, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 44)
               {
                stop("For a 2-fleet 17P 17P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 44 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 43)
               {
                stop("For a 2-fleet 17P 17P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 43 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 42)
               {
                stop("For a 2-fleet 17P 17P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 42")
               }
            }
          results <- do.call(.CDMN17P17P, parlist);
          }
        if(sum(p == c(18,18)) == length(p))
          {
          if(length(dates) != 38)
            {
             stop("For a 2-fleet 18-perturbation 18-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 18, fleet 2 perturbation 1, ..., fleet 2 perturbation 18, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 46)
               {
                stop("For a 2-fleet 18P 18P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 46 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 45)
               {
                stop("For a 2-fleet 18P 18P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 45 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 44)
               {
                stop("For a 2-fleet 18P 18P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 44")
               }
            }
          results <- do.call(.CDMN18P18P, parlist);
          }
        if(sum(p == c(19,19)) == length(p))
          {
          if(length(dates) != 40)
            {
             stop("For a 2-fleet 19-perturbation 19-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 19, fleet 2 perturbation 1, ..., fleet 2 perturbation 19, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 48)
               {
                stop("For a 2-fleet 19P 19P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 48 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 47)
               {
                stop("For a 2-fleet 19P 19P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 47 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 46)
               {
                stop("For a 2-fleet 19P 19P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 46")
               }
            }
          results <- do.call(.CDMN19P19P, parlist);
          }
        if(sum(p == c(20,20)) == length(p))
          {
          if(length(dates) != 42)
            {
             stop("For a 2-fleet 20-perturbation 20-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 20, fleet 2 perturbation 1, ..., fleet 2 perturbation 20, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 50)
               {
                stop("For a 2-fleet 20P 20P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 50 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 49)
               {
                stop("For a 2-fleet 20P 20P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 49 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 48)
               {
                stop("For a 2-fleet 20P 20P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 48")
               }
            }
          results <- do.call(.CDMN20P20P, parlist);
          }
        if(sum(p == c(21,21)) == length(p))
          {
          if(length(dates) != 44)
            {
             stop("For a 2-fleet 21-perturbation 21-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 21, fleet 2 perturbation 1, ..., fleet 2 perturbation 21, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 52)
               {
                stop("For a 2-fleet 21P 21P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 52 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 51)
               {
                stop("For a 2-fleet 21P 21P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 51 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 50)
               {
                stop("For a 2-fleet 21P 21P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 50")
               }
            }
          results <- do.call(.CDMN21P21P, parlist);
          }
        if(sum(p == c(22,22)) == length(p))
          {
          if(length(dates) != 46)
            {
             stop("For a 2-fleet 22-perturbation 22-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 22, fleet 2 perturbation 1, ..., fleet 2 perturbation 22, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 54)
               {
                stop("For a 2-fleet 22P 22P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 54 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 53)
               {
                stop("For a 2-fleet 22P 22P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 53 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 52)
               {
                stop("For a 2-fleet 22P 22P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 52")
               }
            }
          results <- do.call(.CDMN22P22P, parlist);
          }
        if(sum(p == c(23,23)) == length(p))
          {
          if(length(dates) != 48)
            {
             stop("For a 2-fleet 23-perturbation 23-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 23, fleet 2 perturbation 1, ..., fleet 2 perturbation 23, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 56)
               {
                stop("For a 2-fleet 23P 23P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 56 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 55)
               {
                stop("For a 2-fleet 23P 23P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 55 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 54)
               {
                stop("For a 2-fleet 23P 23P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 54")
               }
            }
          results <- do.call(.CDMN23P23P, parlist);
          }
        if(sum(p == c(24,24)) == length(p))
          {
          if(length(dates) != 50)
            {
             stop("For a 2-fleet 24-perturbation 24-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 24, fleet 2 perturbation 1, ..., fleet 2 perturbation 24, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 58)
               {
                stop("For a 2-fleet 24P 24P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 58 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 57)
               {
                stop("For a 2-fleet 24P 24P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 57 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 56)
               {
                stop("For a 2-fleet 24P 24P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 56")
               }
            }
          results <- do.call(.CDMN24P24P, parlist);
          }
        if(sum(p == c(25,25)) == length(p))
          {
          if(length(dates) != 52)
            {
             stop("For a 2-fleet 25-perturbation 25-perturbation model dates must be a vector with the following time step marks: initial, fleet 1 perturbation 1, ..., fleet 1 perturbation 25, fleet 2 perturbation 1, ..., fleet 2 perturbation 25, final")
            }
          if(sum(distr%in%sdistr.set) == 0)
            {
             if(length(par) != 60)
               {
                stop("For a 2-fleet 25P 25P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 60 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
               }
            }
          if(sum(distr%in%sdistr.set) == 1)
            {
             if(length(par) != 59)
               {
                stop("For a 2-fleet 25P 25P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 59 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
               }
            }
          if(sum(distr%in%sdistr.set) == 2)
            {
             if(length(par) != 58)
               {
                stop("For a 2-fleet 25P 25P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 58")
               }
            }
          results <- do.call(.CDMN25P25P, parlist);
          }
       }
     if(any(results$Model$Results[,4] < 0) | any(is.nan(results$Model$Results[,4])))
       {stop("Predicted catch at some time steps is negative or NaN; consider decreasing natural mortality or increasing abundance. \n In transit fisheries you may also increase vulnerable abundance by delaying exit times")}
     return(results);
    }
#
######################## VI - PREDICTION DIAGNOSTIC PLOT  ###########333########
#
plot.CatDynExp <- function(x,leg.pos,Biom.tstep,Cat.tstep,Biom.xpos,Biom.ypos,Cat.xpos,Cat.ypos,diagnostics.panels=TRUE,...)
    {
     fleet.name <- x$Properties$Fleets$Fleet
     period     <- x$Model$Results[,1]
     tstep      <- x$Properties$Units[1]
     catunits   <- paste("Catch (",x$Properties$Units[4],")",sep="")
     index      <- 1:length(x$Model$Results[,dim(x$Model$Results)[2]])
     Biom       <- round(mean(tail(x$Model$Results[,"Predicted.Biomass.tonnes"],Biom.tstep)))
     Cat        <- ifelse(length(fleet.name) == 1,
                          round(1e-3*sum(tail(x$Model$Results[,5],Cat.tstep),na.rm=TRUE)),
                          round(1e-3*sum(tail(x$Model$Results[,5],Cat.tstep)+
                                         tail(x$Model$Results[,13],Cat.tstep),na.rm=TRUE)))
     options(warn=-1)
     for(i in 1:length(fleet.name))
       {
#       if(any(is.nan(x$Model$Results[,i*4])))
#         {stop(paste("Change initial parameter values to increase predicted catch of ",fleet.name[i], " fleet",sep=""))}
       obscat <- x$Model$Results[,i*3+5*(i-1)]
       modcat <- x$Model$Results[,i*4+4*(i-1)]
       resids <- x$Model$Results[,i*9-1*(i-1)]
       if(diagnostics.panels==FALSE)
         {
          par(mfrow=c(1,1))
          plot(x=period,y=obscat,pch=19, xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=catunits,ylim=c(0,max(obscat,modcat)),main="",cex=0.75)
          lines(x=period,y=modcat,col="black",lwd=2)
          legend(leg.pos,c("Observed Catch", "Predicted Catch"), bty="n", pch=c(19, NA), lty=c(0, 1), lwd=c(0,2), col=c("black", "black"))
          if(x$Properties$Units[3] != "ind")
            {
             text(x=Biom.xpos*max(period), y=Biom.ypos*max(obscat), adj=0,lab=list(bquote("Biom (tons)" ==.(Biom))))
             text(x=Cat.xpos*max(period), y=Cat.ypos*max(obscat), adj=0,lab=list(bquote("Catch.ton" ==.(Cat))))
            }
          if(x$Model$Type[i] != 0)
            {
             if(i == 1)
               {
                if(x$Model$Type[i] > 0)
                  {
                   points(x=x$Model$Dates[2:(x$Model$Type[i]+1)],
                          y=rep(0,x$Model$Type[i]),
                          pch=10,cex=3)
                  }
                if(x$Model$Type[i] < 0)
                  {
                   points(x=x$Model$Dates[seq(2,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=1,col="red")
                   points(x=x$Model$Dates[seq(3,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=1,col="blue")
                  }
               }
             else
               {
                points(x=x$Model$Dates[(2+x$Model$Type[i-1]):(1+x$Model$Type[i-1]+x$Model$Type[i])],
                       y=rep(0,x$Model$Type[i]),
                       pch=10,cex=3)
               }
            }
          mtext(side=3,outer=TRUE,text=paste(fleet.name[i]," - ",x$Model$Type[i]," - ",gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", x$Model$Distribution[i], perl=TRUE),sep=""))
          options(warn=0)
          devAskNewPage(ask=TRUE)
         }
       if(diagnostics.panels==TRUE)
         {
          par(mfrow=c(2,2),oma=c(0,0,2,0),mar=c(4,4,2,2))
          plot(x=period,y=obscat,pch=19, xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=catunits,ylim=c(0,max(obscat,modcat)),main="",cex=0.75)
          lines(x=period,y=modcat,col="black",lwd=2)
          legend(leg.pos,c("Observed Catch", "Predicted Catch"), bty="n", pch=c(19, NA), lty=c(0, 1), lwd=c(0,2), col=c("black", "black"))
          if(x$Properties$Units[3] != "ind")
            {
             text(x=Biom.xpos*max(period), y=Biom.ypos*max(obscat), adj=0,lab=list(bquote("Biom (tons)" ==.(Biom))))
             text(x=Cat.xpos*max(period), y=Cat.ypos*max(obscat), adj=0,lab=list(bquote("Catch.ton" ==.(Cat))))
            }
          if(x$Model$Type[i] != 0)
            {
             if(i == 1)
               {
                if(x$Model$Type[i] > 0)
                  {
                   points(x=x$Model$Dates[2:(x$Model$Type[i]+1)],
                          y=rep(0,x$Model$Type[i]),
                          pch=10,cex=3)
                  }
                if(x$Model$Type[i] < 0)
                  {
                   points(x=x$Model$Dates[seq(2,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=1,col="red")
                   points(x=x$Model$Dates[seq(3,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=1,col="blue")
                  }
               }
             else
               {
                points(x=x$Model$Dates[(2+x$Model$Type[i-1]):(1+x$Model$Type[i-1]+x$Model$Type[i])],
                       y=rep(0,x$Model$Type[i]),
                       pch=10,cex=3)
               }
            }
          hist(x=resids,main="",xlab="Deviance Residuals",ylab="Frequency")
          plot(x=period,y=resids,xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE), ylab="Deviance Residuals",pch=1,type="n")
          abline(h=0,lwd=2)
          text(x=period,y=resids,lab=format(period),cex=0.75)
          qqplot(x=obscat,y=modcat,xlab=paste("Observed Catch (",x$Properties$Units[4],")", sep=""),ylab=paste("Predicted Catch (",x$Properties$Units[4],")", sep=""),pch=1)
          abline(a=0,b=1,lwd=2)
          mtext(side=3,outer=TRUE,text=paste(fleet.name[i]," - ",x$Model$Type[i]," - ",gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", x$Model$Distribution[i], perl=TRUE),sep=""))
          options(warn=0)
          devAskNewPage(ask=TRUE)
         }
       }
     devAskNewPage(ask=FALSE)
    }
#
############################### VII - MODEL FIT ################################
#
################################## A - WRAPPER  ################################
#
CatDynFit <- function(x, p, par, dates, distr, method, control=list(), hessian=TRUE, itnmax, partial=TRUE)
          {
          #cat("\nLikelihood maximization calling the optimx() wrapper\nBEWARE: it might take several minutes, hours on a PC")
          options(warn=-1)
          fleet.name <- x$Properties$Fleets$Fleet
          distr.set  <- c("normal","apnormal","lognormal","aplnormal","poisson","gamma","negbin","roblognormal","gumbel")
          if(class(x) != "CatDynData") {stop("Pass an object of class CatDynData as first argument - see the help for as.CatDynData")}
          if(x$Properties$Units["Time Step"]=="month" & sum(p)==0){stop("With monthly time step simple depletion models do not make sense. \n
                                                                          It is recommended to use multi-annual depletion models with monthly time step for time series at least 15 years long
                                                                          (which means that p should be 15 (one fleet) or c(15,15) (two fleets) at least)")}
          if(sum(sort(p) == p)<length(p)) {stop("Number of perturbations per fleet must not be arranged in descending order")}
          if(any(is.na(p))) {stop("NAs are not allowed in the perturbations per fleet vector 'p'")}
          if(length(p) < 1 || length(p) > 2) {stop("The integer vector 'p' determines the number of perturbations per fleet; its length must be 1 for single fleet, or 2 for two fleets")}
          if(any(p < -25) || any(p > 25)) {stop("The number of perturbations per fleet shall not be higher than 25 (use negative integers for transit models)")}
          if(class(p) != "numeric") {stop("'p' must be a numeric vector")}
          if(any(is.na(par))) {stop("NAs are not allowed in the parameter vector 'par'")}
          if(length(par) < 4 || length(par) > 60) {stop("For any of the model versions the number of parameters is > 4 and < 61")}
          if(class(par) != "numeric") {stop("'par' must be a numeric vector")}
          if(any(is.na(dates))){stop("NAs are not allowed in the dates vector")}
          if(dates[1] > dates[2]) {stop("Initial date must be less than next date")}
          if(tail(dates,1) < tail(dates,2)[1]) {stop("Final date must not be less than previous date")}
          if(!distr%in%distr.set) {stop("'distr' must be 'normal','apnormal','lognormal','aplnormal', 'gamma', 'poisson', 'negbin', 'roblognormal' or 'gumbel' for 1-fleet models, or any of the 81 pairwise combination of these for 2-fleets models")}
          #One Fleet
          if(length(fleet.name) == 1)
            {
             if(length(p) != 1)
               {
                stop("For a 1-fleet model 'p' must be of length 1")
               }
             if(p > 25 | p < -25)
               {
                stop("Parameter p -number of perturbations- does not correspond with any of the allowed integers for one fleet, -25<=p<=25")
               }
             if(p < 0 & length(dates) != (2*abs(p)+2))
               {
                stop("The dates vector must contain initial time step, time step of entry of each perturbation immediately followed by time step of its exit, for all perturbations ordered by time of entry, and final time step")
               }
             #pure depletion
             if(p == 0)
                {
                 if(length(dates) != 2) {stop("For a 1-fleet 0P (pure depletion) model 'dates' must be a vector of length 2")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 5)
                      {
                       stop("For a 1-fleet 0 perturbation (simple depletion model) fit with poisson or adjusted profile likelihood par must be a vector of length 5")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 6)
                      {
                       stop("For a 1-fleet 0 perturbation (simple depletion model) fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 6")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type         <- p;
                    results2[[i]]$Dates        <- dates;
                    names(results2[[i]]$Dates) <- c("ts.start","ts.end");
                    results2[[i]]$Distr        <- distr;
                    par.names                  <- c("M","N0",paste(c("k.","alpha.","beta."),fleet.name,sep=""));
                    if(distr == "negbin" | distr == "normal" | distr == "lognormal" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names,paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- NA;
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names));
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- results1[i,length(par)+5];
                       results2[[i]]$kkt              <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC              <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par           <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads        <- temp[i,]$ngatend;
                                             v        <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #1P
             else if(p == 1)
                {
                 if(length(dates) != 3) {stop("For a 1-fleet 1P model 'dates' must be a vector of length 3")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 6)
                      {
                       stop("For a 1-fleet 1 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 6")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 7)
                      {
                       stop("For a 1-fleet 1 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 7")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type         <- p;
                    results2[[i]]$Dates        <- dates;
                    names(results2[[i]]$Dates) <- c("ts.start","ts.P1","ts.end");
                    results2[[i]]$Distr        <- distr;
                    par.names                  <- c("M","N0",paste(c("P1.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #2P
             else if(p == 2)
                {
                 if(length(dates) != 4) {stop("For a 1-fleet 2P model 'dates' must be a vector of length 4")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 7)
                      {
                       stop("For a 1-fleet 2 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 7")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 8)
                      {
                       stop("For a 1-fleet 2 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type         <- p;
                    results2[[i]]$Dates        <- dates;
                    results2[[i]]$Distr        <- distr;
                    names(results2[[i]]$Dates) <- c("ts.start","ts.P1","ts.P2","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);                                                                         
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }                                                   
                    }
                rm(v);
                rm(temp);
                }
             #3P
             else if(p == 3)
                {
                 if(length(dates) != 5) {stop("For a 1-fleet 3P model 'dates' must be a vector of length 5")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 8)
                      {
                       stop("For a 1-fleet 3 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 8")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 9)
                      {
                       stop("For a 1-fleet 3 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 9")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #4P
             else if(p == 4)
                {
                 if(length(dates) != 6) {stop("For a 1-fleet 4P model 'dates' must be a vector of length 6")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 9)
                      {
                       stop("For a 1-fleet 4 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 9")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 1-fleet 4 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v)
                 rm(temp);
                }
             #5P
             else if(p == 5)
                {
                 if(length(dates) != 7) {stop("For a 1-fleet 5P model 'dates' must be a vector of length 7")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 1-fleet 5 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 10")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 1-fleet 5 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 11")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 6)
                {
                 if(length(dates) != 8) {stop("For a 1-fleet 6P model 'dates' must be a vector of length 8")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 1-fleet 6 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 11")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 1-fleet 6 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v)
                 rm(temp);
                }
             else if(p == 7)
                {
                 if(length(dates) != 9) {stop("For a 1-fleet 7P model 'dates' must be a vector of length 9")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 1-fleet 7 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 12")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 1-fleet 7 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 13")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6","ts.P7","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 8)
                {
                 if(length(dates) != 10) {stop("For a 1-fleet 8P model 'dates' must be a vector of length 10")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 1-fleet 8 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 13")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 1-fleet 8 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 9)
                {
                 if(length(dates) != 11) {stop("For a 1-fleet 9P model 'dates' must be a vector of length 11")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 1-fleet 9 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 14")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 1-fleet 9 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 15")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                                     "P9.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp)
                }
             else if(p == 10)
                {
                 if(length(dates) != 12) {stop("For a 1-fleet 10P model 'dates' must be a vector of length 12")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 1-fleet 10 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 15")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 1-fleet 10 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                                     "P9.","P10.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 11)
                {
                 if(length(dates) != 13) {stop("For a 1-fleet 11P model 'dates' must be a vector of length 13")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 1-fleet 11 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 16")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 1-fleet 11 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 17")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                                     "P9.","P10.","P11.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 12)
                {
                 if(length(dates) != 14) {stop("For a 1-fleet 12P model 'dates' must be a vector of length 14")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 1-fleet 12 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 17")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 1-fleet 12 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                                     "P9.","P10.","P11.","P12.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 13)
                {
                 if(length(dates) != 15) {stop("For a 1-fleet 13P model 'dates' must be a vector of length 15")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 1-fleet 13 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 18")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 19)
                      {
                       stop("For a 1-fleet 13 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 19")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 14)
                {
                 if(length(dates) != 16) {stop("For a 1-fleet 14P model 'dates' must be a vector of length 16")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 19)
                      {
                       stop("For a 1-fleet 14 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 19")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 20)
                      {
                       stop("For a 1-fleet 14 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 20")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 15)
                {
                 if(length(dates) != 17) {stop("For a 1-fleet 15P model 'dates' must be a vector of length 17")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 20)
                      {
                       stop("For a 1-fleet 15 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 20")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 21)
                      {
                       stop("For a 1-fleet 15 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 21")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                        "P9.","P10.","P11.","P12.","P13.","P14.","P15.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 16)
                {
                 if(length(dates) != 18) {stop("For a 1-fleet 16P model 'dates' must be a vector of length 18")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 21)
                      {
                       stop("For a 1-fleet 16 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 21")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 22)
                      {
                       stop("For a 1-fleet 16 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 22")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 17)
                {
                 if(length(dates) != 19) {stop("For a 1-fleet 17P model 'dates' must be a vector of length 19")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 22)
                      {
                       stop("For a 1-fleet 17 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 22")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 23)
                      {
                       stop("For a 1-fleet 17 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 23")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 18)
                {
                 if(length(dates) != 20) {stop("For a 1-fleet 18P model 'dates' must be a vector of length 20")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 23)
                      {
                       stop("For a 1-fleet 18 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 23")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 24)
                      {
                       stop("For a 1-fleet 18 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 24")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,3], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 19)
                {
                 if(length(dates) != 21) {stop("For a 1-fleet 19P model 'dates' must be a vector of length 21")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 24)
                      {
                       stop("For a 1-fleet 19 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 24")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 25)
                      {
                       stop("For a 1-fleet 19 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 25")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 20)
                {
                 if(length(dates) != 22) {stop("For a 1-fleet 20P model 'dates' must be a vector of length 22")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 25)
                      {
                       stop("For a 1-fleet 20 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 25")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 26)
                      {
                       stop("For a 1-fleet 20 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 26")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 21)
                {
                 if(length(dates) != 23) {stop("For a 1-fleet 21P model 'dates' must be a vector of length 23")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 26)
                      {
                       stop("For a 1-fleet 21 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 26")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 27)
                      {
                       stop("For a 1-fleet 21 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 27")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.P21","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","P21.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 22)
                {
                 if(length(dates) != 24) {stop("For a 1-fleet 22P model 'dates' must be a vector of length 24")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 27)
                      {
                       stop("For a 1-fleet 22 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 27")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 28)
                      {
                       stop("For a 1-fleet 22 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 28")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.P21","ts.P22",
                                                        "ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","P21.","P22.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 23)
                {
                 if(length(dates) != 25) {stop("For a 1-fleet 23P model 'dates' must be a vector of length 25")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 28)
                      {
                       stop("For a 1-fleet 23 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 28")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 29)
                      {
                       stop("For a 1-fleet 23 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 29")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.P21","ts.P22",
                                                        "ts.P23","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","P21.","P22.","P23.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28),~exp(x29)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 24)
                {
                 if(length(dates) != 26) {stop("For a 1-fleet 24P model 'dates' must be a vector of length 26")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 29)
                      {
                       stop("For a 1-fleet 24 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 29")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 30)
                      {
                       stop("For a 1-fleet 24 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 30")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.P21","ts.P22",
                                                        "ts.P23","ts.P24","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","P21.","P22.","P23.","P24.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28),~exp(x29)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == 25)
                {
                 if(length(dates) != 27) {stop("For a 1-fleet 25P model 'dates' must be a vector of length 27")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(length(par) != 30)
                      {
                       stop("For a 1-fleet 25 perturbation fit with poisson or adjusted profile likelihood par must be a vector of length 30")
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(length(par) != 31)
                      {
                       stop("For a 1-fleet 25 perturbation fit with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par mustbe a vector of length 31")
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1","ts.P2","ts.P3","ts.P4","ts.P5","ts.P6",
                                                        "ts.P7","ts.P8","ts.P9","ts.P10","ts.P11","ts.P12","ts.P13",
                                                        "ts.P14","ts.P15","ts.P16","ts.P17","ts.P18","ts.P19","ts.P20","ts.P21","ts.P22",
                                                        "ts.P23","ts.P24","ts.P25","ts.end");
                    par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                           "P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.","k.","alpha.","beta."),sort(rep(fleet.name,3+p)),sep=""));
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                               ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                               ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                               ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
                #Transit models
              else if(p == -1)
                {
                 if(length(dates) != 4) {stop("For a 1-fleet 1P transit model 'dates' must be a vector of length 4")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                  {
                   if(partial)
                     {
                      if(length(par) != 7)
                       {
                        stop("For a 1-fleet 1 perturbation transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 7")
                       }
                     }
                   else
                    {
                     if(length(par) != 6)
                       {
                        stop("For a 1-fleet 1 perturbation transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 6")
                       }
                    }
                 }
               if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                 {
                  if(partial)
                    {
                     if(length(par) != 8)
                       {
                        stop("For a 1-fleet 1 perturbation transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
                       }
                    }
                  else
                    {
                     if(length(par) != 7)
                       {
                        stop("For a 1-fleet 1 perturbation transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 7")
                       }
                    }
                 }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates) <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.end");
                       par.names                  <- c("M","N0",paste(c("P1.","Q1.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.end");
                       par.names                  <- c("M","N0",paste(c("P1.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7),~exp(x8)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -2)
                {
                 if(length(dates) != 6) {stop("For a 1-fleet 2P transit model 'dates' must be a vector of length 6")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 9)
                         {
                          stop("For a 1-fleet 2 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 9")
                         }
                      }
                    else
                      {
                       if(length(par) != 7)
                         {
                          stop("For a 1-fleet 2 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 7")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 10)
                         {
                          stop("For a 1-fleet 2 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
                         }
                      }
                    else
                      {
                       if(length(par) != 8)
                         {
                          stop("For a 1-fleet 2 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 8")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates) <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.end");
                       par.names                  <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names                  <- c("M","N0","P1","Q1","P2","Q2","k","alpha","beta","psi");
                      #par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7),~exp(x8),~exp(x8)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7),~exp(x8),~exp(x9),~exp(x10)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),
                                                                                  ~exp(x7),~exp(x8)),
                                                                           mean=as.numeric(results1[i,1:length(par)]),
                                                                           cov=try(solve(temp[i,]$nhatend)),
                                                                           ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                    }
                rm(v);
                rm(temp);
                }
             else if(p == -3)
                {
                 if(length(dates) != 8) {stop("For a 1-fleet 3P transit model 'dates' must be a vector of length 8")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 11)
                         {
                          stop("For a 1-fleet 3 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 11")
                         }
                      }
                    else
                      {
                       if(length(par) != 8)
                         {
                          stop("For a 1-fleet 3 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 8")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 12)
                         {
                          stop("For a 1-fleet 3 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
                         }
                      }
                    else
                      {
                       if(length(par) != 9)
                         {
                          stop("For a 1-fleet 3 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 9")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr, method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit","ts.P3.entry","ts.Q3.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -4)
                {
                 if(length(dates) != 10) {stop("For a 1-fleet 4P transit model 'dates' must be a vector of length 10")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 13)
                         {
                          stop("For a 1-fleet 4 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 13")
                         }
                      }
                    else
                      {
                       if(length(par) != 9)
                         {
                          stop("For a 1-fleet 4 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 9")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 14)
                         {
                          stop("For a 1-fleet 4 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
                         }
                      }
                    else
                      {
                       if(length(par) != 10)
                         {
                          stop("For a 1-fleet 4 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 10")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit","ts.P3.entry","ts.Q3.exit",
                                                           "ts.P4.entry","ts.Q4.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -5)
                {
                 if(length(dates) != 12) {stop("For a 1-fleet 5P transit model 'dates' must be a vector of length 12")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 15)
                         {
                          stop("For a 1-fleet 5 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 15")
                         }
                      }
                    else
                      {
                       if(length(par) != 10)
                         {
                          stop("For a 1-fleet 5 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 10")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 16)
                         {
                          stop("For a 1-fleet 5 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
                         }
                      }
                    else
                      {
                       if(length(par) != 11)
                         {
                          stop("For a 1-fleet 5 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 11")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2,","P3.","Q3.","P4.","Q4.","P5.","Q5,","k.","alpha.","beta."),
                                                     sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev        <- sqrt(diag(v));
                       results2[[i]]$Cor             <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -6)
                {
                 if(length(dates) != 14) {stop("For a 1-fleet 6P transit model 'dates' must be a vector of length 14")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 17)
                         {
                          stop("For a 1-fleet 6 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 17")
                         }
                      }
                    else
                      {
                       if(length(par) != 11)
                         {
                          stop("For a 1-fleet 6 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 11")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 18)
                         {
                          stop("For a 1-fleet 6 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
                         }
                      }
                    else
                      {
                       if(length(par) != 12)
                         {
                          stop("For a 1-fleet 6 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 12")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3,","P4.","Q4.","P5.","Q5.","P6.","Q6.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -7)
                {
                 if(length(dates) != 16) {stop("For a 1-fleet 7P transit model 'dates' must be a vector of length 16")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 19)
                         {
                          stop("For a 1-fleet 7 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 19")
                         }
                      }
                    else
                      {
                       if(length(par) != 12)
                         {
                          stop("For a 1-fleet 7 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 12")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 20)
                         {
                          stop("For a 1-fleet 7 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 20")
                         }
                      }
                    else
                      {
                       if(length(par) != 13)
                         {
                          stop("For a 1-fleet 7 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 13")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                                             else
                                               {
                                                v        <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                               ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -8)
                {
                 if(length(dates) != 18) {stop("For a 1-fleet 8P transit model 'dates' must be a vector of length 18")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 21)
                         {
                          stop("For a 1-fleet 8 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 21")
                         }
                      }
                    else
                      {
                       if(length(par) != 13)
                         {
                          stop("For a 1-fleet 8 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 13")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 22)
                         {
                          stop("For a 1-fleet 8 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 22")
                         }
                      }
                    else
                      {
                       if(length(par) != 14)
                         {
                          stop("For a 1-fleet 8 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 14")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14)~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -9)
                {
                 if(length(dates) != 20) {stop("For a 1-fleet 9P transit model 'dates' must be a vector of length 20")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 23)
                         {
                          stop("For a 1-fleet 9 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 23")
                         }
                      }
                    else
                      {
                       if(length(par) != 14)
                         {
                          stop("For a 1-fleet 9 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 14")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 24)
                         {
                          stop("For a 1-fleet 9 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 24")
                         }
                      }
                    else
                      {
                       if(length(par) != 15)
                         {
                          stop("For a 1-fleet 9 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 15")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -10)
                {
                 if(length(dates) != 22) {stop("For a 1-fleet 10P transit model 'dates' must be a vector of length 22")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 25)
                         {
                          stop("For a 1-fleet 10 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 25")
                         }
                      }
                    else
                      {
                       if(length(par) != 15)
                         {
                          stop("For a 1-fleet 10 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 15")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 26)
                         {
                          stop("For a 1-fleet 10 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 26")
                         }
                      }
                    else
                      {
                       if(length(par) != 16)
                         {
                          stop("For a 1-fleet 10 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 16")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.end");
                       par.names                  <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                           "P9.","P10.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -11)
                {
                 if(length(dates) != 24) {stop("For a 1-fleet 11P transit model 'dates' must be a vector of length 24")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 27)
                         {
                          stop("For a 1-fleet 11 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 27")
                         }
                      }
                    else
                      {
                       if(length(par) != 16)
                         {
                          stop("For a 1-fleet 11 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 16")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 28)
                         {
                          stop("For a 1-fleet 11 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 28")
                         }
                      }
                    else
                      {
                       if(length(par) != 17)
                         {
                          stop("For a 1-fleet 11 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 17")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -12)
                {
                 if(length(dates) != 26) {stop("For a 1-fleet 12P transit model 'dates' must be a vector of length 26")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 29)
                         {
                          stop("For a 1-fleet 12 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 29")
                         }
                      }
                    else
                      {
                       if(length(par) != 17)
                         {
                          stop("For a 1-fleet 12 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 17")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 30)
                         {
                          stop("For a 1-fleet 12 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 30")
                         }
                      }
                    else
                      {
                       if(length(par) != 18)
                         {
                          stop("For a 1-fleet 12 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 18")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)                                                  }

                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -13)
                {
                 if(length(dates) != 28) {stop("For a 1-fleet 13P transit model 'dates' must be a vector of length 28")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 31)
                         {
                          stop("For a 1-fleet 13 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 31")
                         }
                      }
                    else
                      {
                       if(length(par) != 18)
                         {
                          stop("For a 1-fleet 13 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 18")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 32)
                         {
                          stop("For a 1-fleet 13 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 32")
                         }
                      }
                    else
                      {
                       if(length(par) != 19)
                         {
                          stop("For a 1-fleet 13 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 19")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -14)
                {
                 if(length(dates) != 30) {stop("For a 1-fleet 14P transit model 'dates' must be a vector of length 30")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 33)
                         {
                          stop("For a 1-fleet 14 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 33")
                         }
                      }
                    else
                      {
                       if(length(par) != 19)
                         {
                          stop("For a 1-fleet 14 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 19")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 34)
                         {
                          stop("For a 1-fleet 14 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 34")
                         }
                      }
                    else
                      {
                       if(length(par) != 20)
                         {
                          stop("For a 1-fleet 14 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 20")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -15)
                {
                 if(length(dates) != 32) {stop("For a 1-fleet 15P transit model 'dates' must be a vector of length 17")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 35)
                         {
                          stop("For a 1-fleet 15 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 35")
                         }
                      }
                    else
                      {
                       if(length(par) != 20)
                         {
                          stop("For a 1-fleet 15 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 20")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 36)
                         {
                          stop("For a 1-fleet 15 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 36")
                         }
                      }
                    else
                      {
                       if(length(par) != 21)
                         {
                          stop("For a 1-fleet 15 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 21")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -16)
                {
                 if(length(dates) != 34) {stop("For a 1-fleet 16P transit model 'dates' must be a vector of length 34")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 37)
                         {
                          stop("For a 1-fleet 16 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 37")
                         }
                      }
                    else
                      {
                       if(length(par) != 21)
                         {
                          stop("For a 1-fleet 16 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 21")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 38)
                         {
                          stop("For a 1-fleet 16 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 38")
                         }
                      }
                    else
                      {
                       if(length(par) != 22)
                         {
                          stop("For a 1-fleet 16 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 22")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -17)
                {
                 if(length(dates) != 36) {stop("For a 1-fleet 17P transit model 'dates' must be a vector of length 36")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 39)
                         {
                          stop("For a 1-fleet 17 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 39")
                         }
                      }
                    else
                      {
                       if(length(par) != 22)
                         {
                          stop("For a 1-fleet 17 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 22")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 40)
                         {
                          stop("For a 1-fleet 17 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 40")
                         }
                      }
                    else
                      {
                       if(length(par) != 23)
                         {
                          stop("For a 1-fleet 17 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 23")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23)),
                                                                        mean=as.numeric(results1[i,1:length(par)]),
                                                                        cov=try(solve(temp[i,]$nhatend)),
                                                                        ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -18)
                {
                 if(length(dates) != 38) {stop("For a 1-fleet 18P transit model 'dates' must be a vector of length 38")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 41)
                         {
                          stop("For a 1-fleet 18 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 41")
                         }
                      }
                    else
                      {
                       if(length(par) != 23)
                         {
                          stop("For a 1-fleet 18 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 23")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 42)
                         {
                          stop("For a 1-fleet 18 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 42")
                         }
                      }
                    else
                      {
                       if(length(par) != 24)
                         {
                          stop("For a 1-fleet 18 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 24")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,3],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","k.","alpha.",
                                                       "beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -19)
                {
                 if(length(dates) != 40) {stop("For a 1-fleet 19P transit model 'dates' must be a vector of length 40")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 43)
                         {
                          stop("For a 1-fleet 19 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 43")
                         }
                      }
                    else
                      {
                       if(length(par) != 24)
                         {
                          stop("For a 1-fleet 19 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 24")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 44)
                         {
                          stop("For a 1-fleet 19 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 44")
                         }
                      }
                    else
                      {
                       if(length(par) != 25)
                         {
                          stop("For a 1-fleet 19 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 25")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -20)
                {
                 if(length(dates) != 42) {stop("For a 1-fleet 20P transit model 'dates' must be a vector of length 42")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 45)
                         {
                          stop("For a 1-fleet 20 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 45")
                         }
                      }
                    else
                      {
                       if(length(par) != 25)
                         {
                          stop("For a 1-fleet 20 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 25")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 46)
                         {
                          stop("For a 1-fleet 20 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 46")
                         }
                      }
                    else
                      {
                       if(length(par) != 26)
                         {
                          stop("For a 1-fleet 20 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 26")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name]][,2], 
                                                         obscat1=x$Data[[fleet.name]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian, 
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -21)
                {
                 if(length(dates) != 44) {stop("For a 1-fleet 21P transit model 'dates' must be a vector of length 44")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 47)
                         {
                          stop("For a 1-fleet 21 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 47")
                         }
                      }
                    else
                      {
                       if(length(par) != 26)
                         {
                          stop("For a 1-fleet 21 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 26")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 48)
                         {
                          stop("For a 1-fleet 21 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 48")
                         }
                      }
                    else
                      {
                       if(length(par) != 27)
                         {
                          stop("For a 1-fleet 21 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 27")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.P21.entry","ts.Q21.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","P21.","Q21.","k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.P21.entry","ts.P21.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","P21.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                           ~exp(x27)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -22)
                {
                 if(length(dates) != 46) {stop("For a 1-fleet 22P transit model 'dates' must be a vector of length 46")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 49)
                         {
                          stop("For a 1-fleet 22 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 49")
                         }
                      }
                    else
                      {
                       if(length(par) != 27)
                         {
                          stop("For a 1-fleet 22 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 27")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 50)
                         {
                          stop("For a 1-fleet 22 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 50")
                         }
                      }
                    else
                      {
                       if(length(par) != 28)
                         {
                          stop("For a 1-fleet 22 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 28")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.P21.entry","ts.Q21.exit","ts.P22.entry","ts.Q22.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","P21.","Q21.","P22.","Q22.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.P21.entry","ts.P21.exit",
                                                           "ts.P22.entry","ts.P22.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","P21.","P22.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                           ~exp(x27),~exp(x28)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -23)
                {
                 if(length(dates) != 48) {stop("For a 1-fleet 23P transit model 'dates' must be a vector of length 48")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 51)
                         {
                          stop("For a 1-fleet 23 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 51")
                         }
                      }
                    else
                      {
                       if(length(par) != 28)
                         {
                          stop("For a 1-fleet 23 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 28")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 52)
                         {
                          stop("For a 1-fleet 23 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 52")
                         }
                      }
                    else
                      {
                       if(length(par) != 29)
                         {
                          stop("For a 1-fleet 23 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 29")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.P21.entry","ts.Q21.exit","ts.P22.entry","ts.Q22.exit",
                                                           "ts.P23.entry","ts.Q23.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","P21.","Q21.","P22.","Q22.","P23.","Q23.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.P21.entry","ts.P21.exit",
                                                           "ts.P22.entry","ts.P22.exit","ts.P23.entry","ts.P23.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","P21.","P22.","P23.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51),~exp(x52)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                           ~exp(x27),~exp(x28),~exp(x29)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -24)
                {
                 if(length(dates) != 50) {stop("For a 1-fleet 24P transit model 'dates' must be a vector of length 50")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 53)
                         {
                          stop("For a 1-fleet 24 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 53")
                         }
                      }
                    else
                      {
                       if(length(par) != 29)
                         {
                          stop("For a 1-fleet 24 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 29")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 54)
                         {
                          stop("For a 1-fleet 24 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 54")
                         }
                      }
                    else
                      {
                       if(length(par) != 30)
                         {
                          stop("For a 1-fleet 24 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 30")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.P21.entry","ts.Q21.exit","ts.P22.entry","ts.Q22.exit",
                                                           "ts.P23.entry","ts.Q23.exit","ts.P24.entry","ts.Q24.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","P21.","Q21.","P22.","Q22.","P23.","Q23.","P24.","Q24.","k.","alpha.","beta."),
                                                       sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.P21.entry","ts.P21.exit",
                                                           "ts.P22.entry","ts.P22.exit","ts.P23.entry","ts.P23.exit","ts.P24.entry","ts.P24.exit",
                                                           "ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","P21.","P22.","P23.","P24.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51),~exp(x52),~exp(x53)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                           ~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             else if(p == -25)
                {
                 if(length(dates) != 52) {stop("For a 1-fleet 25P transit model 'dates' must be a vector of length 52")}
                 if(distr == "apnormal" | distr == "aplnormal" | distr == "poisson")
                   {
                    if(partial)
                      {
                       if(length(par) != 55)
                         {
                          stop("For a 1-fleet 25 perturbations transit model with partial emmigration, with poisson or adjusted profile likelihood par must be a vector of length 55")
                         }
                      }
                    else
                      {
                       if(length(par) != 30)
                         {
                          stop("For a 1-fleet 25 perturbations transit model with total emmigration, with poisson or adjusted profile likelihood par must be a vector of length 30")
                         }
                      }
                   }
                 if(distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "gamma" | distr == "roblognormal" | distr == "gumbel")
                   {
                    if(partial)
                      {
                       if(length(par) != 56)
                         {
                          stop("For a 1-fleet 25 perturbations transit model with partial emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 56")
                         }
                      }
                    else
                      {
                       if(length(par) != 31)
                         {
                          stop("For a 1-fleet 25 perturbations transit model with total emmigration, with negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution, par must be a vector of length 31")
                         }
                      }
                   }
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMNT',as.character(abs(p)),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name]][,2],
                                                         obscat1=x$Data[[fleet.name]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         partial=partial,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    if(partial)
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.Q1.exit","ts.P2.entry","ts.Q2.exit",
                                                           "ts.P3.entry","ts.Q3.exit","ts.P4.entry","ts.Q4.exit",
                                                           "ts.P5.entry","ts.Q5.exit","ts.P6.entry","ts.Q6.exit",
                                                           "ts.P7.entry","ts.Q7.exit","ts.P8.entry","ts.Q8.exit",
                                                           "ts.P9.entry","ts.Q9.exit","ts.P10.entry","ts.Q10.exit",
                                                           "ts.P11.entry","ts.Q11.exit","ts.P12.entry","ts.Q12.exit",
                                                           "ts.P13.entry","ts.Q13.exit","ts.P14.entry","ts.Q14.exit",
                                                           "ts.P15.entry","ts.Q15.exit","ts.P16.entry","ts.Q16.exit",
                                                           "ts.P17.entry","ts.Q17.exit","ts.P18.entry","ts.Q18.exit",
                                                           "ts.P19.entry","ts.Q19.exit","ts.P20.entry","ts.Q20.exit",
                                                           "ts.P21.entry","ts.Q21.exit","ts.P22.entry","ts.Q22.exit",
                                                           "ts.P23.entry","ts.Q23.exit","ts.P24.entry","ts.Q24.exit",
                                                           "ts.P25.entry","ts.Q25.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","Q1.","P2.","Q2.","P3.","Q3.","P4.","Q4.","P5.","Q5.","P6.","Q6.","P7.","Q7.",
                                                       "P8.","Q8.","P9.","Q9.","P10.","Q10.","P11.","Q11.","P12.","Q12.","P13.","Q13.",
                                                       "P14.","Q14.","P15.","Q15.","P16.","Q16.","P17.","Q17.","P18.","Q18.","P19.","Q19.",
                                                       "P20.","Q20.","P21.","Q21.","P22.","Q22.","P23.","Q23.","P24.","Q24.","P25.","Q25.",
                                                       "k.","alpha.","beta."),sort(rep(fleet.name,3+2*abs(p))),sep=""));
                      }
                    else
                      {
                       names(results2[[i]]$Dates)     <- c("ts.start","ts.P1.entry","ts.P1.exit","ts.P2.entry","ts.P2.exit","ts.P3.entry","ts.P3.exit",
                                                           "ts.P4.entry","ts.P4.exit","ts.P5.entry","ts.P5.exit","ts.P6.entry","ts.P6.exit",
                                                           "ts.P7.entry","ts.P7.exit","ts.P8.entry","ts.P8.exit","ts.P9.entry","ts.P9.exit",
                                                           "ts.P10.entry","ts.P10.exit","ts.P11.entry","ts.P11.exit","ts.P12.entry","ts.P12.exit",
                                                           "ts.P13.entry","ts.P13.exit","ts.P14.entry","ts.P14.exit","ts.P15.entry","ts.P15.exit",
                                                           "ts.P16.entry","ts.P16.exit","ts.P17.entry","ts.P17.exit","ts.P18.entry","ts.P18.exit",
                                                           "ts.P19.entry","ts.P19.exit","ts.P20.entry","ts.P20.exit","ts.P21.entry","ts.P21.exit",
                                                           "ts.P22.entry","ts.P22.exit","ts.P23.entry","ts.P23.exit","ts.P24.entry","ts.P24.exit",
                                                           "ts.P25.entry","ts.P25.exit","ts.end");
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.",
                                                       "P9.","P10.","P11.","P12.","P13.","P14.","P15.","P16.","P17.",
                                                       "P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.","k.","alpha.","beta."),sort(rep(fleet.name,3+abs(p))),sep=""));
                      }
                    if(distr == "gamma" | distr == "normal" | distr == "lognormal" | distr == "negbin" | distr == "roblognormal" | distr == "gumbel")
                      {
                       par.names <- c(par.names, paste("psi.",fleet.name,sep=""))
                      }
                    results2[[i]]$converg          <- "FAIL";
                    results2[[i]]$kkt              <- NA;
                    results2[[i]]$AIC              <- NA;
                    results2[[i]]$bt.par           <- NA;
                    results2[[i]]$num.grads        <- NA;
                    results2[[i]]$bt.stdev         <- rep(NA, length(par.names))
                    results2[[i]]$Cor              <- matrix(NA,length(par.names),length(par.names))
                    if(length(temp[i,]$ngatend) == length(par.names) & !any(is.na(temp[i,]$nhatend)) & 1/kappa(temp[i,]$nhatend) > 1e-15)
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par.names),length(par.names));
                                             if(distr == "poisson" | distr == "apnormal" | distr == "aplnormal")
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),~exp(x55)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                                             else
                                               {
                                                if(partial)
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),
                                                                           ~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                           ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),
                                                                           ~exp(x26),~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),
                                                                           ~exp(x32),~exp(x33),~exp(x34),~exp(x35),~exp(x36),~exp(x37),
                                                                           ~exp(x38),~exp(x39),~exp(x40),~exp(x41),~exp(x42),~exp(x43),
                                                                           ~exp(x44),~exp(x45),~exp(x46),~exp(x47),~exp(x48),~exp(x49),
                                                                           ~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),~exp(x55),
                                                                           ~exp(x56)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                                else
                                                  {
                                                   v <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),~exp(x6),~exp(x7),
                                                                           ~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),~exp(x13),~exp(x14),
                                                                           ~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),~exp(x20),
                                                                           ~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                           ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31)),
                                                                    mean=as.numeric(results1[i,1:length(par)]),
                                                                    cov=try(solve(temp[i,]$nhatend)),
                                                                    ses=FALSE)
                                                  }
                                               }
                       results2[[i]]$bt.stdev   <- sqrt(diag(v));
                       results2[[i]]$Cor        <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            } #Fleet 1
          #Two Fleets
          else if(length(fleet.name) == 2)
            {
             if(p[1] > p[2])
               {stop("The number of perturbations of the first fleet must equal or less than the number of perturbations of the second fleet")}
             if(sum(sort(dates[1:(p[1]+1)]) == dates[1:(p[1]+1)]) < length(dates[1:(p[1]+1)]) || sum(sort(dates[(p[1]+2):(p[1]+p[2]+2)]) == dates[(p[1]+2):(p[1]+p[2]+2)]) < length(dates[(p[1]+2):(p[1]+p[2]+2)]))
               {stop("Perturbation dates for each fleet should be arranged in ascending order")}
#             if(length(unique(dates[1:(p[1]+1)])) != length(dates[1:(p[1]+1)]) || length(unique(dates[(p[1]+2):(p[1]+p[2]+2)])) != length(dates[(p[1]+2):(p[1]+p[2]+2)]))   
#               {stop("Perturbation dates inside each fleet should be all distinct and distinct from initial and final date")}
             if(length(p) != 2) {stop("For a 2-fleet model 'p' must be of length 2")}
             distr.set  <- c('poisson', 'negbin', 'normal','apnormal','lognormal','aplnormal','gamma','roblognormal','gumbel')
             sdistr.set <- c('poisson','apnormal','aplnormal')
             distr.set  <- combn(distr.set,2)
             if(!sum(distr%in%distr.set)==2) {stop("'distr' must be a character vector of length 2 with a combination of 'normal','apnormal','lognormal','aplnormal', 'gamma', 'poisson', 'negbin', 'roblognormal' or 'gumbel', see help pages for CatDynFit")}
             if(distr[1] != distr[2]) {warning("When using two different distributions for the fit of a 2-fleet system the calculation of the AIC may be questionable \n Specially when one is for continuous observations and the other is for counts")}
             #0P0P
             if(p[1] == 0 & p[2] == 0)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 2-fleet 0 perturbation model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 10 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 9)
                      {
                       stop("For a 2-fleet 0 perturbation model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 9 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 8)
                      {
                       stop("For a 2-fleet 0 perturbation model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 8")
                      }
                   }
                 if(length(dates) != 2) {stop("For a 2-fleet 0P 0P (pure depletion) model 'dates' must be a vector of length 2")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #0P1P
             else if(p[1] == 0 & p[2] == 1)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 2-fleet 0P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 11 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 2-fleet 0P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 10 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 9)
                      {
                       stop("For a 2-fleet 0P 1P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 9")
                      }
                   }
                 if(length(dates) != 3) {stop("For a 2-fleet 0P 1P (pure depletion) model 'dates' must be a vector of length 3")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #0P2P 
             else if(p[1] == 0 & p[2] == 2)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 0P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 12 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 2-fleet 0P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 11 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 2-fleet 0P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 10")
                      }
                   }
                 if(length(dates) != 4) {stop("For a 2-Fleet 0P 2P model 'dates' must be a vector of length 4")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F2","ts.P2F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #0P3P
             else if(p[1] == 0 & p[2] == 3)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 0P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 13 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 0P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 12 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 2-fleet 0P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 11")
                      }
                   }
                 if(length(dates) != 5) {stop("For a 2-Fleet 0P 3P model 'dates' must be a vector of length 5")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F2","ts.P2F2","ts.P3F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #0P4P
             else if (p[1] == 0 & p[2] == 4)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 0P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 0P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 0P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
                      }
                   }
                 if(length(dates) != 6) {stop("For a 2-Fleet 0P 4P model 'dates' must be a vector of length 6")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #0P5P
             else if (p[1] == 0 & p[2] == 5)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 0P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 0P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 0P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
                      }
                   }
                 if(length(dates) != 7) {stop("For a 2-Fleet 0P 5P model 'dates' must be a vector of length 7")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
              #1P1P
              else if (p[1] == 1 & p[2] == 1)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 1P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 12 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 2-fleet 1P 1P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 11 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 10)
                      {
                       stop("For a 2-fleet 1P 1P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 10")
                      }
                   }
                 if(length(dates) != 4) {stop("For a 2-Fleet 1P 1P model 'dates' must be a vector of length 4")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P1F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #1P2P
             else if (p[1] == 1 & p[2] == 2)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 1P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 13 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 1P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 12 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 11)
                      {
                       stop("For a 2-fleet 1P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 11")
                      }
                   }
                 if(length(dates) != 5) {stop("For a 2-Fleet 1P 2P model 'dates' must be a vector of length 5")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P1F2","ts.P2F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #1P3P
             else if (p[1] == 1 & p[2] == 3)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 1P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 1P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 1P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
                      }
                   }
                 if(length(dates) != 6) {stop("For a 2-Fleet 1P 3P model 'dates' must be a vector of length 6")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                  }
                 rm(v);
                 rm(temp);
                }
             #1P4P
             else if (p[1] == 1 & p[2] == 4)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 1P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 1P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 1P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
                      }
                   }
                 if(length(dates) != 7) {stop("For a 2-Fleet 1P 4P model 'dates' must be a vector of length 7")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                  }
                 rm(v);
                 rm(temp);
                }
             else if (p[1] == 1 & p[2] == 5)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 1P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 1P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 1P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
                      }
                   }
                 if(length(dates) != 8) {stop("For a 2-Fleet 1P 5P model 'dates' must be a vector of length 8")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                  }
                 rm(v);
                 rm(temp);
                }
            #2P2P
             else if (p[1] == 2 & p[2] == 2)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 2P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 14 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 2P 2P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 13 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 12)
                      {
                       stop("For a 2-fleet 2P 2P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 12")
                      }
                   }
                 if(length(dates) != 6) {stop("For a 2-Fleet 2P 2P model 'dates' must be a vector of length 6")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P1F2","ts.P2F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #2P3P
             else if (p[1] == 2 & p[2] == 3)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 2P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 15 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 2P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 14 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 13)
                      {
                       stop("For a 2-fleet 2P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 13")
                      }
                   }
                 if(length(dates) != 7) {stop("For a 2-Fleet 2P 3P model 'dates' must be a vector of length 7")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #2P4P
             else if (p[1] == 2 & p[2] == 4)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 2P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 2P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 2P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
                      }
                   }
                 if(length(dates) != 8) {stop("For a 2-Fleet 2P 4P model 'dates' must be a vector of length 8")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #2P5P
             else if (p[1] == 2 & p[2] == 5)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 2-fleet 2P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 17 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 2P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 16 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 2P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 15")
                      }
                   }
                 if(length(dates) != 9) {stop("For a 2-Fleet 2P 5P model 'dates' must be a vector of length 9")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P1F2","ts.P2F2","ts.P3F2",
                                                        "ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                 }
             #3P3P
             else if (p[1] == 3 & p[2] == 3)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 3P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 16 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 3P 3P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 15 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 14)
                      {
                       stop("For a 2-fleet 3P 3P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 14")
                      }
                   }
                 if(length(dates) != 8) {stop("For a 2-Fleet 3P 3P model 'dates' must be a vector of length 8")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #3P4P
             else if (p[1] == 3 & p[2] == 4)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 2-fleet 3P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 17 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 3P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 16 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 15)
                      {
                       stop("For a 2-fleet 3P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 15")
                      }
                   }
                 if(length(dates) != 9) {stop("For a 2-Fleet 3P 4P model 'dates' must be a vector of length 9")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v)
                 rm(temp);
                }
             #3P5P
             else if (p[1] == 3 & p[2] == 5)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 2-fleet 3P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 18 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 2-fleet 3P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 17 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 3P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 16")
                      }
                   }
                 if(length(dates) != 10) {stop("For a 2-Fleet 3P 5P model 'dates' must be a vector of length 10")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P1F2","ts.P2F2",
                                                        "ts.P3F2","ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #4P4P
             else if (p[1] == 4 & p[2] == 4)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 2-fleet 4P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 18 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 2-fleet 4P 4P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 17 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 16)
                      {
                       stop("For a 2-fleet 4P 4P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 16")
                      }
                   }
                 if(length(dates) != 10) {stop("For a 2-Fleet 4P 4P model 'dates' must be a vector of length 10")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P1F2",
                                                        "ts.P2F2","ts.P3F2","ts.P4F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #4P5P
             else if (p[1] == 4 & p[2] == 5)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 19)
                      {
                       stop("For a 2-fleet 4P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 19 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 2-fleet 4P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 18 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 17)
                      {
                       stop("For a 2-fleet 4P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 17")
                      }
                   }
                 if(length(dates) != 11) {stop("For a 2-Fleet 4P 5P model 'dates' must be a vector of length 11")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P1F2",
                                                        "ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #5P5P
             else if (p[1] == 5 & p[2] == 5)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 20)
                      {
                       stop("For a 2-fleet 5P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 20 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 19)
                      {
                       stop("For a 2-fleet 5P 5P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 19 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 18)
                      {
                       stop("For a 2-fleet 5P 5P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 18")
                      }
                   }
                 if(length(dates) != 12) {stop("For a 2-Fleet 5P 5P model 'dates' must be a vector of length 12")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta.","P1.","P2.","P3.","P4.","P5.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #6P6P
             else if (p[1] == 6 & p[2] == 6)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 22)
                      {
                       stop("For a 2-fleet 6P 6P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 22 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 21)
                      {
                       stop("For a 2-fleet 6P 6P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 21 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 20)
                      {
                       stop("For a 2-fleet 6P 6P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 20")
                      }
                   }
                 if(length(dates) != 14) {stop("For a 2-Fleet 6P 6P model 'dates' must be a vector of length 14")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1","ts.P6F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #7P7P
             else if (p[1] == 7 & p[2] == 7)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 24)
                      {
                       stop("For a 2-fleet 7P 7P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 24 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 23)
                      {
                       stop("For a 2-fleet 7P 7P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 23 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 22)
                      {
                       stop("For a 2-fleet 7P 7P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 22")
                      }
                   }
                 if(length(dates) != 16) {stop("For a 2-Fleet 7P 7P model 'dates' must be a vector of length 16")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #8P8P
             else if (p[1] == 8 & p[2] == 8)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 26)
                      {
                       stop("For a 2-fleet 8P 8P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 26 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 25)
                      {
                       stop("For a 2-fleet 8P 8P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 25 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 24)
                      {
                       stop("For a 2-fleet 8P 8P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 24")
                      }
                   }
                 if(length(dates) != 18) {stop("For a 2-Fleet 8P 8P model 'dates' must be a vector of length 18")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #9P9P
             else if (p[1] == 9 & p[2] == 9)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 28)
                      {
                       stop("For a 2-fleet 9P 9P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 28 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 27)
                      {
                       stop("For a 2-fleet 9P 9P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 27 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 26)
                      {
                       stop("For a 2-fleet 9P 9P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 26")
                      }
                   }
                 if(length(dates) != 20) {stop("For a 2-Fleet 9P 9P model 'dates' must be a vector of length 20")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #10P10P
             else if (p[1] == 10 & p[2] == 10)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 30)
                      {
                       stop("For a 2-fleet 10P 10P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 30 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 29)
                      {
                       stop("For a 2-fleet 10P 10P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 29 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 28)
                      {
                       stop("For a 2-fleet 10P 10P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 28")
                      }
                   }
                 if(length(dates) != 22) {stop("For a 2-Fleet 10P 10P model 'dates' must be a vector of length 22")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #11P11P
             else if (p[1] == 11 & p[2] == 11)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 32)
                      {
                       stop("For a 2-fleet 11P 11P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 32 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 31)
                      {
                       stop("For a 2-fleet 11P 11P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 31 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 30)
                      {
                       stop("For a 2-fleet 11P 11P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 30")
                      }
                   }
                 if(length(dates) != 24) {stop("For a 2-Fleet 11P 11P model 'dates' must be a vector of length 24")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #12P12P
             else if (p[1] == 12 & p[2] == 12)                                                              
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 34)
                      {
                       stop("For a 2-fleet 12P 12P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 34 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 33)
                      {
                       stop("For a 2-fleet 12P 12P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 33 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 32)
                      {
                       stop("For a 2-fleet 12P 12P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 32")
                      }
                   }
                 if(length(dates) != 26) {stop("For a 2-Fleet 12P 12P model 'dates' must be a vector of length 26")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #13P13P
             else if (p[1] == 13 & p[2] == 13)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 36)
                      {
                       stop("For a 2-fleet 13P 13P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 36 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 35)
                      {
                       stop("For a 2-fleet 13P 13P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 35 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 34)
                      {
                       stop("For a 2-fleet 13P 13P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 34")
                      }
                   }
                 if(length(dates) != 28) {stop("For a 2-Fleet 13P 13P model 'dates' must be a vector of length 28")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #14P14P
             else if (p[1] == 14 & p[2] == 14)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 38)
                      {
                       stop("For a 2-fleet 14P 14P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 38 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 37)
                      {
                       stop("For a 2-fleet 14P 14P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 37 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 36)
                      {
                       stop("For a 2-fleet 14P 14P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 36")
                      }
                   }
                 if(length(dates) != 30) {stop("For a 2-Fleet 14P 14P model 'dates' must be a vector of length 30")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #15P15P
             else if (p[1] == 15 & p[2] == 15)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 40)
                      {
                       stop("For a 2-fleet 15P 15P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 40 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 39)
                      {
                       stop("For a 2-fleet 15P 15P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 39 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 38)
                      {
                       stop("For a 2-fleet 15P 15P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 38")
                      }
                   }
                 if(length(dates) != 32) {stop("For a 2-Fleet 15P 15P model 'dates' must be a vector of length 32")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #16P16P
             else if (p[1] == 16 & p[2] == 16)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 42)
                      {
                       stop("For a 2-fleet 16P 16P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 42 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 41)
                      {
                       stop("For a 2-fleet 16P 16P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 41 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 40)
                      {
                       stop("For a 2-fleet 16P 16P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 40")
                      }
                   }
                 if(length(dates) != 34) {stop("For a 2-Fleet 16P 16P model 'dates' must be a vector of length 34")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #17P17P
             else if (p[1] == 17 & p[2] == 17)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 44)
                      {
                       stop("For a 2-fleet 17P 17P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 44 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 43)
                      {
                       stop("For a 2-fleet 17P 17P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 43 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 42)
                      {
                       stop("For a 2-fleet 17P 17P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 42")
                      }
                   }
                 if(length(dates) != 36) {stop("For a 2-Fleet 17P 17P model 'dates' must be a vector of length 36")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
             #18P18P
             else if (p[1] == 18 & p[2] == 18)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 46)
                      {
                       stop("For a 2-fleet 18P 18P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 46 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 45)
                      {
                       stop("For a 2-fleet 18P 18P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 45 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 44)
                      {
                       stop("For a 2-fleet 18P 18P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 44")
                      }
                   }
                 if(length(dates) != 38) {stop("For a 2-Fleet 18P 18P model 'dates' must be a vector of length 38")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #19P19P
            else if (p[1] == 19 & p[2] == 19)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 48)
                      {
                       stop("For a 2-fleet 19P 19P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 48 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 47)
                      {
                       stop("For a 2-fleet 19P 19P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 47 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 46)
                      {
                       stop("For a 2-fleet 19P 19P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 46")
                      }
                   }
                 if(length(dates) != 40) {stop("For a 2-Fleet 19P 19P model 'dates' must be a vector of length 40")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #20P20P
            else if (p[1] == 20 & p[2] == 20)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 50)
                      {
                       stop("For a 2-fleet 20P 20P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 50 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 49)
                      {
                       stop("For a 2-fleet 20P 20P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 49 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 48)
                      {
                       stop("For a 2-fleet 20P 20P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 48")
                      }
                   }
                 if(length(dates) != 42) {stop("For a 2-Fleet 20P 20P model 'dates' must be a vector of length 42")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL, 
                                                         dates=dates, 
                                                         obseff1=x$Data[[fleet.name[1]]][,2], 
                                                         obscat1=x$Data[[fleet.name[1]]][,5], 
                                                         obseff2=x$Data[[fleet.name[2]]][,2], 
                                                         obscat2=x$Data[[fleet.name[2]]][,5], 
                                                         distr=distr, 
                                                         method=method, 
                                                         lower = -Inf, 
                                                         upper = Inf, 
                                                         control=list(), 
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.end"); 
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #21P21P
            else if (p[1] == 21 & p[2] == 21)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 52)
                      {
                       stop("For a 2-fleet 21P 21P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 52 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 51)
                      {
                       stop("For a 2-fleet 21P 21P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 51 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 50)
                      {
                       stop("For a 2-fleet 21P 21P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 50")
                      }
                   }
                 if(length(dates) != 44) {stop("For a 2-Fleet 21P 21P model 'dates' must be a vector of length 44")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name[1]]][,2],
                                                         obscat1=x$Data[[fleet.name[1]]][,5],
                                                         obseff2=x$Data[[fleet.name[2]]][,2],
                                                         obscat2=x$Data[[fleet.name[2]]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1","ts.P21F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.P21F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #22P22P
            else if (p[1] == 22 & p[2] == 22)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 54)
                      {
                       stop("For a 2-fleet 22P 22P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 54 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 53)
                      {
                       stop("For a 2-fleet 22P 22P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 53 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 52)
                      {
                       stop("For a 2-fleet 22P 22P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 52")
                      }
                   }
                 if(length(dates) != 46) {stop("For a 2-Fleet 22P 22P model 'dates' must be a vector of length 46")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name[1]]][,2],
                                                         obscat1=x$Data[[fleet.name[1]]][,5],
                                                         obseff2=x$Data[[fleet.name[2]]][,2],
                                                         obscat2=x$Data[[fleet.name[2]]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1","ts.P21F1","ts.P22F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.P21F2","ts.P22F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #23P23P
            else if (p[1] == 23 & p[2] == 23)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 56)
                      {
                       stop("For a 2-fleet 23P 23P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 56 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 55)
                      {
                       stop("For a 2-fleet 23P 23P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 55 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 54)
                      {
                       stop("For a 2-fleet 23P 23P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 54")
                      }
                   }
                 if(length(dates) != 48) {stop("For a 2-Fleet 23P 23P model 'dates' must be a vector of length 48")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name[1]]][,2],
                                                         obscat1=x$Data[[fleet.name[1]]][,5],
                                                         obseff2=x$Data[[fleet.name[2]]][,2],
                                                         obscat2=x$Data[[fleet.name[2]]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1","ts.P21F1","ts.P22F1",
                                                        "ts.P23F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.P21F2","ts.P22F2","ts.P23F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #24P24P
            else if (p[1] == 24 & p[2] == 24)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 58)
                      {
                       stop("For a 2-fleet 24P 24P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 58 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 57)
                      {
                       stop("For a 2-fleet 24P 24P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 57 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 56)
                      {
                       stop("For a 2-fleet 24P 24P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 56")
                      }
                   }
                 if(length(dates) != 50) {stop("For a 2-Fleet 24P 24P model 'dates' must be a vector of length 50")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name[1]]][,2],
                                                         obscat1=x$Data[[fleet.name[1]]][,5],
                                                         obseff2=x$Data[[fleet.name[2]]][,2],
                                                         obscat2=x$Data[[fleet.name[2]]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1","ts.P21F1","ts.P22F1",
                                                        "ts.P23F1","ts.P24F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.P21F2","ts.P22F2","ts.P23F2",
                                                        "ts.P24F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56),~exp(x57)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56),~exp(x57),~exp(x58)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #25P25P
            else if (p[1] == 25 & p[2] == 25)
                {
                 if(sum(distr%in%sdistr.set) == 0)
                   {
                    if(length(par) != 60)
                      {
                       stop("For a 2-fleet 25P 25P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for both fleets, par must be a vector of length 60 \n Put initial values for dispersion parameters for fleet 1 and fleet 2 in the last two positions of the parameter vector, in their obvious order")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 1)
                   {
                    if(length(par) != 59)
                      {
                       stop("For a 2-fleet 25P 25P model with either negative binomial, normal, lognormal, gamma, robust lognormal or gumbel distribution for one of the fleets, par must be a vector of length 59 \n Put initial value for dispersion parameter of that fleet in the last position of the parameter vector")
                      }
                   }
                 if(sum(distr%in%sdistr.set) == 2)
                   {
                    if(length(par) != 58)
                      {
                       stop("For a 2-fleet 25P 25P model with either poisson, apnormal, or aplnormal distribution for both fleets, par must be a vector of length 58")
                      }
                   }
                 if(length(dates) != 52) {stop("For a 2-Fleet 25P 25P model 'dates' must be a vector of length 52")}
                 results1        <- do.call(optimx, list(par=par,
                                                         fn=eval(as.name(paste('.CDMN',as.character(p[1]),'P',as.character(p[2]),'P',sep=""))),
                                                         gr=NULL,
                                                         dates=dates,
                                                         obseff1=x$Data[[fleet.name[1]]][,2],
                                                         obscat1=x$Data[[fleet.name[1]]][,5],
                                                         obseff2=x$Data[[fleet.name[2]]][,2],
                                                         obscat2=x$Data[[fleet.name[2]]][,5],
                                                         distr=distr,
                                                         method=method,
                                                         lower = -Inf,
                                                         upper = Inf,
                                                         control=list(),
                                                         hessian=hessian,
                                                         itnmax=itnmax,
                                                         output="estimate"));
                 results2        <- vector("list",length(method));
                 names(results2) <- method;
                 temp            <- attr(results1, "details")
                 for(i in 1:length(method))
                   {
                    results2[[i]]$Type       <- p;
                    results2[[i]]$Dates      <- dates;
                    results2[[i]]$Distr      <- distr;
                    names(results2[[i]]$Dates)     <- c("ts.start","ts.P1F1","ts.P2F1","ts.P3F1","ts.P4F1","ts.P5F1",
                                                        "ts.P6F1","ts.P7F1","ts.P8F1","ts.P9F1","ts.P10F1","ts.P11F1",
                                                        "ts.P12F1","ts.P13F1","ts.P14F1","ts.P15F1","ts.P16F1",
                                                        "ts.P17F1","ts.P18F1","ts.P19F1","ts.P20F1","ts.P21F1","ts.P22F1",
                                                        "ts.P23F1","ts.P24F1","ts.P25F1",
                                                        "ts.P1F2","ts.P2F2","ts.P3F2","ts.P4F2","ts.P5F2","ts.P6F2",
                                                        "ts.P7F2","ts.P8F2","ts.P9F2","ts.P10F2","ts.P11F2","ts.P12F2",
                                                        "ts.P13F2","ts.P14F2","ts.P15F2","ts.P16F2","ts.P17F2",
                                                        "ts.P18F2","ts.P19F2","ts.P20F2","ts.P21F2","ts.P22F2","ts.P23F2",
                                                        "ts.P24F2","ts.P25F2","ts.end");
                    if(sum(distr%in%sdistr.set) == 2)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""));
                      }
                    if(sum(distr%in%sdistr.set) == 1)
                      {
                       if(distr[1]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi2.",fleet.name[2],sep=""));
                         }
                       if(distr[2]%in%sdistr.set)
                         {
                          par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                          "k.","alpha.","beta.",
                                                          "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                          "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                          "k.","alpha.","beta."),
                                                        c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                                  paste("psi1.",fleet.name[1],sep=""));
                         }
                      }
                    if(sum(distr%in%sdistr.set) == 0)
                      {
                       par.names <- c("M","N0",paste(c("P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                       "k.","alpha.","beta.",
                                                       "P1.","P2.","P3.","P4.","P5.","P6.","P7.","P8.","P9.","P10.","P11.","P12.","P13.",
                                                       "P14.","P15.","P16.","P17.","P18.","P19.","P20.","P21.","P22.","P23.","P24.","P25.",
                                                       "k.","alpha.","beta."),
                                                     c(rep(fleet.name[1],3+p[1]),rep(fleet.name[2],3+p[2])),sep=""),
                                               paste("psi1.",fleet.name[1],sep=""),paste("psi2.",fleet.name[2],sep=""));
                      }
                    if(length(temp[i,]$ngatend) < length(par.names) || any(is.na(temp[i,]$nhatend)) || 1/kappa(temp[i,]$nhatend) < 1e-15)
                      {
                       results2[[i]]$converg          <- "FAIL";
                       results2[[i]]$kkt              <- NA;
                       results2[[i]]$AIC              <- NA;
                       results2[[i]]$bt.par           <- NA;
                       results2[[i]]$num.grads        <- NA;
                       results2[[i]]$bt.stdev <- rep(NA, length(par.names))
                       results2[[i]]$Cor      <- matrix(NA,length(par.names),length(par.names))
                      }
                    else
                      {
                       results2[[i]]$converg    <- results1[i,length(par)+5];
                       results2[[i]]$kkt        <- results1[i,(length(par)+6):(length(par)+7)];
                       results2[[i]]$AIC        <- 2*length(par)+2*results1[i,length(par)+1];
                       results2[[i]]$bt.par     <- exp(results1[i,1:length(par)])
                       results2[[i]]$num.grads  <- temp[i,]$ngatend;
                                             v  <- matrix(0,length(par),length(par))
                                             if(sum(distr%in%sdistr.set) == 2)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56),~exp(x57),~exp(x58)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 1)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56),~exp(x57),~exp(x58),~exp(x59)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                                             if(sum(distr%in%sdistr.set) == 0)
                                               {
                                                v  <- deltamethod(g=list(~exp(x1),~exp(x2),~exp(x3),~exp(x4),~exp(x5),
                                                                         ~exp(x6),~exp(x7),~exp(x8),~exp(x9),~exp(x10),~exp(x11),~exp(x12),
                                                                         ~exp(x13),~exp(x14),~exp(x15),~exp(x16),~exp(x17),~exp(x18),~exp(x19),
                                                                         ~exp(x20),~exp(x21),~exp(x22),~exp(x23),~exp(x24),~exp(x25),~exp(x26),
                                                                         ~exp(x27),~exp(x28),~exp(x29),~exp(x30),~exp(x31),~exp(x32),~exp(x33),
                                                                         ~exp(x34),~exp(x35),~exp(x36),~exp(x37),~exp(x38),~exp(x39),~exp(x40),
                                                                         ~exp(x41),~exp(x42),~exp(x43),~exp(x44),~exp(x45),~exp(x46),~exp(x47),
                                                                         ~exp(x48),~exp(x49),~exp(x50),~exp(x51),~exp(x52),~exp(x53),~exp(x54),
                                                                         ~exp(x55),~exp(x56),~exp(x57),~exp(x58),~exp(x59),~exp(x60)),
                                                                  mean=as.numeric(results1[i,1:length(par)]),
                                                                  cov=try(solve(temp[i,]$nhatend)),
                                                                  ses=FALSE)
                                               }
                       results2[[i]]$bt.stdev         <- sqrt(diag(v));
                       results2[[i]]$Cor              <- cor(v);
                       names(results2[[i]]$num.grads) <- par.names;
                       names(results2[[i]]$bt.par)    <- par.names;
                       names(results2[[i]]$bt.stdev)  <- par.names;
                       colnames(results2[[i]]$Cor)    <- par.names;
                       rownames(results2[[i]]$Cor)    <- par.names;
                      }
                   }
                 rm(v);
                 rm(temp);
                }
            #STOP
            else 
                {
                 stop("The perturbations parameter vector p does not correspond with any of the allowed models for 2 fleets")
                }
             } #Fleet 2
            results                     <- vector("list",3);
            names(results)              <- c("Data","Initial","Model")
            results$Data                <- x;
            results$Initial             <- exp(par);
            names(results$Initial)      <- par.names;
            results$Model               <- results2;
            class(results)              <- "catdyn";
            return(results);
           }
#
########################  C - MODEL FIT PREDICTION  ##########################
#
CatDynPred <- function(x, method,partial=TRUE)
   {
     fleet.name <- x$Data$Properties$Fleets$Fleet;
     p          <- x$Model[[method]]$Type;
     options(warn=-1)
     if(class(x) != "catdyn")
       {stop("Pass an object of class 'catdyn' to CatDynPred")}
     if(class(method) != "character")
       {stop("method must be a character corresponding to one of the numerical methods passed to the CatDyn function")}  
     if(length(method) != 1)
       {stop("Provide the name of just one the numerical methods used to fit the model")}  
     if(sum(method == names(x$Model)) == 0)
       {stop("The method provided in 'method' was not used to numerically fit the model")}
     if(is.na(x$Model[[method]]$AIC))
       {stop("The selected method failed. Consider trying a different method")}
     if(length(fleet.name) == 1)
       {
        parlist <- list(par=log(as.numeric(x$Model[[method]]$bt.par)), 
                        dates=x$Model[[method]]$Dates, 
                        obscat1=x$Data$Data[[fleet.name]][,5], #in numbers
                        obseff1=x$Data$Data[[fleet.name]][,2], 
                        obsmbm1=x$Data$Data[[fleet.name]][,4], 
                        distr=x$Model[[method]]$Distr, 
                        properties=x$Data$Properties,
                        output="predict",
                        partial=partial)
        if(p == 0)
          {
          results <- do.call(.CDMN0P, parlist);
          }
        else if(p == 1)
          {
          results <- do.call(.CDMN1P, parlist);
          }
        else if(p == -1)
          {
          results <- do.call(.CDMNT1P, parlist);
          }
        else if(p == 2)
          {
          results <- do.call(.CDMN2P, parlist);
          }
        else if(p == -2)
          {
          results <- do.call(.CDMNT2P, parlist);
          }
        else if(p == 3)
          {
          results <- do.call(.CDMN3P, parlist);
          }
        else if(p == -3)
          {
          results <- do.call(.CDMNT3P, parlist);
          }
        else if(p == 4)
          {
          results <- do.call(.CDMN4P, parlist);
          }
        else if(p == -4)
          {
          results <- do.call(.CDMNT4P, parlist);
          }
        else if(p == 5)
          {
          results <- do.call(.CDMN5P, parlist);
          }
        else if(p == -5)
          {
          results <- do.call(.CDMNT5P, parlist);
          }
        else if(p == 6)
          {
          results <- do.call(.CDMN6P, parlist);
          }
        else if(p == -6)
          {
          results <- do.call(.CDMNT6P, parlist);
          }
        else if(p == 7)
          {
          results <- do.call(.CDMN7P, parlist);
          }
        else if(p == -7)
          {
          results <- do.call(.CDMNT7P, parlist);
          }
        else if(p == 8)
          {
          results <- do.call(.CDMN8P, parlist);
          }
        else if(p == -8)
          {
          results <- do.call(.CDMNT8P, parlist);
          }
        else if(p == 9)
          {
          results <- do.call(.CDMN9P, parlist);
          }
        else if(p == -9)
          {
          results <- do.call(.CDMNT9P, parlist);
          }
        else if(p == 10)
          {
          results <- do.call(.CDMN10P, parlist);
          }
        else if(p == -10)
          {
          results <- do.call(.CDMNT10P, parlist);
          }
        else if(p == 11)
          {
          results <- do.call(.CDMN11P, parlist);
          }
        else if(p == -11)
          {
          results <- do.call(.CDMNT11P, parlist);
          }
        else if(p == 12)
          {
          results <- do.call(.CDMN12P, parlist);
          }
        else if(p == -12)
          {
          results <- do.call(.CDMNT12P, parlist);
          }
        else if(p == 13)
          {
          results <- do.call(.CDMN13P, parlist);
          }
        else if(p == -13)
          {
          results <- do.call(.CDMNT13P, parlist);
          }
        else if(p == 14)
          {
          results <- do.call(.CDMN14P, parlist);
          }
        else if(p == -14)
          {
          results <- do.call(.CDMNT14P, parlist);
          }
        else if(p == 15)
          {
          results <- do.call(.CDMN15P, parlist);
          }
        else if(p == -15)
          {
          results <- do.call(.CDMNT15P, parlist);
          }
        else if(p == 16)
          {
          results <- do.call(.CDMN16P, parlist);
          }
        else if(p == -16)
          {
          results <- do.call(.CDMNT16P, parlist);
          }
        else if(p == 17)
          {
          results <- do.call(.CDMN17P, parlist);
          }
        else if(p == -17)
          {
          results <- do.call(.CDMNT17P, parlist);
          }
        else if(p == 18)
          {
          results <- do.call(.CDMN18P, parlist);
          }
        else if(p == -18)
          {
          results <- do.call(.CDMNT18P, parlist);
          }
        else if(p == 19)
          {
          results <- do.call(.CDMN19P, parlist);
          }
        else if(p == -19)
          {
          results <- do.call(.CDMNT19P, parlist);
          }
        else if(p == 20)
          {
          results <- do.call(.CDMN20P, parlist);
          }
        else if(p == -20)
          {
          results <- do.call(.CDMNT20P, parlist);
          }
        else if(p == 21)
          {
          results <- do.call(.CDMN21P, parlist);
          }
        else if(p == -21)
          {
          results <- do.call(.CDMNT21P, parlist);
          }
        else if(p == 22)
          {
          results <- do.call(.CDMN22P, parlist);
          }
        else if(p == -22)
          {
          results <- do.call(.CDMNT22P, parlist);
          }
        else if(p == 23)
          {
          results <- do.call(.CDMN23P, parlist);
          }
        else if(p == -23)
          {
          results <- do.call(.CDMNT23P, parlist);
          }
        else if(p == 24)
          {
          results <- do.call(.CDMN24P, parlist);
          }
        else if(p == -24)
          {
          results <- do.call(.CDMNT24P, parlist);
          }
        else if(p == 25)
          {
          results <- do.call(.CDMN25P, parlist);
          }
        else if(p == -25)
          {
          results <- do.call(.CDMNT25P, parlist);
          }
       }
     else if(length(fleet.name) == 2) 
       {
        parlist <- list(par=log(as.numeric(x$Model[[method]]$bt.par)), 
                        dates=x$Model[[method]]$Dates, 
                        obscat1=x$Data$Data[[fleet.name[1]]][,5], 
                        obseff1=x$Data$Data[[fleet.name[1]]][,2], 
                        obsmbm1=x$Data$Data[[fleet.name[1]]][,4],
                        obscat2=x$Data$Data[[fleet.name[2]]][,5], 
                        obseff2=x$Data$Data[[fleet.name[2]]][,2], 
                        obsmbm2=x$Data$Data[[fleet.name[2]]][,4], 
                        distr=x$Model[[method]]$Distr, 
                        properties=x$Data$Properties,
                        output="predict")
        if(sum(p==c(0,0)) == length(p))
          {
          results <- do.call(.CDMN0P0P, parlist);
          }
        else if(sum(p==c(0,1)) == length(p))
          {
          results <- do.call(.CDMN0P1P, parlist);
          }
        else if(sum(p==c(0,2)) == length(p))
          {
          results <- do.call(.CDMN0P2P, parlist);
          }
        else if(sum(p==c(0,3)) == length(p))
          {
          results <- do.call(.CDMN0P3P, parlist);
          }
        else if(sum(p==c(0,4)) == length(p))
          {
          results <- do.call(.CDMN0P4P, parlist);
          }
        else if(sum(p==c(0,5)) == length(p))
          {
          results <- do.call(.CDMN0P5P, parlist);
          }
        else if(sum(p==c(1,1)) == length(p))
          {
          results <- do.call(.CDMN1P1P, parlist);
          }                                                                                                                                            
        else if(sum(p==c(1,2)) == length(p))
          {
          results <- do.call(.CDMN1P2P, parlist);
          }
        else if(sum(p==c(1,3)) == length(p))
          {
          results <- do.call(.CDMN1P3P, parlist);
          }
        else if(sum(p==c(1,4)) == length(p))
          {
          results <- do.call(.CDMN1P4P, parlist);
          }
        else if(sum(p==c(1,5)) == length(p))
          {
          results <- do.call(.CDMN1P5P, parlist);
          }
        else if(sum(p==c(2,2)) == length(p))
          {
          results <- do.call(.CDMN2P2P, parlist);
          }
        else if(sum(p==c(2,3)) == length(p))
          {
          results <- do.call(.CDMN2P3P, parlist);
          }
        else if(sum(p==c(2,4)) == length(p))
          {
          results <- do.call(.CDMN2P4P, parlist);
          }
        else if(sum(p==c(2,5)) == length(p))
          {
          results <- do.call(.CDMN2P5P, parlist);
          }
        else if(sum(p==c(3,3)) == length(p))
          {
          results <- do.call(.CDMN3P3P, parlist);
          }
        else if(sum(p==c(3,4)) == length(p))
          {
          results <- do.call(.CDMN3P4P, parlist);
          }
        else if(sum(p==c(3,5)) == length(p))
          {
          results <- do.call(.CDMN3P5P, parlist);
          }
        else if(sum(p==c(4,4)) == length(p))
          {
          results <- do.call(.CDMN4P4P, parlist);
          }
        else if(sum(p==c(4,5)) == length(p))
          {
          results <- do.call(.CDMN4P5P, parlist);
          }
        else if(sum(p==c(5,5)) == length(p))
          {
          results <- do.call(.CDMN5P5P, parlist);
          }
        else if(sum(p==c(6,6)) == length(p))
          {
          results <- do.call(.CDMN6P6P, parlist);
          }
        else if(sum(p==c(7,7)) == length(p))
          {
          results <- do.call(.CDMN7P7P, parlist);
          }
        else if(sum(p==c(8,8)) == length(p))
          {
          results <- do.call(.CDMN8P8P, parlist);
          }
        else if(sum(p==c(9,9)) == length(p))
          {
          results <- do.call(.CDMN9P9P, parlist);
          }
        else if(sum(p==c(10,10)) == length(p))
          {
          results <- do.call(.CDMN10P10P, parlist);
          }
        else if(sum(p==c(11,11)) == length(p))
          {
          results <- do.call(.CDMN11P11P, parlist);
          }
        else if(sum(p==c(12,12)) == length(p))
          {
          results <- do.call(.CDMN12P12P, parlist);
          }
        else if(sum(p==c(13,13)) == length(p))
          {
          results <- do.call(.CDMN13P13P, parlist);
          }
        else if(sum(p==c(14,14)) == length(p))
          {
          results <- do.call(.CDMN14P14P, parlist);
          }
        else if(sum(p==c(15,15)) == length(p))
          {
          results <- do.call(.CDMN15P15P, parlist);
          }
        else if(sum(p==c(16,16)) == length(p))
          {
          results <- do.call(.CDMN16P16P, parlist);
          }
        else if(sum(p==c(17,17)) == length(p))
          {
          results <- do.call(.CDMN17P17P, parlist);
          }
        else if(sum(p==c(18,18)) == length(p))
          {
          results <- do.call(.CDMN18P18P, parlist);
          }
        else if(sum(p==c(19,19)) == length(p))
          {
          results <- do.call(.CDMN19P19P, parlist);
          }
        else if(sum(p==c(20,20)) == length(p))
          {
          results <- do.call(.CDMN20P20P, parlist);
          }
        else if(sum(p==c(21,21)) == length(p))
          {
          results <- do.call(.CDMN21P21P, parlist);
          }
        else if(sum(p==c(22,22)) == length(p))
          {
          results <- do.call(.CDMN22P22P, parlist);
          }
        else if(sum(p==c(23,23)) == length(p))
          {
          results <- do.call(.CDMN23P23P, parlist);
          }
        else if(sum(p==c(24,24)) == length(p))
          {
          results <- do.call(.CDMN24P24P, parlist);
          }
        else if(sum(p==c(25,25)) == length(p))
          {
          results <- do.call(.CDMN25P25P, parlist);
          }
       }
     results$Model$Method     <- method;
     results$Model$AIC        <- x$Model[[method]]$AIC;
     class(results)           <- "CatDynMod";
     return(results);
    }
#
#########################  D  - MODEL FIT PLOT   ###############################
#
plot.CatDynMod <- function(x,leg.pos,Biom.tstep,Cat.tstep,Biom.xpos,Biom.ypos,Cat.xpos,Cat.ypos,diagnostics.panels=2,top.lab=TRUE,...)
    {
     if(class(x) != "CatDynMod")
       {stop("Pass an object of class 'CatDynMod' to plot.CatDynMod")}
     if(!is.numeric(Biom.tstep) | !is.numeric(Biom.xpos) | !is.numeric(Biom.ypos) | !is.numeric(Cat.xpos) | !is.numeric(Cat.ypos))
       {stop("Biom.tstep must be integer, Biom.xpos, Biom.ypos, Cat.xpos, Cat.ypos must be numeric")}
     if(Biom.tstep > tail(x$Model$Results[,1],1)) {stop("Biommas cannot be averaqed over a number of time steps as high as Biom.tstep")}
     if(Cat.tstep > tail(x$Model$Results[,1],1)) {stop("Catch cannot be summed over a number of time steps as high as Cat.tstep")}
     fleet.name <- x$Properties$Fleets$Fleet
     period     <- x$Model$Results$Period
     tstep      <- x$Properties$Units[1]
     catunits   <- paste("Catch (",x$Properties$Units[4],")",sep="")
     index      <- 1:length(x$Model$Results[,dim(x$Model$Results)[2]])
     Biom       <- round(mean(tail(x$Model$Results[,"Predicted.Biomass.tonnes"],Biom.tstep),na.rm=TRUE))
     Cat        <- ifelse(length(fleet.name) == 1,
                          round(1e-3*sum(tail(x$Model$Results[,5],Cat.tstep),na.rm=TRUE)),
                          round(1e-3*sum(tail(x$Model$Results[,5],Cat.tstep)+
                                         tail(x$Model$Results[,13],Cat.tstep),na.rm=TRUE)))
     options(warn=-1)
     for(i in 1:length(fleet.name))
       {
       obscat <- x$Model$Results[,i*3+5*(i-1)]   #1Fleet 3 2Fleet 3 11
       modcat <- x$Model$Results[,i*4+4*(i-1)]   #1Fleet 4 2Fleet 4 12
       resids <- x$Model$Results[,i*9-1*(i-1)]   #1Fleet 9 2Fleet 9 17
       if(diagnostics.panels==0)
         {
          par(mfrow=c(1,1))
          plot(x=period,y=obscat,pch=19, xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=catunits,ylim=c(0,max(obscat,modcat)),main="",cex=0.75)
          lines(x=period,y=modcat,col="black",lwd=2)
          legend(leg.pos,c("Observed Catch", "Predicted Catch"), bty="n", pch=c(19, NA), lty=c(0, 1), lwd=c(0,2), col=c("black", "black"))
          if(x$Properties$Units[3] != "ind")
            {
             text(x=Biom.xpos*max(period), y=Biom.ypos*max(obscat), adj=0,lab=list(bquote("Biomass_(tons)" ==.(Biom))))
             text(x=Cat.xpos*max(period), y=Cat.ypos*max(obscat), adj=0,lab=list(bquote("Catch.ton" ==.(Cat))))
            }
          if(x$Model$Type[i] != 0)
            {
             if(i == 1)
               {
                if(x$Model$Type[i] > 0)
                  {
                   points(x=x$Model$Dates[2:(x$Model$Type[i]+1)],
                          y=rep(0,x$Model$Type[i]),
                          pch=10,cex=3)
                  }
                else
                  {
                   points(x=x$Model$Dates[seq(2,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="red")
                   points(x=x$Model$Dates[seq(3,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="blue")
                  }
               }
             else
               {
                points(x=x$Model$Dates[(2+x$Model$Type[i-1]):(1+x$Model$Type[i-1]+x$Model$Type[i])],
                       y=rep(0,x$Model$Type[i]),
                       pch=10,cex=3)
               }
            }
          if(top.lab==TRUE)
            {
             mtext(side=3,outer=TRUE,text=paste("Fleet = ",fleet.name[i],", Perturbations = ",x$Model$Type[i],", Distribution = ",gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", x$Model$Distribution[i], perl=TRUE),", Numerical algorithm = ", x$Model$Method, sep=""))
            }
          options(warn=0)
          devAskNewPage(ask=TRUE)
         }
       if(diagnostics.panels==1)
         {
          par(mfrow=c(2,2),oma=c(0,0,2,0),mar=c(4,4,2,2))
          plot(x=period,y=obscat,pch=19, xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=catunits,ylim=c(0,max(obscat,modcat)),main="",cex=0.75)
          lines(x=period,y=modcat,col="black",lwd=2)
          legend(leg.pos,c("Observed Catch", "Predicted Catch"), bty="n", pch=c(19, NA), lty=c(0, 1), lwd=c(0,2), col=c("black", "black"))
          if(x$Properties$Units[3] != "ind")
            {
             text(x=Biom.xpos*max(period), y=Biom.ypos*max(obscat), adj=0,lab=list(bquote("Biomass_(tons)" ==.(Biom))))
             text(x=Cat.xpos*max(period), y=Cat.ypos*max(obscat), adj=0,lab=list(bquote("Catch.ton" ==.(Cat))))
            }
          if(x$Model$Type[i] != 0)
            {
             if(i == 1)
               {
                if(x$Model$Type[i] > 0)
                  {
                   points(x=x$Model$Dates[2:(x$Model$Type[i]+1)],
                          y=rep(0,x$Model$Type[i]),
                          pch=10,cex=3)
                  }
                else
                  {
                   points(x=x$Model$Dates[seq(2,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="red")
                   points(x=x$Model$Dates[seq(3,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="blue")
                  }
               }
             else
               {
                points(x=x$Model$Dates[(2+x$Model$Type[i-1]):(1+x$Model$Type[i-1]+x$Model$Type[i])],
                       y=rep(0,x$Model$Type[i]),
                       pch=10,cex=3)
               }
            }
          hist(x=resids,main="",xlab="Deviance Residuals",ylab="Frequency")
          plot(x=period,y=resids,xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE), ylab="Deviance Residuals",pch=1,type="n")
          abline(h=0,lwd=2)
          text(x=period,y=resids,lab=format(period),cex=0.75)
          qqplot(x=obscat,y=modcat,xlab=paste("Observed Catch (",x$Properties$Units[4],")", sep=""),ylab=paste("Predicted Catch (",x$Properties$Units[4],")", sep=""),pch=1)
          abline(a=0,b=1,lwd=2)
          if(top.lab==TRUE)
            {
             mtext(side=3,outer=TRUE,text=paste("Fleet = ",fleet.name[i],", Perturbations = ",x$Model$Type[i],", Distribution = ",gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", x$Model$Distribution[i], perl=TRUE),", Numerical algorithm = ", x$Model$Method, sep=""))
            }
          options(warn=0)
          devAskNewPage(ask=TRUE)
         }
       if(diagnostics.panels==2)
         {
          layout(matrix(c(1,1,1,1,1,1,1,1,1,2,3,4,2,3,4),5,3, byrow = TRUE))
          par(oma=c(2,2,2,1), mar=c(4,4.5,2,2))
          plot(x=period,y=obscat,pch=19, xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab=catunits,ylim=c(0,max(obscat,modcat)),main="",cex.lab=1.4,cex.axis=1.5)
          lines(x=period,y=modcat,col="black",lwd=2)
          legend(leg.pos,c("Observed Catch", "Predicted Catch"), bty="n", pch=c(19, NA), lty=c(0, 1), lwd=c(0,2), col=c("black", "black"),cex=1.5)
          if(x$Properties$Units[3] != "ind")
            {
             text(x=Biom.xpos*max(period), y=Biom.ypos*max(obscat), adj=0,lab=list(bquote("Biomass_(tons)" ==.(Biom))))
             text(x=Cat.xpos*max(period), y=Cat.ypos*max(obscat), adj=0,lab=list(bquote("Catch.ton" ==.(Cat))))
            }
          if(x$Model$Type[i] != 0)
            {
             if(i == 1)
               {
                if(x$Model$Type[i] > 0)
                  {
                   points(x=x$Model$Dates[2:(x$Model$Type[i]+1)],
                          y=rep(0,x$Model$Type[i]),
                          pch=10,cex=3)
                  }
                else
                  {
                   points(x=x$Model$Dates[seq(2,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="red")
                   points(x=x$Model$Dates[seq(3,(2*abs(x$Model$Type[i])+1),2)],
                          y=rep(0,abs(x$Model$Type[i])),
                          pch=10,cex=3,col="blue")
                  }
               }
             else
               {
                points(x=x$Model$Dates[(2+x$Model$Type[i-1]):(1+x$Model$Type[i-1]+x$Model$Type[i])],
                       y=rep(0,x$Model$Type[i]),
                       pch=10,cex=3)
               }
            }
          hist(x=resids,main="",xlab="Deviance Residuals",ylab="Frequency",cex.lab=1.4,cex.axis=1.5)
          plot(x=period,y=resids,xlab=gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", tstep, perl=TRUE),ylab="Deviance Residuals",pch=1,type="n",cex.lab=1.4,cex.axis=1.5)
          abline(h=0,lwd=2)
          text(x=period,y=resids,lab=format(period),cex=0.75)
          qqplot(x=obscat,y=modcat,xlab=paste("Observed Catch (",x$Properties$Units[4],")", sep=""),ylab=paste("Predicted Catch (",x$Properties$Units[4],")", sep=""),pch=1,cex.lab=1.4,cex.axis=1.5)
          abline(a=0,b=1,lwd=2)
          if(top.lab==TRUE)
            {
             mtext(side=3,outer=TRUE,text=paste("Fleet = ",fleet.name[i],", Perturbations = ",x$Model$Type[i],", Distribution = ",gsub("(\\w)(\\w*)", "\\U\\1\\L\\2", x$Model$Distribution[i], perl=TRUE),", Numerical algorithm = ", x$Model$Method, sep=""))
            }
          options(warn=0)
          devAskNewPage(ask=TRUE)
         }
       }
     devAskNewPage(ask=FALSE)
    }
#

#
#########################  VIII MODEL FIT SELECTION  ###########################
#
########################## A - Numerical summary  ##############################
#
CatDynSum <- function(x, season, method, partial=TRUE)
   {
    if(class(x) != "list")
      {stop("'x' should be a list with each component an output of function CatDynFit(), class 'catdyn'")}
    if(sum(sapply(x,class) == "catdyn") != length(x))
      {stop("'x' should be a list with each component an output of function CatDynFit(), class 'catdyn'")}
    if(length(method) != length(x))
      {stop("One numerical method for each component of 'x' should be provided")}
    if(any(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)<0) & any(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)>0))
      {stop("It is not allowed to mix conventional and transit stock models in this function")}
    if(unique(sapply(1:length(x), function(u) length(x[[u]]$Data$Properties$Fleets$Fleet)) == 1)) #1 Fleet
      {
       fleet.name  <- unique(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet));
       effort.unit <- sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Units);
       maxP        <- max(abs(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type))) # corrected inverted positions of max and abs
       if(maxP == 0)
         {
          res         <- data.frame(matrix(0,nrow=length(x),ncol=12+7))
          names(res) <- c("Fleet","Effort","Season","Model","Distribution","Method","AIC","Max.Abs.Grads.","M","SE.M","N0","SE.N0",
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name,sep=""),"Sel.Model")
         }
       if(maxP > 0 & partial & all(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type) < 0))
         {
          res         <- data.frame(matrix(0,nrow=length(x),ncol=12+3*2*maxP+7))
          names(res)  <- c("Fleet","Effort","Season","Model","Distribution","Method","AIC","Max.Abs.Grads.","M","SE.M","N0","SE.N0",
                           paste(rep(c("P","SE.P","ts.P","Q","SE.Q","ts.Q"),maxP),sort(rep(1:maxP,6)),sep=""),
                           c("k","SE.k","alpha","SE.alpha","beta","SE.beta"),
                           "Sel.Model")
         }
       if(maxP > 0 & partial & all(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type) > 0))
         {
          res         <- data.frame(matrix(0,nrow=length(x),ncol=12+3*maxP+7))
          names(res) <- c("Fleet","Effort","Season","Model","Distribution","Method","AIC","Max.Abs.Grads.","M","SE.M","N0","SE.N0",
                          paste(paste(rep(c("P","SE.P","ts.P"),maxP),sort(rep(1:maxP,3)),rep(".",maxP),sep=""),fleet.name,sep=""),
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name,sep=""),
                          "Sel.Model")
         }
       if(maxP > 0 & !partial & all(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type) > 0))
         {
          res         <- data.frame(matrix(0,nrow=length(x),ncol=12+3*maxP+7))
         }
       res$Fleet          <- fleet.name
       res$Effort         <- effort.unit
       res$Season         <- rep(season,length(x))
       res$Model          <- paste(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type),"P",sep="")
       res$Distribution   <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Distr)
       res$Method         <- method
       res$AIC            <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$AIC)
       res$Max.Abs.Grads. <- sapply(1:length(x), function(u) max(abs(x[[u]]$Model[[method[u]]]$num.grads)))
       res$M              <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par["M"]))
       res$SE.M           <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev["M"])
       res$N0             <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par["N0"])
       res$SE.N0          <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev["N0"])
       if(maxP == 0)
         {
          res$k <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name,sep="")]))
          res$SE.k <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name,sep="")])
          res$alpha <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name,sep="")]))
          res$SE.alpha <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name,sep="")])
          res$beta <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name,sep="")]))
          res$SE.beta <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name,sep="")])
          res$Sel.Model <- 0
         }
       if(partial & any(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)<0))
         {
          for(i in 1:length(x))
            {
             if(abs(x[[i]]$Model[[method[i]]]$Type)!=0)
               {
                for(j in 1:abs(x[[i]]$Model[[method[i]]]$Type))
                  {
                   res[i,13+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.par[paste("P",as.character(j),".",fleet.name,sep="")]
                   res[i,14+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.stdev[paste("P",as.character(j),".",fleet.name,sep="")]
                   res[i,15+3*(j-1)] <- x[[i]]$Model[[method[i]]]$Dates[1+j]
                   res[i,16+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.par[paste("Q",as.character(j),".",fleet.name,sep="")]
                   res[i,17+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.stdev[paste("Q",as.character(j),".",fleet.name,sep="")]
                   res[i,18+3*(j-1)] <- x[[i]]$Model[[method[i]]]$Dates[1+2*j]
                  }
               }
             res[i,12+3*2*maxP+1] <- x[[i]]$Model[[method[i]]]$bt.par[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+1]
             res[i,12+3*2*maxP+2] <- x[[i]]$Model[[method[i]]]$bt.stdev[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+1]
             res[i,12+3*2*maxP+3] <- x[[i]]$Model[[method[i]]]$bt.par[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+2]
             res[i,12+3*2*maxP+4] <- x[[i]]$Model[[method[i]]]$bt.stdev[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+2]
             res[i,12+3*2*maxP+5] <- x[[i]]$Model[[method[i]]]$bt.par[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+3]
             res[i,12+3*2*maxP+6] <- x[[i]]$Model[[method[i]]]$bt.stdev[2+2*abs(x[[i]]$Model[[method[i]]]$Type)+3]
            }
         }
       else
         {
          for(i in 1:length(x))
            {
             if(abs(x[[i]]$Model[[method[i]]]$Type)!=0)
               {
                for(j in 1:abs(x[[i]]$Model[[method[i]]]$Type))
                  {
                   res[i,13+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.par[paste("P",as.character(j),".",fleet.name,sep="")]
                   res[i,14+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.stdev[paste("P",as.character(j),".",fleet.name,sep="")]
                   res[i,15+3*(j-1)] <- x[[i]]$Model[[method[i]]]$Dates[1+j]
                  }
               }
            }
          res[,3*maxP+13] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name,sep="")]))
          res[,3*maxP+14] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name,sep="")])
          res[,3*maxP+15] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name,sep="")]))
          res[,3*maxP+16] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name,sep="")])
          res[,3*maxP+17] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name,sep="")]))
          res[,3*maxP+18] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name,sep="")])
          res[,3*maxP+19] <- 0
         } 
      }   
    else if(anyDuplicated(t(sapply(1:length(x), function(u) unique(x[[u]]$Data$Properties$Fleets$Fleet)))) == 2) #2 Fleets
      {
       maxP        <- max(sapply(1:length(x), function(u) sum(x[[u]]$Model[[method[u]]]$Type)))
       maxPF1      <- max(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)[1,])
       maxPF2      <- max(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)[2,])
       res         <- data.frame(matrix(0,nrow=length(x),ncol=12+3*maxP+13))
       for(i in 1:length(x))
         {
          res$X1[i] <- paste(t(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet))[i,1],
                             t(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet))[i,2],sep=",")
          res$X2[i] <- paste(t(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Units))[i,1],
                             t(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Units))[i,2],sep=",")
         }
       fleet.name  <- c(unique(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet)[1,]),
                        unique(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet)[2,]))
       res$X3      <- rep(season,length(x))
       for(i in 1:length(x))
         {
          res$X4[i] <- paste(x[[i]]$Model[[method[i]]]$Type[1],"P", x[[i]]$Model[[method[i]]]$Type[2],"P",sep="")
          res$X5[i] <- paste(t(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Distr))[i,1],
                             t(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Distr))[i,2],sep=",")
         }
       res$X6     <- method
       res$X7     <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$AIC)
       res$X8     <- sapply(1:length(x), function(u) max(abs(x[[u]]$Model[[method[u]]]$num.grads)))
       res$X9     <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par["M"]))
       res$X10    <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev["M"])
       res$X11    <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par["N0"])
       res$X12    <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev["N0"])
       if(maxP == 0)
         {
          res$X13 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name[1],sep="")]))
          res$X14 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name[1],sep="")])
          res$X15 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name[1],sep="")]))
          res$X16 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name[1],sep="")])
          res$X17 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name[1],sep="")]))
          res$X18 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name[1],sep="")])
          res$X19 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name[2],sep="")]))
          res$X20 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name[2],sep="")])
          res$X21 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name[2],sep="")]))
          res$X22 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name[2],sep="")])
          res$X23 <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name[2],sep="")]))
          res$X24 <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name[2],sep="")])
          res$X25 <- 0
          names(res) <- c("Fleets","Effort","Season","Model","Distribution","Method","AIC","Max.Abs.Grads.","M","SE.M","N0","SE.N0",
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name[1],sep=""),
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name[2],sep=""),
                          "Sel.Model")
         }
       else
         {
          for(i in 1:length(x))
            {
             if(x[[i]]$Model[[method[i]]]$Type[1]!=0)
               {
                for(j in 1:x[[i]]$Model[[method[i]]]$Type[1])
                  {
                   res[i,13+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.par[paste("P",as.character(j),".",fleet.name[1],sep="")]
                   res[i,14+3*(j-1)] <- x[[i]]$Model[[method[i]]]$bt.stdev[paste("P",as.character(j),".",fleet.name[1],sep="")]
                   res[i,15+3*(j-1)] <- x[[i]]$Model[[method[i]]]$Dates[1+j]
                  }
                } 
             if(x[[i]]$Model[[method[i]]]$Type[2]!=0)
               {
                for(k in 1:x[[i]]$Model[[method[i]]]$Type[2])
                  {
                   res[i,13+3*(maxPF1)+3*(k-1)] <- x[[i]]$Model[[method[i]]]$bt.par[paste("P",as.character(k),".",fleet.name[2],sep="")]
                   res[i,14+3*(maxPF1)+3*(k-1)] <- x[[i]]$Model[[method[i]]]$bt.stdev[paste("P",as.character(k),".",fleet.name[2],sep="")]
                   res[i,15+3*(maxPF1)+3*(k-1)] <- x[[i]]$Model[[method[i]]]$Dates[1+x[[i]]$Model[[method[i]]]$Type[1]+k]
                  }
               }
            }
          res[,3*maxP+13] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name[1],sep="")]))
          res[,3*maxP+14] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name[1],sep="")])
          res[,3*maxP+15] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name[1],sep="")]))
          res[,3*maxP+16] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name[1],sep="")])
          res[,3*maxP+17] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name[1],sep="")]))
          res[,3*maxP+18] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name[1],sep="")])
          res[,3*maxP+19] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("k.",fleet.name[2],sep="")]))
          res[,3*maxP+20] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("k.",fleet.name[2],sep="")])
          res[,3*maxP+21] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("alpha.",fleet.name[2],sep="")]))
          res[,3*maxP+22] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("alpha.",fleet.name[2],sep="")])
          res[,3*maxP+23] <- unlist(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.par[paste("beta.",fleet.name[2],sep="")]))
          res[,3*maxP+24] <- sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$bt.stdev[paste("beta.",fleet.name[2],sep="")])
          res[,3*maxP+25] <- 0
          names(res) <- c("Fleets","Effort","Season","Model","Distribution","Method","AIC","Max.Abs.Grads.","M","SE.M","N0","SE.N0",
                          paste(paste(rep(c("P","SE.P","ts.P"),maxPF1),sort(rep(1:maxPF1,3)),rep(".",maxPF1),sep=""),fleet.name[1],sep=""),
                          paste(paste(rep(c("P","SE.P","ts.P"),maxPF2),sort(rep(1:maxPF2,3)),rep(".",maxPF2),sep=""),fleet.name[2],sep=""),
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name[1],sep=""),
                          paste(c("k.","SE.k.","alpha.","SE.alpha.","beta.","SE.beta."),fleet.name[2],sep=""),
                          "Sel.Model")
         } 
      } 
    else
      {
       stop("All components of 'x' should have been built with data from the same fleets with the number of fleets > 0 and < 3")
      }
    return(res);
   }
#
################################## B - CORRELATION PLOT  #######################
#
CatDynCor <- function(x, ttl, method, arr)
  {
   if(length(x) != length(ttl))
     {stop("'x' and 'ttl' should be of the same length")}
   if(class(x) != "list")
     {stop("'x' should be a list with each component an output of function CatDynFit(), class 'catdyn'")}
   if(sum(sapply(x,class) == "catdyn") != length(x))
     {stop("'x' should be a list with each component an output of function CatDynFit(), class 'catdyn'")}
   if(class(ttl) != 'character')
     {stop("'ttl' should be a character vector")} 
   if(length(method) != length(x))
      {stop("One numerical method for each component of 'x' should be provided")}
   if(length(arr) != 2)
     {stop("'arr' is the number of rows and number of columns to deploy the panels. Passed as is to 'par'")}
   if(arr[1]*arr[2] < length(x))
     {warning("Not all model fits are shown")}
   if(length(x) == 1)
     {
      par(mfrow=arr,mar=c(2,3,1,1),oma=c(2,3,1,1))
      hist(unique(x[[1]]$Model[[method]]$Cor[-diag(x[[1]]$Model[[method]]$Cor)]),main=ttl,xlab="",cex.axis=1.5)
     }
   else
     {
      par(mfrow=arr,mar=c(2,3,1,1),oma=c(2,3,1,1))
      for(i in 1:length(x))
        {
         hist(unique(x[[i]]$Model[[method[i]]]$Cor[-diag(x[[i]]$Model[[method[i]]]$Cor)]),main=ttl[i],xlab="",cex.axis=1.5)
        }
     }
   mtext(side=1,outer=TRUE,text="Pairwise Correlation Coefficients",cex=1.25,line=1)
   mtext(side=2,outer=TRUE,text="Frequency",cex=1.25,line=1)
  } 
#
##############################  B -  DELTA METHOD  #############################
#
#from msm
deltamethod <- function(g, mean, cov, ses = TRUE)
                {
                 cov <- as.matrix(cov)
                 n <- length(mean)
                 if (!is.list(g))
                     g <- list(g)
                 if ((dim(cov)[1] != n) || (dim(cov)[2] != n))
                     stop(paste("Covariances should be a ", n, " by ", n, " matrix"))
                 syms <- paste("x", 1:n, sep = "")
                 for (i in 1:n) assign(syms[i], mean[i])
                 gdashmu <- t(sapply(g, function(form) {
                     as.numeric(attr(eval(deriv(form, syms)), "gradient"))
                 }))
                 new.covar <- gdashmu %*% cov %*% t(gdashmu)
                 if (ses) {
                     new.se <- sqrt(diag(new.covar))
                     new.se
                 }
                 else new.covar
                }
#
################################## B - PARAMETERS TABLE  #######################
#
CatDynPar <- function(x,method,partial=TRUE)
   {
   if(class(x) != "catdyn")
     {stop("'x' must be an object of class 'catdyn' (created by function CatDynFit)")}
    sdistr.set <- c("poisson","apnormal","aplnormal")
    if(x$Data$Properties$Units["Time Step"]=="month")
      {
       #Month 1 Fleet
       if(length(x$Data$Properties$Fleets$Fleet)==1)
         {
          month.F1 <- x$Model[[method]]$Dates[2:(x$Model[[method]]$Type+1)]
          years.F1 <- as.numeric(format(as.Date(x$Data$Properties$Dates["StartDate"]),"%Y"))+floor(month.F1/12)
          month.F1 <- as.integer((month.F1/12-floor(month.F1/12))*12)
          #Month 1 Fleet Likelihood without dispersion
          if(x$Model[[method]]$Distr%in%sdistr.set)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                "alpha","beta"),
                                    Timing=c("","",paste(years.F1,month.F1,sep="-"),"","",""),
                                    Estimates=unlist(x$Model[[method]]$bt.par),
                                    CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
            }
          #Month 1 Fleet Likelihood with dispersion
          if(!x$Model[[method]]$Distr%in%sdistr.set)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                "alpha","beta",
                                                paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                    Timing=c("","",paste(years.F1,month.F1,sep="-"),"","","",""),
                                    Estimates=unlist(x$Model[[method]]$bt.par),
                                    CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
            }
         #end of Month 1 Fleet
         }
       #Month 2 Fleets
       if(length(x$Data$Properties$Fleets$Fleet)==2)
         {
          month.F1 <- x$Model[[method]]$Dates[2:(x$Model[[method]]$Type[1]+1)]
          month.F2 <- x$Model[[method]]$Dates[(x$Model[[method]]$Type[1]+2):(x$Model[[method]]$Type[1]+1+x$Model[[method]]$Type[2])]
          years.F1 <- as.numeric(format(as.Date(x$Data$Properties$Dates["StartDate"]),"%Y"))+floor(month.F1/12)
          years.F2 <- as.numeric(format(as.Date(x$Data$Properties$Dates["StartDate"]),"%Y"))+floor(month.F2/12)
          month.F1 <- as.integer((month.F1/12-floor(month.F1/12))*12)
          month.F2 <- as.integer((month.F2/12-floor(month.F2/12))*12)
          if(any(month.F1==0)){month.F1[which(month.F1==0)] <- 12}
          if(any(month.F2==0)){month.F2[which(month.F2==0)] <- 12}
          #Month 2 Fleets Both fleets with likelihood without dispersion (sdristr.set)
          if(sum(x$Model[[method]]$Distr%in%sdistr.set)==2)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                "alpha","beta"),
                                    Timing.F1=c("","",paste(years.F1,month.F1,sep="-"),"","",""),
                                    Estimates.F1=unlist(x$Model[[method]]$bt.par[1:(2+length(years.F1)+3)]),
                                    CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[1:(2+length(years.F1)+3)])/
                                                         unlist(x$Model[[method]]$bt.par[1:(2+length(years.F1)+3)]),1),
                                    Timing.F2=c("","",paste(years.F2,month.F2,sep="-"),"","",""),
                                    Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):length(x$Model[[method]]$bt.par))]),
                                    CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+length(years.F2)+4):(length(x$Model[[method]]$bt.stdev)))])/
                                                         unlist(x$Model[[method]]$bt.par[(c(1,2,(2+length(years.F2)+4):length(x$Model[[method]]$bt.par)))]),1),row.names=NULL)
            names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
            names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
            }
          #Month 2 Fleets First fleet with likelihood without dispersion
          if(diff(x$Model[[method]]$Distr%in%sdistr.set)==-1)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                "alpha","beta",
                                                paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                    Timing.F1=c("","",paste(years.F1,month.F1,sep="-"),"","","",""),
                                    Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3))]),NA),
                                    CVpCent.F1=round(c(100*unlist(x$Model[[method]]$bt.stdev[c(1:(2+length(years.F1)+3))])/
                                                           unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3))]),NA),1),
                                    Timing.F2=c("","",paste(years.F2,month.F2,sep="-"),"","","",""),
                                    Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):length(x$Model[[method]]$bt.par))]),
                                    CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+length(years.F2)+3+1):length(x$Model[[method]]$bt.stdev))])/
                                                         unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):length(x$Model[[method]]$bt.par))]),1),row.names=NULL)
            names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
            names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
            }
          #Month 2 Fleets Second fleet with likelihood without dispersion
          if(diff(x$Model[[method]]$Distr%in%sdistr.set)==1)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                "alpha","beta",
                                                paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                    Timing.F1=c("","",paste(years.F1,month.F1,sep="-"),"","","",""),
                                    Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.par)))]),
                                    CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.stdev)))])/
                                                         unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.par)))]),1),
                                    Timing.F2=c("","",paste(years.F2,month.F2,sep="-"),"","","",""),
                                    Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.par)-1))]),NA),
                                    CVpCent.F2=c(round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.stdev)-1))])/
                                                           unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.par)-1))]),1),NA),row.names=NULL)
            names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
            names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
            }
          #Month 2 Fleets Both fleets with likelihood with dispersion
          if(sum(x$Model[[method]]$Distr%in%sdistr.set)==0)
            {
             partable <- data.frame(Parameter=c("M.1/month",
                                                paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".",years.F1,sep=""),
                                                paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                "alpha","beta",
                                                paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                    Timing.F1=c("","",paste(years.F1,month.F1,sep="-"),"","","",""),
                                    Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.par))-1)]),
                                    CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.stdev))-1)])/
                                                         unlist(x$Model[[method]]$bt.par[c(1:(2+length(years.F1)+3),length(unlist(x$Model[[method]]$bt.par))-1)]),1),
                                    Timing.F2=c("","",paste(years.F2,month.F2,sep="-"),"","","",""),
                                    Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.par)-2),(length(x$Model[[method]]$bt.par)))]),
                                    CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.stdev)-2),(length(x$Model[[method]]$bt.stdev)))])/
                                                         unlist(x$Model[[method]]$bt.par[c(1,2,(2+length(years.F2)+3+1):(length(x$Model[[method]]$bt.par)-2),(length(x$Model[[method]]$bt.par)))]),1),row.names=NULL)
            names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
            names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
            }
         #End of Month 2 Fleets
         }
      #End of month
      }
    if(x$Data$Properties$Units["Time Step"]=="day" | x$Data$Properties$Units["Time Step"]=="week")
      {
       #Week/Day 1 Fleet
       if(length(x$Data$Properties$Fleets$Fleet)==1)
         {
          #Week/Day 1 fleet Pure depletion
          if(x$Model[[method]]$Type==0)
            {
             #Week/Day 1 fleet Pure depletion Likelihood without dispersion
             if(x$Model[[method]]$Distr%in%sdistr.set)
               {
                if(x$Data$Properties$Units["Time Step"]=="week")
                  {
                   partable <- data.frame(Parameter=c("M.1/week",
                                                      paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                      paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                      "alpha","beta"),
                                          Estimates=unlist(x$Model[[method]]$bt.par),
                                          CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                  }
                if(x$Data$Properties$Units["Time Step"]=="day")
                  {
                   partable <- data.frame(Parameter=c("M.1/day",
                                                      paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                      paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                      "alpha","beta"),
                                          Estimates=unlist(x$Model[[method]]$bt.par),
                                          CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                  }
               }
             #Week/Day 1 fleet Pure depletion Likelihood with dispersion
             if(!x$Model[[method]]$Distr%in%sdistr.set)
               {
                if(x$Data$Properties$Units["Time Step"]=="week")
                  {
                   partable <- data.frame(Parameter=c("M.1/week",
                                                      paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                      paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                      "alpha","beta",
                                                      paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                          Estimates=unlist(x$Model[[method]]$bt.par),
                                          CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                  }
                if(x$Data$Properties$Units["Time Step"]=="day")
                  {
                   partable <- data.frame(Parameter=c("M.1/day",
                                                      paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                      paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                      "alpha","beta",
                                                      paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                          Estimates=unlist(x$Model[[method]]$bt.par),
                                          CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                  }
               }
            #End of Week/Day 1 fleet Pure depletion
            }
          if(x$Model[[method]]$Type!=0)
            #Week/Day 1 fleet With perturbations
            {
             #Week/Day 1 fleet With perturbations Likelihood without dispersion
             waves <- abs(x$Model[[method]]$Type)
             if(x$Model[[method]]$Distr %in% sdistr.set)
               {
                if(x$Data$Properties$Units["Time Step"]=="week")
                  {
                   year1           <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   finalweek.year1 <- as.numeric(format(as.Date(paste(year1,"-12-31",sep="")), "%W"))
                   year2           <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   #weeks    <- x$Model[[method]]$Dates[2:(waves+1)]
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   #dates.ranges <- vector("character",waves)
                   if(partial & x$Model[[method]]$Type < 0)
                     {
                      dates.ranges <- vector("character",2*waves)
                      if(year2 > year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(2*waves+1)] - finalweek.year1
                         for(w in 1:2*waves)
                           {
                            dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year2, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      if(year2 == year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(2*waves+1)]
                         for(w in 1:(2*waves))
                          {
                           dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                          }
                       }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Recruitment.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("Spawning.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta"),
                                             Timing=c("","",dates.ranges,"","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(partial & x$Model[[method]]$Type > 0)
                     {
                      dates.ranges <- vector("character",waves)
                      if(year2 > year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(2*waves+1)] - finalweek.year1
                         for(w in 1:waves)
                           {
                            dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year2, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      if(year2 == year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(waves+1)]
                         for(w in 1:(waves))
                          {
                           dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                          }
                       }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Recruitment.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta"),
                                             Timing=c("","",dates.ranges,"","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(!partial)
                     {
                      weeks        <- x$Model[[method]]$Dates[2:(waves+1)]
                      dates.ranges <- vector("character",waves)
                      for(w in 1:waves)
                        {
                         dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                        }
                         partable <- data.frame(Parameter=c("M.1/week",
                                                            paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                            paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                            paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                            "alpha","beta"),
                                                Timing=c("","",dates.ranges,"","",""),
                                                Estimates=unlist(x$Model[[method]]$bt.par),
                                                CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                  }
                if(x$Data$Properties$Units["Time Step"]=="day")
                  {
                   if(partial & x$Model[[method]]$Type < 0)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("Spawning.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta"),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+2)]),
                                                      "","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(partial & x$Model[[method]]$Type > 0)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta"),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+1)]),
                                                      "","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(!partial)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta"),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+1)]),"","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                 }
               }
             #Week/Day 1 fleet With perturbations Likelihood with dispersion
             if(!x$Model[[method]]$Distr %in% sdistr.set)
               {
                if(x$Data$Properties$Units["Time Step"]=="week")
                  {
                   year1           <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   finalweek.year1 <- as.numeric(format(as.Date(paste(year1,"-12-31",sep="")), "%W"))
                   year2           <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days            <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(partial & x$Model[[method]]$Type < 0)
                     {
                      dates.ranges <- vector("character",2*waves)
                      if(year2 > year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(2*waves+1)] - finalweek.year1
                         for(w in 1:2*waves)
                           {
                            dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year2, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      if(year2 == year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(2*waves+1)]
                         for(w in 1:2*waves)
                          {
                           dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                          }
                       }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Recruitment.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("Spawning.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing=c("","",dates.ranges,"","","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(partial & x$Model[[method]]$Type > 0)
                     {
                      dates.ranges <- vector("character",waves)
                      if(year2 > year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(waves+1)] - finalweek.year1
                         for(w in 1:waves)
                           {
                            dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year2, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      if(year2 == year1)
                        {
                         weeks <- x$Model[[method]]$Dates[2:(waves+1)]
                         for(w in 1:waves)
                          {
                           dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                          }
                       }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Recruitment.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing=c("","",dates.ranges,"","","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(!partial)
                     {
                      weeks        <- x$Model[[method]]$Dates[2:(waves+1)]
                      dates.ranges <- vector("character",waves)
                      for(w in 1:waves)
                        {
                         dates.ranges[w] <- paste(range(days[sprintf("%d %02d", year1, weeks[w]) == format(days, "%Y %U")]),collapse=' ')
                        }
                         partable <- data.frame(Parameter=c("M.1/week",
                                                            paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                            paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                            paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                            "alpha","beta",
                                                            paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                                Timing=c("","",dates.ranges,"","","",""),
                                                Estimates=unlist(x$Model[[method]]$bt.par),
                                                CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                  }
                if(x$Data$Properties$Units["Time Step"]=="day")
                  {
                   if(partial & x$Model[[method]]$Type < 0)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("Spawning.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+2)]),
                                                      "","","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(partial & x$Model[[method]]$Type > 0)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+1)]),
                                                      "","","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                   if(!partial)
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units,sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves+1)]),"","","",""),
                                             Estimates=unlist(x$Model[[method]]$bt.par),
                                             CVpCent=round(100*unlist(x$Model[[method]]$bt.stdev)/unlist(x$Model[[method]]$bt.par),1),row.names=NULL)
                     }
                  }
               }
            #End of Week/Day 1 fleet With perturbations
            }
         #End of Week/Day one fleet
         }
       #Week/Day 2 Fleets
       if(length(x$Data$Properties$Fleets$Fleet)==2)
         {
          #Week/Day 2 Fleets Pure depletion
          if(sum(x$Model[[method]]$Type)==0)
            {
            #Week/Day 2 Fleets Pure depletion Both fleets with likelihood without dispersion
            if(sum(x$Model[[method]]$Distr%in%sdistr.set)==2)
              {
               if(x$Data$Properties$Units["Time Step"]=="week")
                 {
                  partable <- data.frame(Parameter=c("M.1/week",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta"),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[1:5]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[1:5])/
                                                              unlist(x$Model[[method]]$bt.par[1:5]),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),1),row.names=NULL)
                 names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                 names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                 }
               if(x$Data$Properties$Units["Time Step"]=="day")
                 {
                  partable <- data.frame(Parameter=c("M.1/day",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta"),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[1:5]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[1:5])/
                                                              unlist(x$Model[[method]]$bt.par[1:5]),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),1),row.names=NULL)
                  names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                  names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                  }
               }
            #Week/Day 2 Fleets Pure depletion First fleet with likelihood without dispersion
            if(diff(x$Model[[method]]$Distr%in%sdistr.set)==-1)
              {
               if(x$Data$Properties$Units["Time Step"]=="week")
                 {
                  partable <- data.frame(Parameter=c("M.1/week",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=c(unlist(x$Model[[method]]$bt.par[1:5]),NA),
                                         CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[1:5]),NA)/
                                                              c(unlist(x$Model[[method]]$bt.par[1:5]),NA),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:9)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:9)]),1),row.names=NULL)
                 names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                 names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                 }
               if(x$Data$Properties$Units["Time Step"]=="day")
                 {
                  partable <- data.frame(Parameter=c("M.1/day",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=c(unlist(x$Model[[method]]$bt.par[1:5]),NA),
                                         CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[1:5]),NA)/
                                                              c(unlist(x$Model[[method]]$bt.par[1:5]),NA),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:9)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:9)]),1),row.names=NULL)
                  names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                  names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                  }
              }
            #Week/Day 2 Fleets Pure depletion Second fleet with likelihood without dispersion
            if(diff(x$Model[[method]]$Distr%in%sdistr.set)==1)
              {
               if(x$Data$Properties$Units["Time Step"]=="week")
                 {
                  partable <- data.frame(Parameter=c("M.1/week",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:5,9)]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:5,9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1:5,9)]),1),
                                         Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),NA),
                                         CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8)]),NA)/
                                                              c(unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),NA),1),row.names=NULL)
                 names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                 names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                 }
               if(x$Data$Properties$Units["Time Step"]=="day")
                 {
                  partable <- data.frame(Parameter=c("M.1/day",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:5,9)]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:5,9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1:5,9)]),1),
                                         Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),NA),
                                         CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8)]),NA)/
                                                              c(unlist(x$Model[[method]]$bt.par[c(1,2,6:8)]),NA),1),row.names=NULL)
                  names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                  names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                  }
              }
            #Week/Day 2 Fleets Pure depletion Both fleets with likelihood with dispersion
            if(sum(x$Model[[method]]$Distr%in%sdistr.set)==0)
              {
               if(x$Data$Properties$Units["Time Step"]=="week")
                 {
                  partable <- data.frame(Parameter=c("M.1/week",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:5,9)]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:5,9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1:5,9)]),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:8,10)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8,10)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:8,10)]),1),row.names=NULL)
                 names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                 names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                 }
               if(x$Data$Properties$Units["Time Step"]=="day")
                 {
                  partable <- data.frame(Parameter=c("M.1/day",
                                                     paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                     paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                     "alpha","beta",
                                                     paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                         Estimates.F1=unlist(x$Model[[method]]$bt.par[c(1:5,9)]),
                                         CVpCent.F1=round(100*unlist(x$Model[[method]]$bt.stdev[c(1:5,9)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1:5,9)]),1),
                                         Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:8,10)]),
                                         CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:8,10)])/
                                                              unlist(x$Model[[method]]$bt.par[c(1,2,6:8,10)]),1),row.names=NULL)
                  names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                  names(partable)[4:5] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                  }
             }
            #End of Week/Day 2 Fleets Pure depletion
            }
          if(sum(x$Model[[method]]$Type)!=0)
            #Week/Day 2 Fleets With perturbations
            {
             year     <- as.numeric(substring(x$Data$Properties$Dates[["StartDate"]],1,4))
             waves.F1 <- x$Model[[method]]$Type[1]
             waves.F2 <- x$Model[[method]]$Type[2]
             #Week/Day 2 Fleets With perturbations Both fleets with likelihood without dispersion (sdristr.set)
             if(sum(x$Model[[method]]$Distr%in%sdistr.set)==2)
               {
                #Only second fleet with perturbations
                if(waves.F1==0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks2    <- x$Model[[method]]$Dates[2:(waves.F2+1)]
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta"),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5])),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5])),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta"),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5])),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5])),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F2+1)]),"","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
                #Both fleets with perturbations
                if(waves.F1!=0 & waves.F2!=0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks1    <- x$Model[[method]]$Dates[2:(waves.F1+1)]
                      weeks2    <- x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+waves.F2+1)]
                      dates.ranges.F1 <- vector("character",waves.F1)
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F1)
                        {
                         if(weeks1[w] <= 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year1, weeks1[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks1[w] > 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year2, weeks1[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta"),
                                             Timing.F1=c("","",dates.ranges.F1,rep("",3+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)])),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)])),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+3))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+3))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+3))]),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta"),
                                             Timing.F1=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F1+1)]),rep("",3+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)])),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)])),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+1+waves.F2)]),"","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(waves.F1+6):(waves.F1+5+waves.F2+3))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,(waves.F1+6):(waves.F1+5+waves.F2+3))]),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
               }
             #First fleet with likelihood without dispersion
             if(diff(x$Model[[method]]$Distr%in%sdistr.set)==-1)
               {
                #Only second fleet with perturbations
                if(waves.F1==0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks2   <- x$Model[[method]]$Dates[2:(waves.F2+1)]
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),NA),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),NA),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),NA),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),NA),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F2+1)]),"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
                #Both fleets with perturbations
                if(waves.F1!=0 & waves.F2!=0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks1    <- x$Model[[method]]$Dates[2:(waves.F1+1)]
                      weeks2    <- x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+waves.F2+1)]
                      dates.ranges.F1 <- vector("character",waves.F1)
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F1)
                        {
                         if(weeks1[w] <= 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year1, weeks1[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks1[w] > 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year2, weeks1[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",dates.ranges.F1,rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),NA),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),NA),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+4))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+4))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+4):(2+waves.F1+3+waves.F2+4))]),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F1+1)]),rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),NA),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),NA),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+1+waves.F2)]),"","","",""),
                                             Estimates.F2=unlist(x$Model[[method]]$bt.par[c(1,2,(waves.F1+6):((waves.F1+6+waves.F2+3)))]),
                                             CVpCent.F2=round(100*unlist(x$Model[[method]]$bt.stdev[c(1,2,(waves.F1+6):((waves.F1+6+waves.F2+3)))])/
                                                                  unlist(x$Model[[method]]$bt.par[c(1,2,(waves.F1+6):((waves.F1+6+waves.F2+3)))]),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
               }
             #Second fleet with likelihood without dispersion
             if(diff(x$Model[[method]]$Distr%in%sdistr.set)==1)
               {
                #Only second fleet with perturbations
                if(waves.F1==0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks2   <- x$Model[[method]]$Dates[2:(waves.F2+1)]
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),1)),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+length(waves.F2)+3))]),NA),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),NA),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),1)),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F2+1)]),"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),NA),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),NA),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
                #Both fleets with perturbations
                if(waves.F1!=0 & waves.F2!=0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks1    <- x$Model[[method]]$Dates[2:(waves.F1+1)]
                      weeks2    <- x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+waves.F2+1)]
                      dates.ranges.F1 <- vector("character",waves.F1)
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F1)
                        {
                         if(weeks1[w] <= 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year1, weeks1[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks1[w] > 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year2, weeks1[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",dates.ranges.F1,rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),1)),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F1+1)]),rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),1)),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+1+waves.F2)]),"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA)/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),NA),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
               }
             #Both fleets with likelihood with dispersion
             else if(sum(x$Model[[method]]$Distr%in%sdistr.set)==0)
               {
                #Only second fleet with perturbations
                if(waves.F1==0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks2    <- x$Model[[method]]$Dates[2:(waves.F2+1)]
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),tail(unlist(x$Model[[method]]$bt.stdev),2)[1])/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2)]),rep(0,waves.F2),unlist(x$Model[[method]]$bt.stdev[3:5]),tail(unlist(x$Model[[method]]$bt.stdev),2)[1])/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2)]),rep(1,waves.F2),unlist(x$Model[[method]]$bt.par[3:5]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F2+1)]),"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,6:(5+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:3] <- paste(c("Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[4:6] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
                #Both fleets with perturbations
                else if(waves.F1!=0 & waves.F2!=0)
                  {
                   year1    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["StartDate"]]), "%Y"))
                   year2    <- as.numeric(format(as.Date(x$Data$Properties$Dates[["EndDate"]]), "%Y"))
                   days     <- as.Date(paste(year1, 1, 1, sep = "-"))+0:365*(year2-year1+1)
                   if(x$Data$Properties$Units["Time Step"]=="week")
                     {
                      weeks1    <- x$Model[[method]]$Dates[2:(waves.F1+1)]
                      weeks2    <- x$Model[[method]]$Dates[2:(waves.F2+1)]
                      dates.ranges.F1 <- vector("character",waves.F1)
                      dates.ranges.F2 <- vector("character",waves.F2)
                      for(w in 1:waves.F1)
                        {
                         if(weeks1[w] <= 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year1, weeks1[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks1[w] > 53)
                           {
                            dates.ranges.F1[w] <- paste(range(days[sprintf("%d %02d", year2, weeks1[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      for(w in 1:waves.F2)
                        {
                         if(weeks2[w] <= 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year1, weeks2[w]) == format(days, "%Y %U")]),collapse=' ')
                           }
                         if(weeks2[w] > 53)
                           {
                            dates.ranges.F2[w] <- paste(range(days[sprintf("%d %02d", year2, weeks2[w]-53) == format(days, "%Y %U")]),collapse=' ')
                           }
                        }
                      partable <- data.frame(Parameter=c("M.1/week",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",dates.ranges.F1,rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.stdev),2)[1])/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),1),
                                             Timing.F2=c("","",dates.ranges.F2,"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                   if(x$Data$Properties$Units["Time Step"]=="day")
                     {
                      partable <- data.frame(Parameter=c("M.1/day",
                                                         paste("N0.",x$Data$Properties$Units["NumbersMultiplier"],sep=""),
                                                         paste("Rec.",x$Data$Properties$Units["NumbersMultiplier"],".Wave",1:waves.F2,sep=""),
                                                         paste("k.1/",x$Data$Properties$Fleets$Units[1],sep=""),
                                                         "alpha","beta",
                                                         paste("psi.",x$Data$Properties$Units["NumbersMultiplier"],".squared",sep="")),
                                             Timing.F1=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[2:(waves.F1+1)]),rep("",4+waves.F2-waves.F1)),
                                             Estimates.F1=c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),
                                             CVpCent.F1=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.stdev[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.stdev),2)[1])/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,3:(waves.F1+2))]),rep(0,waves.F2-waves.F1),unlist(x$Model[[method]]$bt.par[(waves.F1+3):(waves.F1+5)]),tail(unlist(x$Model[[method]]$bt.par),2)[1]),1),
                                             Timing.F2=c("","",as.character(as.Date(x$Data$Properties$Dates[["StartDate"]])+x$Model[[method]]$Dates[(waves.F1+2):(waves.F1+1+waves.F2)]),"","","",""),
                                             Estimates.F2=c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),
                                             CVpCent.F2=round(100*c(unlist(x$Model[[method]]$bt.stdev[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.stdev),1))/
                                                                  c(unlist(x$Model[[method]]$bt.par[c(1,2,(2+waves.F1+3+1):(2+waves.F1+3+waves.F2+3))]),tail(unlist(x$Model[[method]]$bt.par),1)),1),row.names=NULL)
                     names(partable)[2:4] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[1],sep="")
                     names(partable)[5:7] <- paste(c("Timing.","Estimates.","CVpCent."),x$Data$Properties$Fleets$Fleet[2],sep="")
                     }
                  }
               }
            }
         #End of two fleets
         }
      #End of week/day time step
      }
    return(partable)
   #End of function
   }
#
################################################################################
#                    X HIERARCHICAL ESTIMATION OF SURPLUS PRODUCTION           #
################################################################################
#
############################   A - LENGTH-WEIGHT    ############################
#
.lw               <- function(par,lenw,method)
                       {
                        len   <- lenw[,1]
                        wgt   <- lenw[,2]
                        res <- sum((par[1]*len^par[2]-wgt)^2)
                        return(res)
                       }
#
####################   B - MEAN MONTHLY BODY WEIGHT     ########################
#
mobw.kg <- function(par,lenw,lenm,method,span)
  {
   #cat("\n Body length measurements in lenw and lenm must be in the same units and weight data in lenw must be in kg")
   methods.set <- c("BFGS","CG","Nelder-Mead","SANN")
   if(!method%in%methods.set)
     {stop("Use one of the following methods: 'BFGS','CG','Nelder-Mead','SANN' ")}
   if(length(par)!=2)
     {stop("par must be a length two vector of initial values for the two-parameters power model")}
   if(any(is.na(lenw[,1])))
     {
      lenw <- lenw[-which(is.na(lenw[,1])),]
     }
   if(any(is.na(lenw[,2])))
     {
      lenw <- lenw[-which(is.na(lenw[,2])),]
     }
   if(any(is.na(lenm[,1])))
     {
      lenm <- lenm[-which(is.na(lenm[,1])),]
     }
   if(any(is.na(lenm[,2])))
     {
      lenm <- lenm[-which(is.na(lenm[,2])),]
     }
   lwfit <- optim(par=par,fn=.lw,lenw=lenw,method=method,control=list(maxit=50000))
   predw <- lwfit$par[1]*lenm[,2]^lwfit$par[2]
   mobw  <- data.frame(Month=1:12,
                       Obs.mean.kg=NA,
                       Obs.sd.kg=NA,
                       Smooth.mean.kg=NA,
                       Smooth.sd.kg=NA)
   mobw$Obs.mean.kg[match(aggregate(predw,list(lenm[,1]),mean)$Group.1,mobw$Month)]  <- aggregate(predw,list(lenm[,1]),mean)$x
   mobw$Obs.sd.kg[match(aggregate(predw,list(lenm[,1]),sd)$Group.1,mobw$Month)] <- aggregate(predw,list(lenm[,1]),sd)$x
   mobw$Smooth.mean.kg <- predict(loess(predw~lenm[,1],span=span,control=loess.control(surface="direct")),newdata=1:12)
   mobw$Smooth.sd.kg   <- predict(loess(predw~lenm[,1],span=span,control=loess.control(surface="direct")),newdata=1:12,se=TRUE)$se.fit
   return(mobw)
  }
#
##################    C - CORRELATION TO COVARIANCE       ######################
#
#from MBESS
#
cor2cov <- function(cor.mat, sd, discrepancy = 1e-05)
            {
              if (dim(cor.mat)[1] != dim(cor.mat)[2]) 
                  stop("'cor.mat' should be a square matrix")
              n <- sqrt(length(cor.mat))
              if (n != length(sd)) 
                  stop("The length of 'sd' should be the same as the number of rows of 'cor.mat'")
              if (length(sd[sd > 0]) != n) 
                  stop("The elements in 'sd' shuold all be positive")
              if (isSymmetric(cor.mat)) 
                  IS.symmetric <- TRUE
              else IS.symmetric <- FALSE
              p <- dim(cor.mat)[1]
              q <- p * (p - 1)/2
              if (isTRUE(all.equal(cor.mat[lower.tri(cor.mat)], rep(0, 
                  q))) || isTRUE(all.equal(cor.mat[upper.tri(cor.mat)], 
                  rep(0, q)))) 
                  IS.triangular <- TRUE
              else IS.triangular <- FALSE
              if (!IS.symmetric & !IS.triangular) 
                  stop("The object 'cor.mat' should be either a symmetric or a triangular matrix")
              cov.mat <- diag(sd) %*% cor.mat %*% diag(sd)
              colnames(cov.mat) <- rownames(cov.mat) <- colnames(cor.mat)
              return(cov.mat)
            }
#
M.Hoenig <- function(max.age,time.step)
  {
   time.step.set <- c("day","week","month")
   if(sum(time.step %in% time.step.set) == 0 | sum(time.step %in% time.step.set) > 1)
     {stop("time.step must be either 'day', 'week' or 'month' ")}
   if(!is.numeric(max.age))
     {stop("max.age must be numeric and in years")}
   M.yr       <- exp(1.44-0.982*log(max.age))
   hoenig.cov <- matrix(c(0.123^2,0,0,0.0439^2),2,2)
   M.yr.SE    <-deltamethod(g=list(~exp(x1-x2*log(max.age))),
                            mean=c(1.44,0.982),
                            cov=hoenig.cov,
                            ses=TRUE)
   if(time.step == "day")
     {
      M    <- M.yr/365
      M.SE <- M.yr.SE/365
     }
   else if(time.step == "week")
     {
      M    <- M.yr/53
      M.SE <- M.yr.SE/53
     }
   else if(time.step == "month")
     {
      M <- M.yr/12
      M.SE <- M.yr.SE/12
     }
   M.pred <- data.frame(M,M.SE)
   names(M.pred) <- paste(c("M.pred.","M.pred.SE."),time.step,sep="")
   return(M.pred)
  }
.F.explotrate  <- function(F.explot,M,explot)
  {
   (F.explot/(F.explot+M))*(1-exp(-F.explot-M)) - explot
  }
#
#################    D - STANDARD DEVIATION OF BIOMASS     #####################
#
CatDynBSD <- function(x,method,multi,mbw.sd) #mbw.sd must be given in kg
  {
   #time step month
   if(multi)
     {
      if(class(x)!="catdyn")
        {
         stop("In multi-annual models 'x' must be a single object of class 'catdyn' run at monthly time steps")
        }
      if(x$Data$Properties$Units[3] == "ind")
        {
        stop("This function is used to calculate standard deviation of annual biomass when the catch is recorded in weight")
        }
      if(x$Data$Properties$Units["Time Step"]!="month")
        {
         stop("In multi-annual models 'x' must be a single object of class 'catdyn' run at monthly time steps")
        }
      Thou.scaler <- 1e6*(x$Data$Properties$Units[4]=="bill") +
                     1e3*(x$Data$Properties$Units[4]=="mill") +
                     1e0*(x$Data$Properties$Units[4]=="thou") +
                     1e-1*(x$Data$Properties$Units[4]=="hund")
      PopDyn <- data.frame(M=x$Model[[method]]$bt.par$M,
                           SE.M=x$Model[[method]]$bt.stdev["M"],
                           N0=Thou.scaler*x$Model[[method]]$bt.par$N0,
                           SE.N0=Thou.scaler*x$Model[[method]]$bt.stdev["N0"])
      #Replacing missing standard errors, if any
      if(is.na(PopDyn[2]))
        {
         PopDyn[2] <- PopDyn[1]*mean(unlist(x$Model[[method]]$bt.stdev[which(!is.na(x$Model[[method]]$bt.stdev))])/
                                     unlist(x$Model[[method]]$bt.par[which(!is.na(x$Model[[method]]$bt.stdev))]))
        }
      if(is.na(PopDyn[4]))
        {
         PopDyn[4] <- PopDyn[3]*mean(unlist(x$Model[[method]]$bt.stdev[which(!is.na(x$Model[[method]]$bt.stdev))])/
                                     unlist(x$Model[[method]]$bt.par[which(!is.na(x$Model[[method]]$bt.stdev))]))
        }
      Perts  <- data.frame(Pest=unlist(x$Model[[method]]$bt.par[grep("P",names(x$Model[[method]]$bt.par))])*Thou.scaler,
                           SE.Pest=unlist(x$Model[[method]]$bt.stdev[grep("P.",names(x$Model[[method]]$bt.par))])*Thou.scaler,
                           tsteps=x$Model[[method]]$Dates[grep("ts.P",names(x$Model[[method]]$Dates))])
      #Replacing missing standard errors
      if(any(is.na(Perts$SE.Pest)))
        {
         Perts$SE.Pest[which(is.na(Perts$SE.Pest))] <- Perts$Pest[which(is.na(Perts$SE.Pest))]*mean(Perts$SE.Pest[which(!is.na(Perts$SE.Pest))]/Perts$Pest[which(!is.na(Perts$SE.Pest))])
        }
      #One fleet
      if(length(x$Data$Properties$Fleets$Fleet)==1)
       {
         mt <- x$Model[[method]]$Type
         Timing <- matrix(0,12*mt,1)
         Timing[1:12]    <- ifelse(row(Timing)[1:12] >= Perts$tsteps[1],1,0)
         Timing[13:24]   <- ifelse(row(Timing)[13:24] >= Perts$tsteps[2],1,0)
         Timing[25:36]   <- ifelse(row(Timing)[25:36] >= Perts$tsteps[3],1,0)
         Timing[37:48]   <- ifelse(row(Timing)[37:48] >= Perts$tsteps[4],1,0)
         Timing[49:60]   <- ifelse(row(Timing)[49:60] >= Perts$tsteps[5],1,0)
         Timing[61:72]   <- ifelse(row(Timing)[61:72] >= Perts$tsteps[6],1,0)
         Timing[73:84]   <- ifelse(row(Timing)[73:84] >= Perts$tsteps[7],1,0)
         Timing[85:96]   <- ifelse(row(Timing)[85:96] >= Perts$tsteps[8],1,0)
         Timing[97:108]  <- ifelse(row(Timing)[97:108] >= Perts$tsteps[9],1,0)
         Timing[109:120] <- ifelse(row(Timing)[109:120] >= Perts$tsteps[10],1,0)
         Timing[121:132] <- ifelse(row(Timing)[121:132] >= Perts$tsteps[11],1,0)
         Timing[133:144] <- ifelse(row(Timing)[133:144] >= Perts$tsteps[12],1,0)
         Timing[145:156] <- ifelse(row(Timing)[145:156] >= Perts$tsteps[13],1,0)
         Timing[157:168] <- ifelse(row(Timing)[157:168] >= Perts$tsteps[14],1,0)
         Timing[169:180] <- ifelse(row(Timing)[169:180] >= Perts$tsteps[15],1,0)
         fleet1 <- x$Data$Properties$Fleets[1,1]
         if(mt <= 14)
           {
            stop("This function is intended to be used to calculate the standard deviation of annual biomass \n to fit a biomass dynamic model from the output of a multi-annual generalized depletion model (MAGD) \n with the catch recorded in biomass. At least 15 years of data must have been used in fitting \n the MAGD for its outputs to be used in this manner.")
           }
         Cov.Mat   <- cor2cov(cor.mat=x$Model[[method]]$Cor[c(1:(mt+2)),
                                                            c(1:(mt+2))],
                              sd=c(PopDyn$SE.M,PopDyn$SE.N0,Perts$SE.Pest))
         if(length(mbw.sd) != 12 & length(mbw.sd) != 12*mt)
           {stop("mbw.sd must be a vector of length 12 (monthly mean weight) or 12*number of years (in kg)")}
         yr1 <- as.numeric(format(as.Date(x$Data$Properties$Dates[1]),"%Y"))
         yr2 <- as.numeric(format(as.Date(x$Data$Properties$Dates[2]),"%Y"))
         z   <- CatDynPred(x,method)
         PredStock <- data.frame(Year=sort(rep(yr1:yr2,12)),
                                 Month=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),
                                 TimeStep=1:((yr2-yr1+1)*12),
                                 Mmw.kg=x$Data$Data[[fleet1]]$obsmbw.kg,
                                 SDmw.kg=mbw.sd,
                                 N.thou=z$Model$Results[,10],
                                 N.thou.SE=0,
                                 B.ton=z$Model$Results[,11],
                                 B.ton.SE=0)
         #Year 1
         for(m in 1:12)
          {
           PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                 mean=c(PopDyn$M,PopDyn$N0,Timing[m]*Perts$Pest[1]),
                                                 cov=Cov.Mat[c(1:3),c(1:3)])
           PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                          (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
          }
         #Year 2
         for(m in 13:24)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[12],Timing[m]*Perts$Pest[2]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,4],
                                                               0,PredStock$N.thou.SE[12]^2,0,
                                                               Cov.Mat[4,1],0,Cov.Mat[4,4]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 3
         for(m in 25:36)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[24],Timing[m]*Perts$Pest[3]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,5],
                                                               0,PredStock$N.thou.SE[24]^2,0,
                                                               Cov.Mat[5,1],0,Cov.Mat[5,5]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 4
         for(m in 37:48)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[36],Timing[m]*Perts$Pest[4]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,6],
                                                               0,PredStock$N.thou.SE[36]^2,0,
                                                               Cov.Mat[6,1],0,Cov.Mat[6,6]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 5
         for(m in 49:60)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[48],Timing[m]*Perts$Pest[5]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,7],
                                                               0,PredStock$N.thou.SE[48]^2,0,
                                                               Cov.Mat[7,1],0,Cov.Mat[7,7]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 6
         for(m in 61:72)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[60],Timing[m]*Perts$Pest[6]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,8],
                                                               0,PredStock$N.thou.SE[60]^2,0,
                                                               Cov.Mat[8,1],0,Cov.Mat[8,8]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 7
         for(m in 73:84)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[72],Timing[m]*Perts$Pest[7]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,9],
                                                               0,PredStock$N.thou.SE[72]^2,0,
                                                               Cov.Mat[9,1],0,Cov.Mat[9,9]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 8
         for(m in 85:96)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[84],Timing[m]*Perts$Pest[8]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,10],
                                                               0,PredStock$N.thou.SE[84]^2,0,
                                                               Cov.Mat[10,1],0,Cov.Mat[10,10]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 9
         for(m in 97:108)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[96],Timing[m]*Perts$Pest[9]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,11],
                                                               0,PredStock$N.thou.SE[96]^2,0,
                                                               Cov.Mat[11,1],0,Cov.Mat[11,11]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 10
         for(m in 109:120)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[108],Timing[m]*Perts$Pest[10]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,12],
                                                               0,PredStock$N.thou.SE[108]^2,0,
                                                               Cov.Mat[12,1],0,Cov.Mat[12,12]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 11
         for(m in 121:132)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[120],Timing[m,1]*Perts$Pest[11]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,13],
                                                               0,PredStock$N.thou.SE[120]^2,0,
                                                               Cov.Mat[13,1],0,Cov.Mat[13,13]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 12
         for(m in 133:144)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[132],Timing[m]*Perts$Pest[12]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,14],
                                                               0,PredStock$N.thou.SE[132]^2,0,
                                                               Cov.Mat[14,1],0,Cov.Mat[14,14]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 13
         for(m in 145:156)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[144],Timing[m]*Perts$Pest[13]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,15],
                                                               0,PredStock$N.thou.SE[144]^2,0,
                                                               Cov.Mat[15,1],0,Cov.Mat[15,15]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 14
         for(m in 157:168)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[156],Timing[m]*Perts$Pest[14]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,16],
                                                               0,PredStock$N.thou.SE[156]^2,0,
                                                               Cov.Mat[16,1],0,Cov.Mat[16,16]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 15
         for(m in 169:180)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[168],Timing[m]*Perts$Pest[15]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,17],
                                                               0,PredStock$N.thou.SE[168]^2,0,
                                                               Cov.Mat[17,1],0,Cov.Mat[17,17]),3,3))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 16
         if(mt == 16)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 17)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 18)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 19)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 20)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 21)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252] <- ifelse(row(Timing)[241:252] >= Perts$tsteps[21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m]*Perts$Pest[21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],
                                                                  0,PredStock$N.thou.SE[240]^2,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 22)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252] <- ifelse(row(Timing)[241:252] >= Perts$tsteps[21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m]*Perts$Pest[21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],
                                                                  0,PredStock$N.thou.SE[240]^2,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264] <- ifelse(row(Timing)[253:264] >= Perts$tsteps[22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m]*Perts$Pest[22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],
                                                                  0,PredStock$N.thou.SE[252]^2,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 23)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252] <- ifelse(row(Timing)[241:252] >= Perts$tsteps[21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m]*Perts$Pest[21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],
                                                                  0,PredStock$N.thou.SE[240]^2,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264] <- ifelse(row(Timing)[253:264] >= Perts$tsteps[22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m]*Perts$Pest[22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],
                                                                  0,PredStock$N.thou.SE[252]^2,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276] <- ifelse(row(Timing)[265:276] >= Perts$tsteps[23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m]*Perts$Pest[23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],
                                                                  0,PredStock$N.thou.SE[264]^2,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 24)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252] <- ifelse(row(Timing)[241:252] >= Perts$tsteps[21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m]*Perts$Pest[21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],
                                                                  0,PredStock$N.thou.SE[240]^2,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264] <- ifelse(row(Timing)[253:264] >= Perts$tsteps[22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m]*Perts$Pest[22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],
                                                                  0,PredStock$N.thou.SE[252]^2,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276] <- ifelse(row(Timing)[265:276] >= Perts$tsteps[23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m]*Perts$Pest[23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],
                                                                  0,PredStock$N.thou.SE[264]^2,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[277:288] <- ifelse(row(Timing)[277:288] >= Perts$tsteps[24],1,0)
            for(m in 277:288)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[276],Timing[m]*Perts$Pest[24]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,26],
                                                                  0,PredStock$N.thou.SE[276]^2,0,
                                                                  Cov.Mat[26,1],0,Cov.Mat[26,26]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 25)
           {
            Timing[181:192] <- ifelse(row(Timing)[181:192] >= Perts$tsteps[16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m]*Perts$Pest[16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],
                                                                  0,PredStock$N.thou.SE[180]^2,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204] <- ifelse(row(Timing)[193:204] >= Perts$tsteps[17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m]*Perts$Pest[17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],
                                                                  0,PredStock$N.thou.SE[192]^2,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216] <- ifelse(row(Timing)[205:216] >= Perts$tsteps[18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m]*Perts$Pest[18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],
                                                                  0,PredStock$N.thou.SE[204]^2,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228] <- ifelse(row(Timing)[217:228] >= Perts$tsteps[19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m]*Perts$Pest[19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],
                                                                  0,PredStock$N.thou.SE[216]^2,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240] <- ifelse(row(Timing)[229:240] >= Perts$tsteps[20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m]*Perts$Pest[20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],
                                                                  0,PredStock$N.thou.SE[228]^2,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252] <- ifelse(row(Timing)[241:252] >= Perts$tsteps[21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m]*Perts$Pest[21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],
                                                                  0,PredStock$N.thou.SE[240]^2,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264] <- ifelse(row(Timing)[253:264] >= Perts$tsteps[22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m]*Perts$Pest[22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],
                                                                  0,PredStock$N.thou.SE[252]^2,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276] <- ifelse(row(Timing)[265:276] >= Perts$tsteps[23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m]*Perts$Pest[23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],
                                                                  0,PredStock$N.thou.SE[264]^2,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[277:288] <- ifelse(row(Timing)[277:288] >= Perts$tsteps[24],1,0)
            for(m in 277:288)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[276],Timing[m]*Perts$Pest[24]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,26],
                                                                  0,PredStock$N.thou.SE[276]^2,0,
                                                                  Cov.Mat[26,1],0,Cov.Mat[26,26]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[289:300] <- ifelse(row(Timing)[289:300] >= Perts$tsteps[25],1,0)
            for(m in 289:300)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[288],Timing[m]*Perts$Pest[25]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,27],
                                                                  0,PredStock$N.thou.SE[288]^2,0,
                                                                  Cov.Mat[27,1],0,Cov.Mat[27,27]),3,3))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
       #End of one fleet
       }
      if(length(x$Data$Properties$Fleets$Fleet)==2)
       {
         mt <- x$Model[[method]]$Type[1]
         Timing <- matrix(0,12*mt,2)
         Timing[1:12,1]    <- ifelse(row(Timing)[1:12,1] >= Perts$tsteps[1],1,0)
         Timing[1:12,2]    <- ifelse(row(Timing)[1:12,2] >= Perts$tsteps[mt+1],1,0)
         Timing[13:24,1]   <- ifelse(row(Timing)[13:24,1] >= Perts$tsteps[2],1,0)
         Timing[13:24,2]   <- ifelse(row(Timing)[13:24,2] >= Perts$tsteps[mt+2],1,0)
         Timing[25:36,1]   <- ifelse(row(Timing)[25:36,1] >= Perts$tsteps[3],1,0)
         Timing[25:36,2]   <- ifelse(row(Timing)[25:36,2] >= Perts$tsteps[mt+3],1,0)
         Timing[37:48,1]   <- ifelse(row(Timing)[37:48,1] >= Perts$tsteps[4],1,0)
         Timing[37:48,2]   <- ifelse(row(Timing)[37:48,2] >= Perts$tsteps[mt+4],1,0)
         Timing[49:60,1]   <- ifelse(row(Timing)[49:60,1] >= Perts$tsteps[5],1,0)
         Timing[49:60,2]   <- ifelse(row(Timing)[49:60,2] >= Perts$tsteps[mt+5],1,0)
         Timing[61:72,1]   <- ifelse(row(Timing)[61:72,1] >= Perts$tsteps[6],1,0)
         Timing[61:72,2]   <- ifelse(row(Timing)[61:72,2] >= Perts$tsteps[mt+6],1,0)
         Timing[73:84,1]   <- ifelse(row(Timing)[73:84,1] >= Perts$tsteps[7],1,0)
         Timing[73:84,2]   <- ifelse(row(Timing)[73:84,2] >= Perts$tsteps[mt+7],1,0)
         Timing[85:96,1]   <- ifelse(row(Timing)[85:96,1] >= Perts$tsteps[8],1,0)
         Timing[85:96,2]   <- ifelse(row(Timing)[85:96,2] >= Perts$tsteps[mt+8],1,0)
         Timing[97:108,1]  <- ifelse(row(Timing)[97:108,1] >= Perts$tsteps[9],1,0)
         Timing[97:108,2]  <- ifelse(row(Timing)[97:108,2] >= Perts$tsteps[mt+9],1,0)
         Timing[109:120,1] <- ifelse(row(Timing)[109:120,1] >= Perts$tsteps[10],1,0)
         Timing[109:120,2] <- ifelse(row(Timing)[109:120,2] >= Perts$tsteps[mt+10],1,0)
         Timing[121:132,1] <- ifelse(row(Timing)[121:132,1] >= Perts$tsteps[11],1,0)
         Timing[121:132,2] <- ifelse(row(Timing)[121:132,2] >= Perts$tsteps[mt+11],1,0)
         Timing[133:144,1] <- ifelse(row(Timing)[133:144,1] >= Perts$tsteps[12],1,0)
         Timing[133:144,2] <- ifelse(row(Timing)[133:144,2] >= Perts$tsteps[mt+12],1,0)
         Timing[145:156,1] <- ifelse(row(Timing)[145:156,1] >= Perts$tsteps[13],1,0)
         Timing[145:156,2] <- ifelse(row(Timing)[145:156,2] >= Perts$tsteps[mt+13],1,0)
         Timing[157:168,1] <- ifelse(row(Timing)[157:168,1] >= Perts$tsteps[14],1,0)
         Timing[157:168,2] <- ifelse(row(Timing)[157:168,2] >= Perts$tsteps[mt+14],1,0)
         Timing[169:180,1] <- ifelse(row(Timing)[169:180,1] >= Perts$tsteps[15],1,0)
         Timing[169:180,2] <- ifelse(row(Timing)[169:180,2] >= Perts$tsteps[mt+15],1,0)
         fleet1 <- x$Data$Properties$Fleets[1,1]
         fleet2 <- x$Data$Properties$Fleets[2,1]
         if(mt <= 14)
           {
            stop("This function is intended to be used to calculate the standard deviation of annual biomass \n to fit a biomass dynamic model from the output of a multi-annual generalized depletion model (MAGD) \n with the catch recorded in biomass. At least 15 years of data must have been used in fitting \n the MAGD for its outputs to be used in this manner.")
           }
         Cov.Mat   <- cor2cov(cor.mat=x$Model[[method]]$Cor[c(1:(mt+2),(mt+6):(2*(mt)+5)),
                                                            c(1:(mt+2),(mt+6):(2*(mt)+5))],
                              sd=c(PopDyn$SE.M,PopDyn$SE.N0,Perts$SE.Pest))
         if(length(mbw.sd) != 12 & length(mbw.sd) != 12*mt)
           {stop("mbw.sd must be a vector of length 12 (monthly mean weight) or 12*number of years, all in kg")}
         yr1 <- as.numeric(format(as.Date(x$Data$Properties$Dates[1]),"%Y"))
         yr2 <- as.numeric(format(as.Date(x$Data$Properties$Dates[2]),"%Y"))
         z   <- CatDynPred(x,method)
         PredStock <- data.frame(Year=sort(rep(yr1:yr2,12)),
                                 Month=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),
                                 TimeStep=1:((yr2-yr1+1)*12),
                                 Mmw.kg=(x$Data$Data[[fleet1]]$obsmbw.kg+x$Data$Data[[fleet2]]$obsmbw.kg)/2,
                                 SDmw.kg=mbw.sd,
                                 N.thou=z$Model$Results[,18],
                                 N.thou.SE=0,
                                 B.ton=z$Model$Results[,19],
                                 B.ton.SE=0)
         #Year 1
         for(m in 1:12)
          {
           PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                 mean=c(PopDyn$M,PopDyn$N0,Timing[m,1]*Perts$Pest[1],Timing[m,2]*Perts$Pest[mt+1]),
                                                 cov=Cov.Mat[c(1:3,23),c(1:3,23)])
           PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                          (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
          }
         #Year 2
         for(m in 13:24)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[12],Timing[m,1]*Perts$Pest[2],Timing[m,2]*Perts$Pest[mt+2]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,4],Cov.Mat[1,24],
                                                               0,PredStock$N.thou.SE[12]^2,0,0,
                                                               Cov.Mat[4,1],0,Cov.Mat[4,4],Cov.Mat[4,24],
                                                               Cov.Mat[24,1],0,Cov.Mat[24,4],Cov.Mat[24,24]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 3
         for(m in 25:36)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[24],Timing[m,1]*Perts$Pest[3],Timing[m,2]*Perts$Pest[mt+3]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,5],Cov.Mat[1,25],
                                                               0,PredStock$N.thou.SE[24]^2,0,0,
                                                               Cov.Mat[5,1],0,Cov.Mat[5,5],Cov.Mat[5,25],
                                                               Cov.Mat[25,1],0,Cov.Mat[25,5],Cov.Mat[25,25]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 4
         for(m in 37:48)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[36],Timing[m,1]*Perts$Pest[4],Timing[m,2]*Perts$Pest[mt+4]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,6],Cov.Mat[1,26],
                                                               0,PredStock$N.thou.SE[36]^2,0,0,
                                                               Cov.Mat[6,1],0,Cov.Mat[6,6],Cov.Mat[6,26],
                                                               Cov.Mat[26,1],0,Cov.Mat[26,6],Cov.Mat[26,26]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 5
         for(m in 49:60)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[48],Timing[m,1]*Perts$Pest[5],Timing[m,2]*Perts$Pest[mt+5]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,7],Cov.Mat[1,27],
                                                               0,PredStock$N.thou.SE[48]^2,0,0,
                                                               Cov.Mat[7,1],0,Cov.Mat[7,7],Cov.Mat[7,27],
                                                               Cov.Mat[27,1],0,Cov.Mat[27,7],Cov.Mat[27,27]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 6
         for(m in 61:72)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[60],Timing[m,1]*Perts$Pest[6],Timing[m,2]*Perts$Pest[mt+6]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,8],Cov.Mat[1,28],
                                                               0,PredStock$N.thou.SE[60]^2,0,0,
                                                               Cov.Mat[8,1],0,Cov.Mat[8,8],Cov.Mat[8,28],
                                                               Cov.Mat[28,1],0,Cov.Mat[28,8],Cov.Mat[28,28]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 7
         for(m in 73:84)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[72],Timing[m,1]*Perts$Pest[7],Timing[m,2]*Perts$Pest[mt+7]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,9],Cov.Mat[1,29],
                                                               0,PredStock$N.thou.SE[72]^2,0,0,
                                                               Cov.Mat[9,1],0,Cov.Mat[9,9],Cov.Mat[9,29],
                                                               Cov.Mat[29,1],0,Cov.Mat[29,9],Cov.Mat[29,29]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 8
         for(m in 85:96)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[84],Timing[m,1]*Perts$Pest[8],Timing[m,2]*Perts$Pest[mt+8]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,10],Cov.Mat[1,30],
                                                               0,PredStock$N.thou.SE[84]^2,0,0,
                                                               Cov.Mat[10,1],0,Cov.Mat[10,10],Cov.Mat[10,30],
                                                               Cov.Mat[30,1],0,Cov.Mat[30,10],Cov.Mat[30,30]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 9
         for(m in 97:108)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[96],Timing[m,1]*Perts$Pest[9],Timing[m,2]*Perts$Pest[mt+9]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,11],Cov.Mat[1,31],
                                                               0,PredStock$N.thou.SE[96]^2,0,0,
                                                               Cov.Mat[11,1],0,Cov.Mat[11,11],Cov.Mat[11,31],
                                                               Cov.Mat[31,1],0,Cov.Mat[31,11],Cov.Mat[31,31]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 10
         for(m in 109:120)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[108],Timing[m,1]*Perts$Pest[10],Timing[m,2]*Perts$Pest[mt+10]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,12],Cov.Mat[1,32],
                                                               0,PredStock$N.thou.SE[108]^2,0,0,
                                                               Cov.Mat[12,1],0,Cov.Mat[12,12],Cov.Mat[12,32],
                                                               Cov.Mat[32,1],0,Cov.Mat[32,12],Cov.Mat[32,32]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 11
         for(m in 121:132)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[120],Timing[m,1]*Perts$Pest[11],Timing[m,2]*Perts$Pest[mt+11]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,13],Cov.Mat[1,33],
                                                               0,PredStock$N.thou.SE[120]^2,0,0,
                                                               Cov.Mat[13,1],0,Cov.Mat[13,13],Cov.Mat[13,33],
                                                               Cov.Mat[33,1],0,Cov.Mat[33,13],Cov.Mat[33,33]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 12
         for(m in 133:144)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[132],Timing[m,1]*Perts$Pest[12],Timing[m,2]*Perts$Pest[mt+12]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,14],Cov.Mat[1,34],
                                                               0,PredStock$N.thou.SE[132]^2,0,0,
                                                               Cov.Mat[14,1],0,Cov.Mat[14,14],Cov.Mat[14,34],
                                                               Cov.Mat[34,1],0,Cov.Mat[34,14],Cov.Mat[34,34]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 13
         for(m in 145:156)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[144],Timing[m,1]*Perts$Pest[13],Timing[m,2]*Perts$Pest[mt+13]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,15],Cov.Mat[1,35],
                                                               0,PredStock$N.thou.SE[144]^2,0,0,
                                                               Cov.Mat[15,1],0,Cov.Mat[15,15],Cov.Mat[15,35],
                                                               Cov.Mat[35,1],0,Cov.Mat[35,15],Cov.Mat[35,35]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 14
         for(m in 157:168)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[156],Timing[m,1]*Perts$Pest[14],Timing[m,2]*Perts$Pest[mt+14]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,16],Cov.Mat[1,36],
                                                               0,PredStock$N.thou.SE[156]^2,0,0,
                                                               Cov.Mat[16,1],0,Cov.Mat[16,16],Cov.Mat[16,36],
                                                               Cov.Mat[36,1],0,Cov.Mat[36,16],Cov.Mat[36,36]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 15
         for(m in 169:180)
           {
            PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                  mean=c(PopDyn$M,PredStock$N.thou[168],Timing[m,1]*Perts$Pest[15],Timing[m,2]*Perts$Pest[mt+15]),
                                                  cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,17],Cov.Mat[1,37],
                                                               0,PredStock$N.thou.SE[168]^2,0,0,
                                                               Cov.Mat[17,1],0,Cov.Mat[17,17],Cov.Mat[17,37],
                                                               Cov.Mat[37,1],0,Cov.Mat[37,17],Cov.Mat[37,37]),4,4))
            PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                           (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
           }
         #Year 16
         if(mt == 16)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 17)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 18)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 19)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 20)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 21)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252,1] <- ifelse(row(Timing)[241:252,1] >= Perts$tsteps[21],1,0)
            Timing[241:252,2] <- ifelse(row(Timing)[241:252,2] >= Perts$tsteps[mt+21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m,1]*Perts$Pest[21],Timing[m,2]*Perts$Pest[mt+21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],Cov.Mat[1,43],
                                                                  0,PredStock$N.thou.SE[240]^2,0,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23],Cov.Mat[23,43],
                                                                  Cov.Mat[43,1],0,Cov.Mat[43,23],Cov.Mat[43,43]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 22)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252,1] <- ifelse(row(Timing)[241:252,1] >= Perts$tsteps[21],1,0)
            Timing[241:252,2] <- ifelse(row(Timing)[241:252,2] >= Perts$tsteps[mt+21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m,1]*Perts$Pest[21],Timing[m,2]*Perts$Pest[mt+21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],Cov.Mat[1,43],
                                                                  0,PredStock$N.thou.SE[240]^2,0,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23],Cov.Mat[23,43],
                                                                  Cov.Mat[43,1],0,Cov.Mat[43,23],Cov.Mat[43,43]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264,1] <- ifelse(row(Timing)[253:264,1] >= Perts$tsteps[22],1,0)
            Timing[253:264,2] <- ifelse(row(Timing)[253:264,2] >= Perts$tsteps[mt+22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m,1]*Perts$Pest[22],Timing[m,2]*Perts$Pest[mt+22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],Cov.Mat[1,44],
                                                                  0,PredStock$N.thou.SE[252]^2,0,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24],Cov.Mat[24,44],
                                                                  Cov.Mat[44,1],0,Cov.Mat[44,24],Cov.Mat[44,44]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 23)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252,1] <- ifelse(row(Timing)[241:252,1] >= Perts$tsteps[21],1,0)
            Timing[241:252,2] <- ifelse(row(Timing)[241:252,2] >= Perts$tsteps[mt+21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m,1]*Perts$Pest[21],Timing[m,2]*Perts$Pest[mt+21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],Cov.Mat[1,43],
                                                                  0,PredStock$N.thou.SE[240]^2,0,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23],Cov.Mat[23,43],
                                                                  Cov.Mat[43,1],0,Cov.Mat[43,23],Cov.Mat[43,43]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264,1] <- ifelse(row(Timing)[253:264,1] >= Perts$tsteps[22],1,0)
            Timing[253:264,2] <- ifelse(row(Timing)[253:264,2] >= Perts$tsteps[mt+22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m,1]*Perts$Pest[22],Timing[m,2]*Perts$Pest[mt+22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],Cov.Mat[1,44],
                                                                  0,PredStock$N.thou.SE[252]^2,0,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24],Cov.Mat[24,44],
                                                                  Cov.Mat[44,1],0,Cov.Mat[44,24],Cov.Mat[44,44]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276,1] <- ifelse(row(Timing)[265:276,1] >= Perts$tsteps[23],1,0)
            Timing[265:276,2] <- ifelse(row(Timing)[265:276,2] >= Perts$tsteps[mt+23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m,1]*Perts$Pest[23],Timing[m,2]*Perts$Pest[mt+23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],Cov.Mat[1,45],
                                                                  0,PredStock$N.thou.SE[264]^2,0,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25],Cov.Mat[25,45],
                                                                  Cov.Mat[45,1],0,Cov.Mat[45,25],Cov.Mat[45,45]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 24)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252,1] <- ifelse(row(Timing)[241:252,1] >= Perts$tsteps[21],1,0)
            Timing[241:252,2] <- ifelse(row(Timing)[241:252,2] >= Perts$tsteps[mt+21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m,1]*Perts$Pest[21],Timing[m,2]*Perts$Pest[mt+21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],Cov.Mat[1,43],
                                                                  0,PredStock$N.thou.SE[240]^2,0,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23],Cov.Mat[23,43],
                                                                  Cov.Mat[43,1],0,Cov.Mat[43,23],Cov.Mat[43,43]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264,1] <- ifelse(row(Timing)[253:264,1] >= Perts$tsteps[22],1,0)
            Timing[253:264,2] <- ifelse(row(Timing)[253:264,2] >= Perts$tsteps[mt+22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m,1]*Perts$Pest[22],Timing[m,2]*Perts$Pest[mt+22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],Cov.Mat[1,44],
                                                                  0,PredStock$N.thou.SE[252]^2,0,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24],Cov.Mat[24,44],
                                                                  Cov.Mat[44,1],0,Cov.Mat[44,24],Cov.Mat[44,44]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276,1] <- ifelse(row(Timing)[265:276,1] >= Perts$tsteps[23],1,0)
            Timing[265:276,2] <- ifelse(row(Timing)[265:276,2] >= Perts$tsteps[mt+23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m,1]*Perts$Pest[23],Timing[m,2]*Perts$Pest[mt+23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],Cov.Mat[1,45],
                                                                  0,PredStock$N.thou.SE[264]^2,0,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25],Cov.Mat[25,45],
                                                                  Cov.Mat[45,1],0,Cov.Mat[45,25],Cov.Mat[45,45]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[277:288,1] <- ifelse(row(Timing)[277:288,1] >= Perts$tsteps[24],1,0)
            Timing[277:288,2] <- ifelse(row(Timing)[277:288,2] >= Perts$tsteps[mt+24],1,0)
            for(m in 277:288)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[276],Timing[m,1]*Perts$Pest[24],Timing[m,2]*Perts$Pest[mt+24]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,26],Cov.Mat[1,46],
                                                                  0,PredStock$N.thou.SE[276]^2,0,0,
                                                                  Cov.Mat[26,1],0,Cov.Mat[26,26],Cov.Mat[26,46],
                                                                  Cov.Mat[46,1],0,Cov.Mat[46,26],Cov.Mat[46,46]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
         if(mt == 25)
           {
            Timing[181:192,1] <- ifelse(row(Timing)[181:192,1] >= Perts$tsteps[16],1,0)
            Timing[181:192,2] <- ifelse(row(Timing)[181:192,2] >= Perts$tsteps[mt+16],1,0)
            for(m in 181:192)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[180],Timing[m,1]*Perts$Pest[16],Timing[m,2]*Perts$Pest[mt+16]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,18],Cov.Mat[1,38],
                                                                  0,PredStock$N.thou.SE[180]^2,0,0,
                                                                  Cov.Mat[18,1],0,Cov.Mat[18,18],Cov.Mat[18,38],
                                                                  Cov.Mat[38,1],0,Cov.Mat[38,18],Cov.Mat[38,38]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[193:204,1] <- ifelse(row(Timing)[193:204,1] >= Perts$tsteps[17],1,0)
            Timing[193:204,2] <- ifelse(row(Timing)[193:204,2] >= Perts$tsteps[mt+17],1,0)
            for(m in 193:204)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[192],Timing[m,1]*Perts$Pest[17],Timing[m,2]*Perts$Pest[mt+17]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,19],Cov.Mat[1,39],
                                                                  0,PredStock$N.thou.SE[192]^2,0,0,
                                                                  Cov.Mat[19,1],0,Cov.Mat[19,19],Cov.Mat[19,39],
                                                                  Cov.Mat[39,1],0,Cov.Mat[39,19],Cov.Mat[39,39]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[205:216,1] <- ifelse(row(Timing)[205:216,1] >= Perts$tsteps[18],1,0)
            Timing[205:216,2] <- ifelse(row(Timing)[205:216,2] >= Perts$tsteps[mt+18],1,0)
            for(m in 205:216)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[204],Timing[m,1]*Perts$Pest[18],Timing[m,2]*Perts$Pest[mt+18]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,20],Cov.Mat[1,40],
                                                                  0,PredStock$N.thou.SE[204]^2,0,0,
                                                                  Cov.Mat[20,1],0,Cov.Mat[20,20],Cov.Mat[20,40],
                                                                  Cov.Mat[40,1],0,Cov.Mat[40,20],Cov.Mat[40,40]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[217:228,1] <- ifelse(row(Timing)[217:228,1] >= Perts$tsteps[19],1,0)
            Timing[217:228,2] <- ifelse(row(Timing)[217:228,2] >= Perts$tsteps[mt+19],1,0)
            for(m in 217:228)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[216],Timing[m,1]*Perts$Pest[19],Timing[m,2]*Perts$Pest[mt+19]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,21],Cov.Mat[1,41],
                                                                  0,PredStock$N.thou.SE[216]^2,0,0,
                                                                  Cov.Mat[21,1],0,Cov.Mat[21,21],Cov.Mat[21,41],
                                                                  Cov.Mat[41,1],0,Cov.Mat[41,21],Cov.Mat[41,41]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[229:240,1] <- ifelse(row(Timing)[229:240,1] >= Perts$tsteps[20],1,0)
            Timing[229:240,2] <- ifelse(row(Timing)[229:240,2] >= Perts$tsteps[mt+20],1,0)
            for(m in 229:240)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[228],Timing[m,1]*Perts$Pest[20],Timing[m,2]*Perts$Pest[mt+20]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,22],Cov.Mat[1,42],
                                                                  0,PredStock$N.thou.SE[228]^2,0,0,
                                                                  Cov.Mat[22,1],0,Cov.Mat[22,22],Cov.Mat[22,42],
                                                                  Cov.Mat[42,1],0,Cov.Mat[42,22],Cov.Mat[42,42]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[241:252,1] <- ifelse(row(Timing)[241:252,1] >= Perts$tsteps[21],1,0)
            Timing[241:252,2] <- ifelse(row(Timing)[241:252,2] >= Perts$tsteps[mt+21],1,0)
            for(m in 241:252)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[240],Timing[m,1]*Perts$Pest[21],Timing[m,2]*Perts$Pest[mt+21]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,23],Cov.Mat[1,43],
                                                                  0,PredStock$N.thou.SE[240]^2,0,0,
                                                                  Cov.Mat[23,1],0,Cov.Mat[23,23],Cov.Mat[23,43],
                                                                  Cov.Mat[43,1],0,Cov.Mat[43,23],Cov.Mat[43,43]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[253:264,1] <- ifelse(row(Timing)[253:264,1] >= Perts$tsteps[22],1,0)
            Timing[253:264,2] <- ifelse(row(Timing)[253:264,2] >= Perts$tsteps[mt+22],1,0)
            for(m in 253:264)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[252],Timing[m,1]*Perts$Pest[22],Timing[m,2]*Perts$Pest[mt+22]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,24],Cov.Mat[1,44],
                                                                  0,PredStock$N.thou.SE[252]^2,0,0,
                                                                  Cov.Mat[24,1],0,Cov.Mat[24,24],Cov.Mat[24,44],
                                                                  Cov.Mat[44,1],0,Cov.Mat[44,24],Cov.Mat[44,44]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[265:276,1] <- ifelse(row(Timing)[265:276,1] >= Perts$tsteps[23],1,0)
            Timing[265:276,2] <- ifelse(row(Timing)[265:276,2] >= Perts$tsteps[mt+23],1,0)
            for(m in 265:276)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[264],Timing[m,1]*Perts$Pest[23],Timing[m,2]*Perts$Pest[mt+23]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,25],Cov.Mat[1,45],
                                                                  0,PredStock$N.thou.SE[264]^2,0,0,
                                                                  Cov.Mat[25,1],0,Cov.Mat[25,25],Cov.Mat[25,45],
                                                                  Cov.Mat[45,1],0,Cov.Mat[45,25],Cov.Mat[45,45]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[277:288,1] <- ifelse(row(Timing)[277:288,1] >= Perts$tsteps[24],1,0)
            Timing[277:288,2] <- ifelse(row(Timing)[277:288,2] >= Perts$tsteps[mt+24],1,0)
            for(m in 277:288)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[276],Timing[m,1]*Perts$Pest[24],Timing[m,2]*Perts$Pest[mt+24]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,26],Cov.Mat[1,46],
                                                                  0,PredStock$N.thou.SE[276]^2,0,0,
                                                                  Cov.Mat[26,1],0,Cov.Mat[26,26],Cov.Mat[26,46],
                                                                  Cov.Mat[46,1],0,Cov.Mat[46,26],Cov.Mat[46,46]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
            Timing[289:300,1] <- ifelse(row(Timing)[289:300,1] >= Perts$tsteps[25],1,0)
            Timing[289:300,2] <- ifelse(row(Timing)[289:300,2] >= Perts$tsteps[mt+25],1,0)
            for(m in 289:300)
              {
               PredStock$N.thou.SE[m] <- deltamethod(g=list(~x2*exp(-x1)+x3*exp(-x1)+x4*exp(-x1)),
                                                     mean=c(PopDyn$M,PredStock$N.thou[288],Timing[m,1]*Perts$Pest[25],Timing[m,2]*Perts$Pest[mt+25]),
                                                     cov=matrix(c(Cov.Mat[1,1],0,Cov.Mat[1,27],Cov.Mat[1,47],
                                                                  0,PredStock$N.thou.SE[288]^2,0,0,
                                                                  Cov.Mat[27,1],0,Cov.Mat[27,27],Cov.Mat[27,47],
                                                                  Cov.Mat[47,1],0,Cov.Mat[47,27],Cov.Mat[47,47]),4,4))
               PredStock$B.ton.SE[m]  <- sqrt((1e3*PredStock$N.thou.SE[m])^2*(PredStock$Mmw.kg[m]*1e-3)^2 +
                                              (1e3*PredStock$N.thou[m])^2*(PredStock$SDmw.kg[m]*1e-3)^2)
              }
           }
       #End of two fleets
       }
    #End of month
    }
  #time step day or week
  if(!multi)
    {
     if(length(unique(sapply(1:length(x), function(u) length(x[[u]]$Data$Properties$Fleets$Fleet)))) > 1)
       {stop("All catdyn objects in the list 'x' must be either 1-fleet or 2-fleets, not some 1-fleet and some 2-fleets")}
     #One fleet
     if(length(unique(as.vector(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet)))) == 1)
       {
        if(length(unique(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet))) > 1)
          {stop("All catdyn objects in the list 'x' must have the same name of fleet")}
        if(class(x) != "list" | length(x) < 15)
          {stop("For intra-annual models (time step is daily or weekly) x must be a list of objects of class 'catdyn' \n from succesful fit of models using CatDynFit, and the number of objects in the list (intra-annual fits) must be 15 consecutive years or more")}
        ny <- length(x)
        if(sum(dim(mbw.sd) != c(ny,3)) != 0)
          {stop(" 'mbw.sd' must be a data.frame with as many rows as the length of 'x' and three columns: \n year, mean weight, and standard deviation of mean weight")}
        if(length(method) != ny)
          {stop("One numerical method must be supplied for each catdyn object in 'x' ")}
        if(any(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)>5))
          {stop("The maximum number of perturbations in any of the elements of 'x' must not be higher than 5")}
        PredStock <- data.frame(Year=as.numeric(format(as.Date(x[[1]]$Data$Properties$Dates[1]),"%Y")):as.numeric(format(as.Date(x[[ny]]$Data$Properties$Dates[1]),"%Y")),
                                Mw.kg=mbw.sd[,2],
                                SDmw.kg=mbw.sd[,3],
                                N0Tot.thou=0,
                                N0Tot.thou.SE=0,
                                B0Tot.ton=0,
                                B0Tot.ton.SE=0)
        for(i in 1:ny)
          {
           #Replacing missing standard errors
           if(any(is.na(x[[i]]$Model[[method[i]]]$bt.stdev)))
             {
              x[[i]]$Model[[method[i]]]$bt.stdev[which(is.na(x[[i]]$Model[[method[i]]]$bt.stdev))] <-
              x[[i]]$Model[[method[i]]]$bt.par[which(is.na(x[[i]]$Model[[method[i]]]$bt.stdev))]*
              mean(unlist(x[[i]]$Model[[method[i]]]$bt.stdev[which(!is.na(x[[i]]$Model[[method[i]]]$bt.stdev))])/
              unlist(x[[i]]$Model[[method[i]]]$bt.par[which(!is.na(x[[i]]$Model[[method[i]]]$bt.stdev))]))
             }
           mt             <- x[[i]]$Model[[method[i]]]$Type
           Thou.scaler    <- 1e6*(x[[i]]$Data$Properties$Units[4]=="bill") +
                             1e3*(x[[i]]$Data$Properties$Units[4]=="mill") +
                             1e0*(x[[i]]$Data$Properties$Units[4]=="thou") +
                             1e-1*(x[[i]]$Data$Properties$Units[4]=="hund")
           M     <- unlist(x[[i]]$Model[[method[i]]]$bt.par["M"])
           SE.M  <- unlist(x[[i]]$Model[[method[i]]]$bt.stdev["M"])
           N0    <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par["N0"])
           SE.N0 <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev["N0"])
           if(mt == 0)
             {
              PredStock$N0Tot.thou[i]    <- N0
              PredStock$N0Tor.thou.SE[i] <- SE.N0
              PredStock$B0Tot.ton[i]     <- N0*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]  <- sqrt((SE.N0)^2*(mbw.sd[i,2])^2+(N0)^2*(mbw.sd[i,3])^2)
             }
           if(mt == 1)
             {
              P1                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[1:3,1:3],sd=c(SE.M,SE.N0,P1.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1*exp(M*P1.back)
              form                        <- sprintf("~x2 + x3*exp(x1*%i)",
                                                     P1.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
              }
           if(mt == 2)
             {
              P1                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2.back                     <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[1:4,1:4],sd=c(SE.M,SE.N0,P1.SE,P2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1*exp(M*P1.back) +
                                                  P2*exp(M*P2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)",
                                                     P1.back,P2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1,P2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(mt == 3)
             {
              P1                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2.back                     <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3.back                     <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[1:5,1:5],sd=c(SE.M,SE.N0,P1.SE,P2.SE,P3.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1*exp(M*P1.back) +
                                                  P2*exp(M*P2.back) +
                                                  P3*exp(M*P3.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)",
                                                     P1.back,P2.back,P3.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1,P2,P3),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(mt == 4)
             {
              P1                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2.back                     <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3.back                     <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P4.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P4.back                     <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[1:6,1:6],sd=c(SE.M,SE.N0,P1.SE,P2.SE,P3.SE,P4.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1*exp(M*P1.back) +
                                                  P2*exp(M*P2.back) +
                                                  P3*exp(M*P3.back) +
                                                  P4*exp(M*P4.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)",
                                                     P1.back,P2.back,P3.back,P4.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1,P2,P3,P4),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(mt == 5)
             {
              P1                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2.back                     <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3.back                     <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P4.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P4.back                     <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P5                          <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P5.SE                       <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P5.back                     <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[1:7,1:7],sd=c(SE.M,SE.N0,P1.SE,P2.SE,P3.SE,P4.SE,P5.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1*exp(M*P1.back) +
                                                  P2*exp(M*P2.back) +
                                                  P3*exp(M*P3.back) +
                                                  P4*exp(M*P4.back) +
                                                  P5*exp(M*P5.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)",
                                                     P1.back,P2.back,P3.back,P4.back,P5.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1,P2,P3,P4,P5),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
          }
      #End of one fleet
      }
    #Two fleets
    if(length(unique(as.vector(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet)))) == 2)
      {
        if(length(unique(as.vector(sapply(1:length(x), function(u) x[[u]]$Data$Properties$Fleets$Fleet)))) != 2)
          {stop("All catdyn objects in the list 'x' must have the same two fleets")}
        if(class(x) != "list" | length(x) < 15)
          {stop("For intra-annual models (time step is daily or weekly) x must be a list of objects of class 'catdyn' \n from succesful fit of models using CatDynFit, and the number of objects in the list (intra-annual fits) must be 15 consecutive years or more")}
        ny <- length(x)
        if(sum(dim(mbw.sd) != c(ny,3)) != 0)
          {stop(" 'mbw.sd' must be a data.frame with as many rows as the length of 'x' and three columns: \n year, mean weight, and standard deviation of mean length ")}
        if(length(method) != ny)
          {stop("One numerical method must be supplied for each catdyn object in 'x' ")}
        if(max(as.vector(sapply(1:length(x), function(u) x[[u]]$Model[[method[u]]]$Type)))>5)
          {stop("The maximum number of perturbations in any of the elements and fleets of 'x' must not be higher than 5; \n any of the models in 'x' can go from a minimum of c(0,0) (pure depletion both fleets) to a maximum of c(5,5)")}
        PredStock <- data.frame(Year=as.numeric(format(as.Date(x[[1]]$Data$Properties$Dates[1]),"%Y")):as.numeric(format(as.Date(x[[ny]]$Data$Properties$Dates[1]),"%Y")),
                                Mw.kg=mbw.sd[,2],
                                SDmw.kg=mbw.sd[,3],
                                N0Tot.thou=0,
                                N0Tot.thou.SE=0,
                                B0Tot.ton=0,
                                B0Tot.ton.SE=0)
        for(i in 1:ny)
          {
           #Replacing missing standard errors
           if(any(is.na(x[[i]]$Model[[method[i]]]$bt.stdev)))
             {
              x[[i]]$Model[[method[i]]]$bt.stdev[which(is.na(x[[i]]$Model[[method[i]]]$bt.stdev))] <-
              x[[i]]$Model[[method[i]]]$bt.par[which(is.na(x[[i]]$Model[[method[i]]]$bt.stdev))]*
              mean(unlist(x[[i]]$Model[[method[i]]]$bt.stdev[which(!is.na(x[[i]]$Model[[method[i]]]$bt.stdev))])/
              unlist(x[[i]]$Model[[method[i]]]$bt.par[which(!is.na(x[[i]]$Model[[method[i]]]$bt.stdev))]))
             }
           mt             <- x[[i]]$Model[[method[i]]]$Type
           Thou.scaler    <- 1e6*(x[[i]]$Data$Properties$Units[4]=="bill") +
                             1e3*(x[[i]]$Data$Properties$Units[4]=="mill") +
                             1e0*(x[[i]]$Data$Properties$Units[4]=="thou") +
                             1e-1*(x[[i]]$Data$Properties$Units[4]=="hund")
           M     <- unlist(x[[i]]$Model[[method[i]]]$bt.par["M"])
           SE.M  <- unlist(x[[i]]$Model[[method[i]]]$bt.stdev["M"])
           N0    <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par["N0"])
           SE.N0 <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev["N0"])
           if(sum(mt == c(0,0))==2)
             {
              PredStock$N0Tot.thou[i]    <- N0
              PredStock$N0Tor.thou.SE[i] <- SE.N0
              PredStock$B0Tot.ton[i]     <- N0*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]  <- sqrt((SE.N0)^2*(mbw.sd[i,2])^2+(N0)^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(0,1))==2)
             {
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              ts1                         <- x[[i]]$Model[[method[i]]]$Dates[1]
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,6),c(1,2,6)],sd=c(SE.M,SE.N0,P1F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F2*exp(M*P1F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)",
                                                     P1F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(0,2))==2)
             {
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,6,7),c(1,2,6,7)],sd=c(SE.M,SE.N0,P1F2.SE,P2F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)",
                                                     P1F2.back,P2F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F2,P2F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(0,3))==2)
             {
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,6,7,8),c(1,2,6,7,8)],sd=c(SE.M,SE.N0,P1F2.SE,P2F2.SE,P3F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)",
                                                     P1F2.back,P2F2.back,P3F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F2,P2F2,P3F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(0,4))==2)
             {
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              ts1                         <- x[[i]]$Model[[method[i]]]$Dates[1]
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,6:9),c(1,2,6:9)],sd=c(SE.M,SE.N0,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)",
                                                     P1F2.back,P2F2.back,P3F2.back,P4F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F2,P2F2,P3F2,P4F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(0,5))==2)
             {
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P5F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,6:10),c(1,2,6:10)],sd=c(SE.M,SE.N0,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back) +
                                                  P5F2*exp(M*P5F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)",
                                                     P1F2.back,P2F2.back,P3F2.back,P4F2.back,P5F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(1,1))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,7),c(1,2,3,7)],sd=c(SE.M,SE.N0,P1F1.SE,P1F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)",
                                                     P1F1.back,P1F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P1F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(1,2))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                     <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P1F2.back                     <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P2F2.back                     <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,7,8),c(1,2,3,7,8)],sd=c(SE.M,SE.N0,P1F1.SE,P1F2.SE,P2F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)",
                                                     P1F1.back,P1F2.back,P2F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P1F2,P2F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(1,3))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,7:9),c(1,2,3,7:9)],sd=c(SE.M,SE.N0,P1F1.SE,P1F2.SE,P2F2.SE,P3F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back)
              form                       <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)",
                                                     P1F1.back,P1F2.back,P2F2.back,P3F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P1F2,P2F2,P3F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(1,4))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,7:10),c(1,2,3,7:10)],sd=c(SE.M,SE.N0,P1F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)",
                                                     P1F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P1F2,P2F2,P3F2,P4F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(1,5))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P5F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              ts1                         <-
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,7:11),c(1,2,3,7:11)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back) +
                                                  P5F2*exp(M*P5F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)",
                                                     P1F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back,P5F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(2,2))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,4,8,9),c(1,2,3,4,8,9)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P1F2.SE,P2F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P1F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P1F2.back,P2F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P1F2,P2F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(2,3))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,4,8:10),c(1,2,3,4,8:10)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P1F2.SE,P2F2.SE,P3F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P1F2.back,P2F2.back,P3F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P1F2,P2F2,P3F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(2,4))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,4,8:11),c(1,2,3,4,8:11)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P1F2,P2F2,P3F2,P4F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(2,5))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[8])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[8])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P5F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[8]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1,2,3,4,8:12),c(1,2,3,4,8:12)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F2.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back) +
                                                  P5F2*exp(M*P5F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)+x9*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back,P5F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(3,3))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:5,9:11),c(1:5,9:11)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P1F2.SE,P2F2.SE,P3F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F1.back) +
                                                  P3F1*exp(M*P3F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P3F1.back,P1F2.back,P2F2.back,P3F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P1F2,P2F2,P3F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(3,4))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[8]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:5,9:12),c(1:5,9:12)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F1.back) +
                                                  P3F1*exp(M*P3F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)+x9*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P3F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P1F2,P2F2,P3F2,P4F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(3,5))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[2]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[3]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.back                   <- x[[i]]$Model[[method[i]]]$Dates[4]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[9])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[9])
              P1F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[5]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P2F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[6]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P3F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[7]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P4F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[8]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[13])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[13])
              P5F2.back                   <- x[[i]]$Model[[method[i]]]$Dates[9]-x[[i]]$Model[[method[i]]]$Dates[1]+1
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:5,9:13),c(1:5,9:13)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*P1F1.back) +
                                                  P2F1*exp(M*P2F1.back) +
                                                  P3F1*exp(M*P3F1.back) +
                                                  P1F2*exp(M*P1F2.back) +
                                                  P2F2*exp(M*P2F2.back) +
                                                  P3F2*exp(M*P3F2.back) +
                                                  P4F2*exp(M*P4F2.back) +
                                                  P5F2*exp(M*P5F2.back)
              form                        <- sprintf("~x2+x3*exp(x1*%i)+x4*exp(x1*%i)+x5*exp(x1*%i)+x6*exp(x1*%i)+x7*exp(x1*%i)+x8*exp(x1*%i)+x9*exp(x1*%i)+x10*exp(x1*%i)",
                                                     P1F1.back,P2F1.back,P3F1.back,P1F2.back,P2F2.back,P3F2.back,P4F2.back,P5F2.back)
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=as.formula(form),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(4,4))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[2]
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[3]
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[4]
              P4F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P4F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P4F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[5]
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P1F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[6]
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P2F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[7]
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P3F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[8]
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[13])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[13])
              P4F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[9]
              ts1                         <- x[[i]]$Model[[method[i]]]$Dates[1]
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:6,10:13),c(1:6,10:13)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P4F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*(P1F1.ts-ts1+1)) + P2F1*exp(M*(P2F1.ts-ts1+1)) + P3F1*exp(M*(P3F1.ts-ts1+1)) + P4F1*exp(M*(P4F1.ts-ts1+1)) +
                                                  P1F2*exp(M*(P1F2.ts-ts1+1)) + P2F2*exp(M*(P2F2.ts-ts1+1)) + P3F2*exp(M*(P3F2.ts-ts1+1)) + P4F2*exp(M*(P4F2.ts-ts1+1))
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=list(~x2 + x3*exp(x1*(P1F1.ts-ts1+1)) + x4*exp(x1*(P2F1.ts-ts1+1)) + x5*exp(x1*(P3F1.ts-ts1+1)) + x6*exp(x1*(P4F1.ts-ts1+1)) +
                                                                      x7*exp(x1*(P1F2.ts-ts1+1)) + x7*exp(x1*(P2F2.ts-ts1+1)) + x9*exp(x1*(P3F2.ts-ts1+1)) + x10*exp(x1*(P4F2.ts-ts1+1))),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P4F1,P1F2,P2F2,P3F2,P4F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(4,5))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[2]
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[3]
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[4]
              P4F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P4F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P4F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[5]
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[10])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[10])
              P1F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[6]
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P2F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[7]
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P3F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[8]
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[13])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[13])
              P4F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[9]
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[14])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[14])
              P5F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[10]
              ts1                         <- x[[i]]$Model[[method[i]]]$Dates[1]
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:6,10:14),c(1:6,10:14)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P4F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*(P1F1.ts-ts1+1)) + P2F1*exp(M*(P2F1.ts-ts1+1)) + P3F1*exp(M*(P3F1.ts-ts1+1)) + P4F1*exp(M*(P4F1.ts-ts1+1)) +
                                                  P1F2*exp(M*(P1F2.ts-ts1+1)) + P2F2*exp(M*(P2F2.ts-ts1+1)) + P3F2*exp(M*(P3F2.ts-ts1+1)) + P4F2*exp(M*(P4F2.ts-ts1+1)) + P5F2*exp(M*(P5F2.ts-ts1+1))
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=list(~x2 + x3*exp(x1*(P1F1.ts-ts1+1)) + x4*exp(x1*(P2F1.ts-ts1+1)) + x5*exp(x1*(P3F1.ts-ts1+1)) + x6*exp(x1*(P4F1.ts-ts1+1)) +
                                                                      x7*exp(x1*(P1F2.ts-ts1+1)) + x7*exp(x1*(P2F2.ts-ts1+1)) + x9*exp(x1*(P3F2.ts-ts1+1)) + x10*exp(x1*(P4F2.ts-ts1+1)) + x11*exp(x1*(P5F2.ts-ts1+1))),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P4F1,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
           if(sum(mt == c(5,5))==2)
             {
              P1F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[3])
              P1F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[3])
              P1F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[2]
              P2F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[4])
              P2F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[4])
              P2F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[3]
              P3F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[5])
              P3F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[5])
              P3F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[4]
              P4F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[6])
              P4F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[6])
              P4F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[5]
              P5F1                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[7])
              P5F1.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[7])
              P5F1.ts                     <- x[[i]]$Model[[method[i]]]$Dates[6]
              P1F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[11])
              P1F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[11])
              P1F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[7]
              P2F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[12])
              P2F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[12])
              P2F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[8]
              P3F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[13])
              P3F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[13])
              P3F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[9]
              P4F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[14])
              P4F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[14])
              P4F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[10]
              P5F2                        <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.par[15])
              P5F2.SE                     <- Thou.scaler*unlist(x[[i]]$Model[[method[i]]]$bt.stdev[15])
              P5F2.ts                     <- x[[i]]$Model[[method[i]]]$Dates[11]
              ts1                         <- x[[i]]$Model[[method[i]]]$Dates[1]
              cov                         <- cor2cov(x[[i]]$Model[[method[i]]]$Cor[c(1:7,11:15),c(1:7,11:15)],
                                                     sd=c(SE.M,SE.N0,P1F1.SE,P2F1.SE,P3F1.SE,P4F1.SE,P5F1.SE,P1F2.SE,P2F2.SE,P3F2.SE,P4F2.SE,P5F2.SE))
              PredStock$N0Tot.thou[i]     <- N0 + P1F1*exp(M*(P1F1.ts-ts1+1)) + P2F1*exp(M*(P2F1.ts-ts1+1)) + P3F1*exp(M*(P3F1.ts-ts1+1)) + P4F1*exp(M*(P4F1.ts-ts1+1)) + P5F1*exp(M*(P5F1.ts-ts1+1)) +
                                                  P1F2*exp(M*(P1F2.ts-ts1+1)) + P2F2*exp(M*(P2F2.ts-ts1+1)) + P3F2*exp(M*(P3F2.ts-ts1+1)) + P4F2*exp(M*(P4F2.ts-ts1+1)) + P5F2*exp(M*(P5F2.ts-ts1+1))
              PredStock$N0Tot.thou.SE[i]  <- deltamethod(g=list(~x2 + x3*exp(x1*(P1F1.ts-ts1+1)) + x4*exp(x1*(P2F1.ts-ts1+1)) + x5*exp(x1*(P3F1.ts-ts1+1)) + x6*exp(x1*(P4F1.ts-ts1+1)) + x7*exp(x1*(P5F1.ts-ts1+1)) +
                                                                      x8*exp(x1*(P1F2.ts-ts1+1)) + x9*exp(x1*(P2F2.ts-ts1+1)) + x10*exp(x1*(P3F2.ts-ts1+1)) + x11*exp(x1*(P4F2.ts-ts1+1)) + x12*exp(x1*(P5F2.ts-ts1+1))),
                                                         mean=c(M,N0,P1F1,P2F1,P3F1,P4F1,P1F2,P2F2,P3F2,P4F2,P5F2),
                                                         cov=cov)
              PredStock$B0Tot.ton[i]      <- PredStock$N0Tot.thou[i]*mbw.sd[i,2]
              PredStock$B0Tot.ton.SE[i]   <- sqrt((PredStock$N0Tot.thou.SE[i])^2*(mbw.sd[i,2])^2+(PredStock$N0Tot.thou[i])^2*(mbw.sd[i,3])^2)
             }
          }
      #End of two fleets
      }
    #End week or day
    }
    return(PredStock)
  #End of function
  }
#########################      FIT PRODUCTION MODEL     ########################
